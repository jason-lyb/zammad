import{a as he}from"./LayoutContent.vue_vue_type_script_setup_true_lang-SafgfcNL.js";import{_ as ye}from"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";import{r as D,R,b as E,w as j,aV as q,c as u,f as B,a1 as L,m as d,p as y,E as x,q as m,y as k,D as _,I as _e,M as C,z as be,Q as O,ap as Ce,aX as Oe,aZ as Te,a7 as Le,t as K,aN as xe,al as Be,u as p,J as Se,H,a_ as $e}from"./vue-oicRkvo0.js";import{u as T}from"./vendor-C11O1Xx8.js";import{u as Ie}from"./usePagination-CE_-FZed.js";import{w as Z,x as Pe,y as ze,c as Re,f as De,z as Ne}from"./desktop-l0eJ1dZN.js";import{a as U,e as Ee,q as Ae,a2 as Qe}from"./routes-CgLO9M4y.js";import{an as Fe,aR as X}from"./overviewAttributes.api-C09LSZ8O.js";import{Q as je}from"./apollo-Cj5TVUDk.js";import{_ as qe,C as He}from"./CommonTableSkeleton.vue_vue_type_script_setup_true_lang-DxqYsGJE.js";import{_ as Me}from"./CommonTicketPriorityIndicatorIcon.vue_vue_type_script_setup_true_lang-BmacuuuP.js";import{u as Ue}from"./useElementScroll-BdrPIdz0.js";import{u as We}from"./LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js";import{b as Ve}from"./lodash-pFOI14f-.js";import{_ as Ye}from"./NavigationMenuList.vue_vue_type_script_setup_true_lang-CYOBePFr.js";import"./theme-Bv2ClBzZ.js";import"./vite-FJshFMF2.js";import"./useResizeGridColumns-CieKHty_.js";import"./commonjsHelpers-BosuxZz1.js";import"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import"./formkit-5nol1GBe.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./useForm-CUKec4n5.js";import"./useCopyToClipboard-CjkPg__g.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./ObjectAttribute.vue_vue_type_script_setup_true_lang-S7kCEp8d.js";import"./useDisplayObjectAttributes-sspS-pHp.js";import"./CommonSkeleton.vue_vue_type_script_setup_true_lang-CNAAMgPI.js";const Ge=(c,o,a,i)=>{const r=D(R(o)),t=D(R(a));E(o)&&j(o,n=>{r.value=n}),E(a)&&j(a,n=>{t.value=n});const s=D(!1),h=(n,w,f={})=>{s.value=!0,c.refetch({orderBy:n,orderDirection:w,...f}).finally(()=>{s.value=!1,requestAnimationFrame(()=>{var b;(b=i==null?void 0:i.value)==null||b.scrollTo({top:0})})}),r.value=n,t.value=w};return q(()=>{r.value=R(o),t.value=R(a)}),{sort:h,isSorting:s,orderBy:r,orderDirection:t}},Je=()=>{const{user:c}=T(U()),o=u(()=>{var i,r,t,s;return(((r=(i=c.value)==null?void 0:i.preferences)==null?void 0:r.tickets_closed)??0)+(((s=(t=c.value)==null?void 0:t.preferences)==null?void 0:s.tickets_open)??0)}),a=u(()=>o.value>0);return{totalCount:o,hasAnyTicket:a}},Ke="/assets/frontend/vite/assets/confetti-Cx7dLYFx.svg",Xe={class:"absolute top-1/2 w-full -translate-y-1/2 text-center ltr:left-1/2 ltr:-translate-x-1/2 rtl:right-1/2 rtl:translate-x-1/2"},Ze={key:0,class:"mx-auto",src:Ke,alt:"confetti"},M=B({__name:"TicketOverviewsEmptyText",props:{title:{},text:{},icon:{},withIllustration:{type:Boolean}},setup(c){return(o,a)=>{const i=L("CommonIcon"),r=L("CommonLabel");return d(),y("div",Xe,[o.withIllustration?(d(),y("img",Ze)):x("",!0),m(r,{tag:"h2",size:"xl",class:"flex items-center justify-center gap-2 text-black dark:text-white"},{default:k(()=>[o.icon?(d(),_(i,{key:0,size:"small",name:o.icon},null,8,["name"])):x("",!0),_e("span",null,C(o.title),1)]),_:1}),be(o.$slots,"default",{},()=>[m(r,{tag:"p",class:"block! py-5"},{default:k(()=>[O(C(o.text),1)]),_:1})])])}}}),et={ref:"scroll-container",class:"overflow-y-auto focus-visible:outline-none"},tt={key:0},ot={key:2},rt=B({__name:"TicketList",props:{overviewId:{},orderBy:{},orderDirection:{},headers:{},overviewName:{},groupBy:{},overviewCount:{}},setup(c){const o=c,a=Ce(),{readTicketsByOverviewCache:i,forceTicketsByOverviewCacheOnlyFirstPage:r}=Ne(),{queryPollingConfig:t}=T(Z());let s;const h=D(!0),n=u(()=>(h.value?t.value.foreground.interval_sec:t.value.background.interval_sec)*1e3),w=u(e=>{var v;const l={pageSize:t.value.page_size,overviewId:o.overviewId,orderBy:o.orderBy,orderDirection:o.orderDirection,cacheTtl:t.value.foreground.cache_ttl_sec,renewCache:(e==null?void 0:e.overviewId)!==o.overviewId},g=i(l);return l.knownCollectionSignature=(v=g==null?void 0:g.ticketsCachedByOverview)==null?void 0:v.collectionSignature,e&&Ve(e,l)?e:l}),f=new je(Pe(w,{fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-and-network",context:{batch:{active:!1}}})),b=f.result(),W=f.loading(),ee=u(()=>{var e,l;return(l=(e=b.value)==null?void 0:e.ticketsCachedByOverview)==null?void 0:l.collectionSignature}),V=u(()=>b.value!==void 0?!1:W.value),A=u(()=>{var e;return Fe((e=b.value)==null?void 0:e.ticketsCachedByOverview)});Oe(()=>{h.value||(f.refetch({renewCache:!0}),h.value=!0)}),Te(()=>{h.value=!1});const Q=Ie(f,"ticketsCachedByOverview",t.value.page_size,()=>({knownCollectionSignature:null,renewCache:!1})),S=Le("scroll-container"),{sort:te,orderBy:$,orderDirection:I,isSorting:P}=Ge(f,K(o,"orderBy"),K(o,"orderDirection"),S),oe=(e,l)=>{var v;r({...w.value,orderBy:$.value,orderDirection:I.value},s,t.value.page_size);const g=i({...w.value,orderBy:e,orderDirection:l});te(e,l,{knownCollectionSignature:(v=g==null?void 0:g.ticketsCachedByOverview)==null?void 0:v.collectionSignature,renewCache:!1})},{startPolling:Y,stopPolling:re}=ze(f,n,()=>({knownCollectionSignature:ee.value,renewCache:!1,pageSize:t.value.page_size*Q.currentPage}),()=>({enabled:t.value.enabled&&!P.value}));f.watchOnceOnResult(e=>{t.value.enabled&&(s=e.ticketsCachedByOverview.collectionSignature,Y())}),xe(()=>{r(w.value,s,t.value.page_size)}),j(()=>o.overviewId,()=>{f.watchOnceOnResult(e=>{t.value.enabled&&(s=e.ticketsCachedByOverview.collectionSignature,Y())})}),q(()=>{r(w.value,s,t.value.page_size),t.value.enabled&&re()}),f.onResult(e=>{P.value&&!e.loading&&(P.value=!1)});const ie=u(()=>{var e;return((e=b.value)==null?void 0:e.ticketsCachedByOverview.totalCount)||0}),ae=async()=>Q.fetchNextPage(),{config:z}=T(Ee()),{user:se,userId:ne}=T(U()),le=u(()=>`${ne.value}-table-headers-${o.overviewId}`),{scrollPosition:ce,restoreScrollPosition:ue}=We(S);q(()=>{ce.value=0,ue()});const{reachedTop:ve}=Ue(S),{hasAnyTicket:de}=Je(),me=u(()=>{var e,l;return Qe("ticket.customer",((l=(e=se.value)==null?void 0:e.permissions)==null?void 0:l.names)??[])&&z.value.customer_ticket_create}),pe=e=>a.push(`/tickets/${X(e.id)}`),G={internal:!0,getLink:e=>`/tickets/${X(e.id)}`},ke=u(()=>{const e=[...o.headers];return e.unshift("stateIcon"),z.value.ui_ticket_priority_icons&&e.unshift("priorityIcon"),e}),we=u(()=>z.value.ui_ticket_overview_ticket_limit),{height:fe}=Be(),ge=u(()=>{const e=Math.ceil(fe.value/40);return o.overviewCount&&o.overviewCount>e?e:o.overviewCount});return(e,l)=>{const g=L("CommonLabel");return d(),y("div",et,[V.value&&!p(Q).loadingNewPage?(d(),y("div",tt,[m(qe,{rows:ge.value},null,8,["rows"])])):!V.value&&!A.value.length?(d(),y(Se,{key:1},[me.value&&!p(de)?(d(),_(M,{key:0,class:"space-y-2.5",title:e.$t("Welcome!")},{default:k(()=>[m(g,{class:"block",tag:"p"},{default:k(()=>[O(C(e.$t("You have not created a ticket yet.")),1)]),_:1}),m(g,{class:"block",tag:"p"},{default:k(()=>[O(C(e.$t('The way to communicate with us is this thing called "ticket".')),1)]),_:1}),m(g,{class:"block",tag:"p"},{default:k(()=>[O(C(e.$t("Please click on the button below to create your first one.")),1)]),_:1}),m(Re,{size:"large",class:"mx-auto !mt-8",variant:"primary",onClick:l[0]||(l[0]=v=>p(a).push({name:"TicketCreate"}))},{default:k(()=>[O(C(e.$t("Create your first ticket")),1)]),_:1})]),_:1},8,["title"])):(d(),_(M,{key:1,title:e.$t("Empty Overview"),text:e.$t("No tickets in this state."),"with-illustration":""},null,8,["title","text"]))],64)):A.value.length?(d(),y("div",ot,[m(He,{"order-by":p($),"onUpdate:orderBy":l[1]||(l[1]=v=>E($)?$.value=v:null),"order-direction":p(I),"onUpdate:orderDirection":l[2]||(l[2]=v=>E(I)?I.value=v:null),caption:e.$t("Overview: %s",e.overviewName),headers:ke.value,object:p(Ae).Ticket,"group-by":e.groupBy,"reached-scroll-top":p(ve),"table-id":e.overviewId,"scroll-container":p(S),attributes:[{name:"priorityIcon",label:e.__("Priority Icon"),headerPreferences:{noResize:!0,hideLabel:!0,displayWidth:25,noSorting:!0},columnPreferences:{},dataType:"icon"},{name:"stateIcon",label:e.__("State Icon"),headerPreferences:{noResize:!0,hideLabel:!0,displayWidth:30,noSorting:!0},columnPreferences:{},dataType:"icon"}],"attribute-extensions":{title:{columnPreferences:{link:G}},number:{label:p(z).ticket_hook,columnPreferences:{link:G}}},items:A.value,"total-items":ie.value,"storage-key-id":le.value,"max-items":we.value,"is-sorting":p(P),"is-loading":p(W),onLoadMore:ae,onClickRow:pe,onSort:oe},{"column-cell-priorityIcon":k(({item:v,isRowSelected:F})=>{var J;return[m(Me,{"ui-color":(J=v.priority)==null?void 0:J.uiColor,"with-text-color":"",class:H(["shrink-0 group-hover:text-black group-focus-visible:text-white group-active:text-white group-hover:dark:text-white group-active:dark:text-white",{"ltr:text-black rtl:text-black dark:text-white":F}])},null,8,["ui-color","class"])]}),"column-cell-stateIcon":k(({item:v,isRowSelected:F})=>[m(De,{class:H(["shrink-0 group-hover:text-black group-focus-visible:text-white group-active:text-white group-hover:dark:text-white group-active:dark:text-white",{"ltr:text-black rtl:text-black dark:text-white":F}]),"color-code":v.stateColorCode,label:v.state.name,"aria-labelledby":v.id,"icon-size":"tiny"},null,8,["class","color-code","label","aria-labelledby"])]),_:1},8,["order-by","order-direction","caption","headers","object","group-by","reached-scroll-top","table-id","scroll-container","attributes","attribute-extensions","items","total-items","storage-key-id","max-items","is-sorting","is-loading"])])):x("",!0)],512)}}}),N=()=>{const c=Z(),{setCurrentTicketOverviewLink:o,updateLastUsedOverview:a}=c,i=T(c);return{setCurrentTicketOverviewLink:o,updateLastUsedOverview:a,...i}},it=B({__name:"TicketOverviewsList",setup(c){const{overviews:o,overviewsTicketCountById:a}=N(),i=u(()=>{var r;return(r=o.value)==null?void 0:r.map(t=>({label:t.name,id:t.id,route:t.link,count:a.value[t.id]}))});return(r,t)=>(d(),_(Ye,{"aria-label":r.$t("Overview navigation list"),"count-variant":"info","count-size":"xs",items:i.value},null,8,["aria-label","items"]))}}),at={class:"flex flex-col gap-2.5"},st=B({__name:"TicketOverviewsSidebar",setup(c){const{hasPermission:o}=U(),a=u(()=>o("user_preferences.overview_sorting"));return(i,r)=>{const t=L("CommonLabel"),s=L("CommonLink");return d(),y("section",at,[a.value?(d(),_(s,{key:0,class:"my-2.5 ltr:ml-auto rtl:mr-auto",internal:"",link:"/personal-setting/ticket-overviews"},{default:k(()=>[m(t,{size:"small",class:"text-blue-800!","prefix-icon":"list-columns-reverse"},{default:k(()=>[O(C(i.$t("reorder items")),1)]),_:1})]),_:1})):x("",!0),m(it)])}}}),Mt=B({async beforeRouteEnter(c,o,a){const{overviews:i,overviewsLoading:r,setCurrentTicketOverviewLink:t,currentTicketOverviewLink:s,overviewsByLink:h}=N();await $e(()=>r.value).toBe(!1);const n=c.params.overviewLink;if(n in h.value||i.value.length===0)return t(n||""),a();const w=s.value||i.value[0].link;t(w),a({name:"TicketOverview",params:{overviewLink:w}})},beforeRouteUpdate(c,o,a){const{currentTicketOverviewLink:i,overviews:r,setCurrentTicketOverviewLink:t}=N();if(c.params.overviewLink)return t(c.params.overviewLink),a();const s=i.value||r.value[0].link;t(s),a({name:"TicketOverview",params:{overviewLink:s}})},__name:"TicketOverviews",props:{overviewLink:{}},setup(c){const o=c,{overviewsByLink:a,hasOverviews:i,overviewsTicketCountById:r}=N(),t=u(()=>a.value[o.overviewLink]),s=u(()=>{var n;return r.value[(n=t.value)==null?void 0:n.id]}),h=u(()=>{var n;return[{label:__("Overviews"),route:"/tickets/view"},{label:(n=t.value)==null?void 0:n.name,count:s.value}]});return(n,w)=>(d(),y("div",{class:H(["h-full",{"grid grid-cols-[260px_1fr]":p(i)}])},[p(i)?(d(),_(ye,{key:0,id:"ticket-overviews","aria-label":n.$t("second level navigation sidebar"),"background-variant":"secondary",name:"overviews"},{default:k(()=>[m(st)]),_:1},8,["aria-label"])):x("",!0),m(he,{class:"relative","breadcrumb-items":t.value?h.value:void 0,"no-scrollable":"","content-padding":""},{default:k(()=>[t.value?(d(),_(rt,{key:0,class:"px-4 pb-4","overview-id":t.value.id,"overview-name":t.value.name,headers:t.value.viewColumnsRaw,"order-by":t.value.orderBy,"order-direction":t.value.orderDirection,"group-by":t.value.groupBy||void 0,"overview-count":s.value},null,8,["overview-id","overview-name","headers","order-by","order-direction","group-by","overview-count"])):(d(),_(M,{key:1,title:n.$t("No Overviews"),text:n.$t("Currently, no overviews are assigned to your roles. Please contact your administrator."),icon:"exclamation-triangle"},null,8,["title","text"]))]),_:1},8,["breadcrumb-items"])],2))}});export{Mt as default};
//# sourceMappingURL=TicketOverviews-Cak9dMzR.js.map
