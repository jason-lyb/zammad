import{n as S,u as x}from"./vendor-C11O1Xx8.js";import{e as B,E as M,N as T,c as U,M as V}from"./apollo-Cj5TVUDk.js";import{R as b,a as q,F as D,i as k}from"./routes-CgLO9M4y.js";import{X as H,aT as I,aU as j,a2 as J}from"./overviewAttributes.api-C09LSZ8O.js";import{c as X,k as G}from"./desktop-l0eJ1dZN.js";import{_ as K}from"./CommonThirdPartyAuthenticationButton.vue_vue_type_script_setup_true_lang-Cn_DdVLy.js";import{a as O}from"./LayoutContent.vue_vue_type_script_setup_true_lang-SafgfcNL.js";import{u as Q}from"./useBreadcrumb-DUhE6wbZ.js";import{f as W,c,r as Y,m as r,D as d,y as _,q as Z,I as P,p as y,x as ee,J as h,u as C,H as te,E as se}from"./vue-oicRkvo0.js";import"./commonjsHelpers-BosuxZz1.js";import"./lodash-pFOI14f-.js";import"./vite-FJshFMF2.js";import"./formkit-5nol1GBe.js";import"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./useForm-CUKec4n5.js";import"./useCopyToClipboard-CjkPg__g.js";import"./theme-Bv2ClBzZ.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js";import"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";import"./useResizeGridColumns-CieKHty_.js";const ae=S`
    mutation userCurrentRemoveLinkedAccount($provider: EnumAuthenticationProvider!, $uid: String!) {
  userCurrentRemoveLinkedAccount(provider: $provider, uid: $uid) {
    success
    errors {
      ...errors
    }
  }
}
    ${H}`;function ne(u={}){return B(ae,u)}const re={class:"flex items-center justify-center"},Te=W({beforeRouteEnter(){const{hasEnabledProviders:u}=b();return u.value?!0:I({type:j.AuthenticatedError,title:__("Forbidden"),message:__("There are no enabled third-party authentication providers."),statusCode:M.Forbidden})},__name:"PersonalSettingLinkedAccounts",setup(u){const{notify:L}=U(),{breadcrumbItems:A}=Q(__("Linked Accounts")),{user:o}=x(q()),{enabledProviders:$}=b(),{fingerprint:v}=D(),w=c(()=>{var n;if(!((n=o.value)!=null&&n.authorizations))return[];const{authorizations:e}=o.value;return $.value.map(a=>{const s=e.find(({provider:t})=>t===a.name);return{...a,uid:s==null?void 0:s.uid,username:(s==null?void 0:s.username)||(s==null?void 0:s.uid),authorizationId:s==null?void 0:s.id}})}),R=[{key:"application",label:__("Application")},{key:"username",label:__("Username"),truncate:!0}],E=c(()=>w.value.map((e,n)=>({id:`${n}-${e.name}`,application:e.label,...e}))),i=Y(!1),z=async(e,n,a)=>new V(ne(()=>({update(s){if(o.value===null)return;const t=s.identify({authId:e,__typename:"Authorization"});s.evict({id:t}),s.modify({id:s.identify(o.value),fields:{authorizations(l,{readField:m}){return l.filter(p=>m("id",p)!==e)}}}),s.gc()}}))).send({provider:n,uid:a}),{waitForVariantConfirmation:g}=J(),F=async e=>{if(await g("delete"))try{i.value=!0;const a=await z(e.authorizationId,e.name,e.uid);if(!(a!=null&&a.userCurrentRemoveLinkedAccount))return;const{success:s}=a.userCurrentRemoveLinkedAccount;s&&L({id:"linked-account-removed",type:T.Success,message:__("The account link was successfully removed!")})}finally{i.value=!1}},N=c(()=>[{key:"delete",icon:"trash3",variant:"danger",ariaLabel:e=>k.t("Remove account link on %s",e==null?void 0:e.application),show:e=>!!(e!=null&&e.username),onClick:e=>F(e)},{key:"setup",icon:"plus-square-fill",variant:"secondary",ariaLabel:e=>k.t("Link account on %s",e==null?void 0:e.application),show:e=>!(e!=null&&e.username)}]);return(e,n)=>(r(),d(O,{"breadcrumb-items":C(A),width:"narrow"},{default:_(()=>[Z(G,{caption:e.$t("Linked accounts"),headers:R,items:E.value,actions:N.value},{actions:_(({actions:a,item:s})=>[P("div",re,[(r(!0),y(h,null,ee(a,t=>{var l,m;return r(),y(h,{key:t.key},[t.key==="setup"&&((l=t.show)!=null&&l.call(t,s))?(r(),d(K,{key:0,"button-class":"flex","button-icon":t.icon,disabled:i.value,"button-size":"medium","button-label":(t==null?void 0:t.ariaLabel).call(t,s),url:`${s==null?void 0:s.url}?fingerprint=${C(v)}`},null,8,["button-icon","disabled","button-label","url"])):t.onClick&&((m=t.show)!=null&&m.call(t,s))?(r(),d(X,{key:1,icon:t.icon,disabled:i.value,class:te({"bg-transparent!":t.variant==="danger"}),size:"medium",variant:t.variant,"aria-label":(t==null?void 0:t.ariaLabel).call(t,s),onClick:p=>{var f;return(f=t.onClick)==null?void 0:f.call(t,s)}},null,8,["icon","disabled","class","variant","aria-label","onClick"])):se("",!0)],64)}),128))])]),_:1},8,["caption","items","actions"])]),_:1},8,["breadcrumb-items"]))}});export{Te as default};
//# sourceMappingURL=PersonalSettingLinkedAccounts-D7JMh2eK.js.map
