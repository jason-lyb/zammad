const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ArticleMetadataDialog-v5r0ZZhO.js","assets/ObjectAttribute.vue_vue_type_script_setup_true_lang-S7kCEp8d.js","assets/overviewAttributes.api-C09LSZ8O.js","assets/vue-oicRkvo0.js","assets/vendor-C11O1Xx8.js","assets/commonjsHelpers-BosuxZz1.js","assets/routes-CgLO9M4y.js","assets/vite-FJshFMF2.js","assets/apollo-Cj5TVUDk.js","assets/lodash-pFOI14f-.js","assets/formkit-5nol1GBe.js","assets/overviewAttributes-r_4zXopK.css","assets/useDisplayObjectAttributes-sspS-pHp.js","assets/useArticleSecurity-D_0zJIjN.js","assets/ticketArticleRetrySecurityProcess.api-pSAexXXb.js","assets/index-D5f5eTVX.js","assets/useBaseUrl-BsZiEKQE.js","assets/useCopyToClipboard-CjkPg__g.js","assets/useTicketSignature-LslYi6X7.js","assets/openExternalLink-B2ZtqYBi.js","assets/getAttachmentLinks-Dz1qdLDp.js","assets/useTicketView-CMOCBKg-.js","assets/dom-0wVl69Vp.js","assets/useWhatsapp-Da8aokvI.js","assets/CommonDialog.vue_vue_type_script_setup_true_lang-CID2Z6MI.js","assets/mobile-Bk4bKGxF.js","assets/pwa-THoW_3xc.js","assets/add.api-CxwFhgGn.js","assets/datepicker-BBNcWeHz.js","assets/date-B2UyDZN7.js","assets/mobile-Crnk7LCD.css","assets/TicketViewersDialog-BIbuV5ub.js","assets/useTicketLiveUsersDisplay-CMSLuo_a.js","assets/TicketActionsDialog-N0IjNELq.js","assets/useTicketSubscribe-CmWzZx1x.js","assets/CommonButtonGroup.vue_vue_type_script_setup_true_lang-BTHDtl8G.js","assets/merge.api-B2JVH7J2.js","assets/autocompleteSearchTicket.api-DfOQWGlO.js"])))=>i.map(i=>d[i]);
import{s as ae,r as O,c as S,b2 as Le,b8 as De,f as H,m as r,p as b,M as w,a1 as P,I as p,q as I,Q as K,C as le,L as U,W as J,y as F,J as W,D as C,E as f,H as M,t as q,u as m,w as Ae,k as Be,x as Ie,n as _e,b as He,ar as Re,av as je,K as $e}from"./vue-oicRkvo0.js";import{u as Pe}from"./useStickyHeader-XWZvtRy7.js";import{a as Ve,g as Ue,f as Fe,d as Ne,b as We,c as Qe,u as Oe,e as Ke}from"./ticketArticleRetrySecurityProcess.api-pSAexXXb.js";import{aV as qe,_ as me,aW as Ge,aL as Je,aR as Se,s as Ye,l as pe,i as Ze,Z as Xe,an as et,b3 as tt}from"./overviewAttributes.api-C09LSZ8O.js";import{M as nt,N as G,c as st}from"./apollo-Cj5TVUDk.js";import{a as ee,i as X,a7 as Ce,b as rt,e as ot}from"./routes-CgLO9M4y.js";import{_ as ce}from"./CommonLoader.vue_vue_type_script_setup_true_lang-BtrvaoyW.js";import{u as it}from"./useHeader-B3UlgUtw.js";import{j as ue,C as te,l as at}from"./mobile-Bk4bKGxF.js";import{_ as de}from"./vite-FJshFMF2.js";import{c as lt}from"./index-D5f5eTVX.js";import{u as ne}from"./useTicketInformation-DhcXzEKN.js";import{l as ct}from"./vendor-C11O1Xx8.js";import{u as ut}from"./useAttachments-0IU6Vvzp.js";import{u as dt}from"./useHtmlLinks-53b5zJaG.js";import{_ as mt}from"./LayoutHeader.vue_vue_type_script_setup_true_lang-BeSNC-UK.js";import{u as pt}from"./useTicketView-CMOCBKg-.js";import{u as ft,E as oe}from"./useEscalationState-Dv4jDro1.js";import{_ as yt}from"./CommonTicketPriorityIndicator.vue_vue_type_script_setup_true_lang-DZyaZr7q.js";import"./lodash-pFOI14f-.js";import"./dom-0wVl69Vp.js";import"./formkit-5nol1GBe.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./commonjsHelpers-BosuxZz1.js";import"./useBaseUrl-BsZiEKQE.js";import"./useCopyToClipboard-CjkPg__g.js";import"./useTicketSignature-LslYi6X7.js";import"./openExternalLink-B2ZtqYBi.js";import"./getAttachmentLinks-Dz1qdLDp.js";import"./CommonBackButton.vue_vue_type_script_setup_true_lang-DhwyOyd1.js";const vt=()=>{const d=ae(),a=ae(),e=O(),o=ue({name:"article-metadata",component:()=>de(()=>import("./ArticleMetadataDialog-v5r0ZZhO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]))}),{showArticleReplyDialog:v,form:t}=ne(),{openReplyForm:_,getNewArticleBody:c}=Ve(t,v),h=O(0),i=()=>{h.value+=1},s=[],u=n=>{s.push(n)},k=S(()=>{const n=a.value,$=d.value;return!$||!n||h.value<0?[]:(s.forEach(z=>z()),s.length=0,[...lt(n,$,"mobile",{recalculate:i,onDispose:u}).map(z=>{const{perform:T,link:B,label:j}=z;return T?{type:B?"link":"button",label:j,link:B,onAction:()=>{var l;return T(n,$,{formId:((l=t.value)==null?void 0:l.formId)||"",selection:e.value,openReplyForm:_,getNewArticleBody:c})}}:{...z,type:"link"}}),{type:"button",label:__("Show meta data"),onAction(){o.open({name:o.name,article:$,ticketInternalId:n.internalId})}}])}),g=S({get:()=>d.value!=null,set:n=>{n||(d.value=void 0,s.forEach($=>$()),s.length=0)}});return{contextOptions:k,articleContextShown:g,showArticleContext:(n,$)=>{o.prefetch(),d.value=n,a.value=$;try{e.value=Ue(n.internalId)}catch(L){ct.error("[Article Quote] Failed to parse article selection",L),e.value=void 0}}}},gt=(d,a)=>{const{newArticlesIds:e}=ne(),o=ee();return{rows:Le(d,()=>{const t=[],_=new Set,c=d.value.length<a.value;let h=!1;return d.value.forEach((i,s)=>{var g,x,n,$,L,z,T;const u=X.date(i.createdAt);_.has(u)||(_.add(u),t.push({type:"date",date:i.createdAt,key:u})),(g=i.preferences)!=null&&g.delivery_message?t.push({type:"delivery",content:i.bodyWithUrls,key:i.id}):((x=i.sender)==null?void 0:x.name)===Ce.System&&((n=i.type)==null?void 0:n.name)!=="note"?t.push({type:"system",subject:i.subject,to:(($=i.to)==null?void 0:$.raw)||"",reaction:(T=(z=(L=i.preferences)==null?void 0:L.whatsapp)==null?void 0:z.reaction)==null?void 0:T.emoji,key:i.id}):t.push({type:"article-bubble",article:i,key:i.id}),s===0&&c&&t.push({type:"more",key:"more",count:a.value-d.value.length});const k=d.value[s+1];!h&&k&&o.userId!==k.author.id&&e.has(k.id)&&(h=!0,t.push({type:"new",key:"new"}))}),t})}},fe=(d,a)=>{const e=De(d,([{isIntersecting:o}])=>{o&&(a("seen"),e.stop())},{threshold:.4})},bt={class:"flex h-7 cursor-default items-center justify-center rounded-md px-1.5"},xe=H({__name:"ArticleReactionBadge",props:{reaction:{}},setup(d){return(a,e)=>(r(),b("div",bt,w(a.reaction),1))}}),kt={class:"flex flex-col items-center gap-2 border-b border-b-white/10 p-4"},ht={class:"flex w-full items-center justify-center gap-1"},wt=H({__name:"ArticleRemoteContentBadge",props:{originalFormattingUrl:{}},setup(d){const a=d,e=O(!1),o=S(()=>a.originalFormattingUrl?[{type:"link",label:__("Original Formatting"),link:a.originalFormattingUrl,attributes:{"rest-api":!0,target:"_blank"}}]:[]);return(v,t)=>{const _=P("CommonIcon");return r(),b(W,null,[p("button",le(v.$attrs,{type:"button",class:"inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1 text-xs font-bold",onClick:t[0]||(t[0]=U(c=>e.value=!e.value,["prevent"])),onKeydown:t[1]||(t[1]=J(U(c=>e.value=!e.value,["prevent"]),["space"]))}),[I(_,{name:"warning",decorative:"",size:"xs"}),K(" "+w(v.$t("Blocked Content")),1)],16),I(te,{state:e.value,"onUpdate:state":t[2]||(t[2]=c=>e.value=c),messages:o.value},{header:F(()=>[p("div",kt,[p("div",ht,[I(_,{name:"warning",size:"tiny"}),K(" "+w(v.$t("Blocked Content")),1)]),p("div",null,w(v.$t("This message contains images or other content hosted by an external source. It was blocked, but you can download the original formatting here.")),1)])]),_:1},8,["state","messages"])],64)}}}),_t={class:"flex flex-col items-center gap-2 border-b border-b-white/10 p-4"},$t={key:0,class:"text-yellow flex w-full items-center justify-center gap-1"},At={key:3},It=H({__name:"ArticleSecurityBadge",props:{articleId:{},security:{},successClass:{}},setup(d){const a=d,e=S(()=>{const{signingSuccess:s}=a.security;return s===!1?"not-signed":"unlock"}),o=S(()=>{const{signingMessage:s,signingSuccess:u,encryptionMessage:k,encryptionSuccess:g}=a.security;return!!(u===!1&&s||g===!1&&k)}),v=S(()=>{const{signingSuccess:s,encryptionSuccess:u}=a.security;return s===!0||u===!0}),t=O(!1),_=new nt(Fe(()=>({variables:{articleId:a.articleId}}))),{notify:c}=st(),h=async()=>{var g;const s=await _.send(),u=(g=s==null?void 0:s.ticketArticleRetrySecurityProcess)==null?void 0:g.retryResult;if(!u){c({id:"retry-security-error",type:G.Error,message:__("The retried security process failed!"),timeout:2e3});return}if(u.type!==a.security.type){c({id:"security-mechanism-error",type:G.Error,message:__("Article uses different security mechanism."),timeout:2e3}),t.value=!1;return}let k=!0;u.signingSuccess?c({id:"signature-verified",type:G.Success,message:__("The signature was successfully verified.")}):u.signingMessage&&(c({id:"signature-verification-failed",type:G.Error,message:__("Signature verification failed! %s"),messagePlaceholder:[X.t(u.signingMessage)],timeout:2e3}),k=!1),u.encryptionSuccess?c({id:"decryption-success",type:G.Success,message:__("Decryption was successful.")}):u.encryptionMessage&&(c({id:"decryption-failed",type:G.Error,message:__("Decryption failed! %s"),messagePlaceholder:[X.t(u.encryptionMessage)],timeout:2e3}),k=!1),k&&(t.value=!1)},i=S(()=>o.value?[{type:"button",label:__("Try again"),onAction:h,noHideOnSelect:!0}]:[]);return(s,u)=>{const k=P("CommonIcon");return r(),b(W,null,[o.value?(r(),b("button",le({key:0},s.$attrs,{type:"button",class:"bg-yellow inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1 text-xs font-bold text-black",onClick:u[0]||(u[0]=U(g=>t.value=!t.value,["prevent"])),onKeydown:u[1]||(u[1]=J(U(g=>t.value=!t.value,["prevent"]),["space"]))}),[I(k,{name:e.value,decorative:"",size:"xs"},null,8,["name"]),K(" "+w(s.$t("Security Error")),1)],16)):v.value?(r(),b("button",le({key:1},s.$attrs,{class:[s.successClass,"inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1"],type:"button",onClick:u[2]||(u[2]=U(g=>t.value=!t.value,["prevent"])),onKeydown:u[3]||(u[3]=J(U(g=>t.value=!t.value,["prevent"]),["space"]))}),[s.security.encryptionSuccess?(r(),C(k,{key:0,name:"lock",size:"tiny",label:s.$t("Encrypted")},null,8,["label"])):f("",!0),s.security.signingSuccess?(r(),C(k,{key:1,name:"signed",size:"tiny",label:s.$t("Signed")},null,8,["label"])):f("",!0)],16)):f("",!0),I(te,{state:t.value,"onUpdate:state":u[4]||(u[4]=g=>t.value=g),messages:i.value},{header:F(()=>[p("div",_t,[o.value?(r(),b("div",$t,[I(k,{name:e.value,size:"tiny"},null,8,["name"]),K(" "+w(s.$t("Security Error")),1)])):f("",!0),s.security.signingMessage?(r(),b("div",{key:1,class:M({"text-orange":!o.value&&s.security.signingSuccess===!1})},w(s.$t("Sign:"))+" "+w(s.$t(s.security.signingMessage)),3)):f("",!0),s.security.encryptionMessage?(r(),b("div",{key:2,class:M(["break-all",{"text-orange":!o.value&&s.security.encryptionSuccess===!1}])},w(s.$t("Encryption:"))+" "+w(s.$t(s.security.encryptionMessage)),3)):f("",!0),!s.security.encryptionMessage&&!s.security.signingMessage?(r(),b("div",At,w(s.$t("No security information available.")),1)):f("",!0)])]),_:1},8,["state","messages"])],64)}}}),St={class:"flex flex-col items-center gap-2 border-b border-b-white/10 p-4"},Ct={key:0,class:"text-yellow flex w-full items-center justify-center gap-1"},xt={key:1,class:"flex w-full items-center justify-center gap-1"},Tt=H({__name:"ArticleWhatsappMediaBadge",props:{articleId:{},mediaError:{type:Boolean}},setup(d){const a=d,e=O(!1),{loading:o,tryAgain:v}=Ne(q(a,"articleId")),t=S(()=>a.mediaError&&!o.value?[{type:"button",label:__("Try again"),onAction:async()=>{try{await v(),e.value=!1}catch{}},noHideOnSelect:!0}]:[]);return(_,c)=>{const h=P("CommonIcon");return r(),b(W,null,[a.mediaError?(r(),b("button",{key:0,type:"button",class:"bg-yellow inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1 text-xs font-bold text-black",onClick:c[0]||(c[0]=U(i=>e.value=!e.value,["prevent"])),onKeydown:c[1]||(c[1]=J(U(i=>e.value=!e.value,["prevent"]),["space"]))},[I(h,{name:"update",decorative:"",size:"xs"}),K(" "+w(_.$t("Media Download Error")),1)],32)):f("",!0),I(te,{state:e.value,"onUpdate:state":c[2]||(c[2]=i=>e.value=i),messages:t.value},{header:F(()=>[p("div",St,[a.mediaError?(r(),b("div",Ct,[I(h,{name:"update",size:"tiny"}),K(" "+w(_.$t("Media Download Error")),1)])):f("",!0),m(o)?(r(),b("div",xt,[I(h,{name:"loading",animation:"spin"})])):f("",!0)])]),_:1},8,["state","messages"])],64)}}}),Et=["id","data-created-by"],Mt={class:"Border"},zt={class:"flex items-center text-xs font-bold"},Lt={class:"truncate break-words"},Dt=["innerHTML"],Bt=["aria-label"],Ht=H({__name:"ArticleBubble",props:{position:{},content:{},internal:{type:Boolean},user:{},security:{},contentType:{},ticketInternalId:{},articleId:{},attachments:{},remoteContentWarning:{},mediaError:{type:[Boolean,null]},reaction:{}},emits:["show-context","seen"],setup(d,{emit:a}){const e=d,o=a,v=ee(),t=S(()=>{const{internal:l,position:A}=e;return l?"border border-blue bg-black":A==="left"?"border border-black bg-white text-black":"border border-black bg-blue text-black"}),_=S(()=>{const{internal:l,position:A}=e;if(!l)return{"rounded-bl-sm":A==="left","rounded-br-sm":A==="right"}}),c=S(()=>{var A;const{user:l}=e;return l?((A=v.user)==null?void 0:A.id)===l.id?X.t("Me"):l.fullname:""}),h=S(()=>e.contentType!=="text/html"?Je(e.content):e.content),i=S(()=>e.internal?{top:h.value.length?"border-t-[0.5px] border-t-white/50":"",amount:"text-white/60",file:"border-white/40",icon:"border-white/40"}:{top:h.value.length?"border-t-[0.5px] border-black":"",amount:"text-black/60",file:"border-black",icon:"border-black"}),{shownMore:s,bubbleElement:u,hasShowMore:k,toggleShowMore:g}=We(),x=S(()=>Se(e.articleId)),{attachments:n}=ut({attachments:S(()=>e.attachments)}),$=O([]),{showImage:L}=qe(S(()=>[...$.value,...n.value])),z=(l,A)=>{Ye(l),L(A)},{setupLinksHandlers:T}=dt("/mobile"),{populateInlineImages:B}=Qe($,l=>L($.value[l]));Ae(()=>e.content,async()=>{await _e(),u.value&&(T(u.value),B(u.value))}),Be(()=>{u.value&&(T(u.value),B(u.value))}),fe(u,o);const j=()=>{o("show-context"),_e(()=>{var l;(l=window.getSelection())==null||l.removeAllRanges()})};return(l,A)=>{var Q;const Y=P("CommonIcon");return r(),b("div",{id:`article-${x.value}`,role:"comment",class:M(["Article relative flex pb-4",{Internal:l.internal,"Right flex-row-reverse":l.position==="right",Left:l.position==="left"}]),"data-created-by":(Q=l.user)==null?void 0:Q.id},[p("div",{class:M(["h-6 w-6 self-end",{"ltr:mr-2 rtl:ml-2":l.position==="left","ltr:ml-2 rtl:mr-2":l.position==="right"}])},[l.user?(r(),C(me,{key:0,size:"xs",entity:l.user},null,8,["entity"])):f("",!0)],2),p("div",Mt,[p("div",{class:M(["content flex flex-col overflow-hidden rounded-3xl px-4 pt-2 pb-3",[_.value,t.value]])},[p("div",zt,[p("span",Lt,w(c.value),1)]),p("div",{ref_key:"bubbleElement",ref:u,class:"overflow-hidden text-base"},[p("div",{class:"Content",innerHTML:h.value},null,8,Dt)],512),m(k)?(r(),b("div",{key:0,class:M(["relative",{BubbleGradient:m(k)&&!m(s)}])},null,2)):f("",!0),l.attachments.length?(r(),b("div",{key:1,class:M(["mt-1 mb-2",i.value.top])},[p("div",{class:M(["py-1 text-xs",i.value.amount])},w(l.attachments.length===1?l.$t("1 attached file"):l.$t("%s attached files",l.attachments.length)),3),(r(!0),b(W,null,Ie(m(n),R=>(r(),C(Ge,{key:R.internalId,file:R,"download-url":R.downloadUrl,"preview-url":R.preview,"no-preview":!l.$c.ui_ticket_zoom_attachments_preview,"wrapper-class":i.value.file,"icon-class":i.value.icon,"size-class":i.value.amount,"no-remove":"",onPreview:Z=>z(Z,R)},null,8,["file","download-url","preview-url","no-preview","wrapper-class","icon-class","size-class","onPreview"]))),128))],2)):f("",!0),p("div",{class:M(["absolute bottom-0 flex gap-1",[l.position==="left"?"flex-row-reverse ltr:left-10 rtl:right-10":"ltr:right-10 rtl:left-10"]])},[l.reaction?(r(),C(xe,{key:0,class:M([t.value]),reaction:l.reaction},null,8,["class","reaction"])):f("",!0),e.mediaError?(r(),C(Tt,{key:1,"article-id":l.articleId,"media-error":e.mediaError},null,8,["article-id","media-error"])):f("",!0),l.security?(r(),C(It,{key:2,"article-id":l.articleId,"success-class":t.value,security:l.security},null,8,["article-id","success-class","security"])):f("",!0),l.remoteContentWarning?(r(),C(wt,{key:3,class:M(t.value),"original-formatting-url":l.remoteContentWarning},null,8,["class","original-formatting-url"])):f("",!0),m(k)?(r(),b("button",{key:4,class:M([t.value,"flex h-7 items-center justify-center rounded-md px-2 font-semibold"]),type:"button",onClick:A[0]||(A[0]=R=>m(g)()),onKeydown:A[1]||(A[1]=J(U(R=>m(g)(),["prevent"]),["enter"]))},w(m(s)?l.$t("See less"):l.$t("See more")),35)):f("",!0),p("button",{class:M([t.value,"flex h-7 w-7 items-center justify-center rounded-md"]),type:"button","data-name":"article-context","aria-label":l.$t("Article actions"),onPointerdown:A[2]||(A[2]=R=>j()),onKeydown:A[3]||(A[3]=J(U(R=>j(),["prevent"]),["enter"]))},[I(Y,{name:"more-vertical",size:"small",decorative:"","data-ignore-click":""})],42,Bt)],2)],2)])],10,Et)}}}),Rt=pe(Ht,[["__scopeId","data-v-77b63d22"]]),jt={class:"bg-yellow absolute flex h-7 w-7 -translate-y-7 items-center justify-center rounded-full text-black"},Pt=H({__name:"ArticleDeliveryMessage",props:{content:{},gap:{}},emits:["seen"],setup(d,{emit:a}){const e=a,o=O();return fe(o,e),(v,t)=>{const _=P("CommonIcon");return r(),b("div",{ref_key:"articleElement",ref:o,class:"flex justify-center"},[p("div",{class:M([{"mt-6":v.gap==="big","mt-2":v.gap==="small"},"border-yellow bg-yellow-highlight text-yellow flex flex-col items-center rounded-3xl border p-4"])},[p("div",jt,[I(_,{name:"warning",size:"small"})]),p("div",null,w(v.$t('Delivery failed: "%s"',v.content)),1)],2)],512)}}}),Vt={class:"text-gray text-center"},Ut=H({__name:"ArticleSeparatorDate",props:{date:{}},setup(d){return(a,e)=>{const o=P("CommonDateTime");return r(),b("div",Vt,[I(o,{"date-time":a.date,type:"absolute","absolute-format":"date"},null,8,["date-time"])])}}}),Ft={class:"relative text-center"},Nt={type:"button",class:"relative rounded-2xl border border-white/80 bg-black px-4 py-1 text-xs text-white/80 select-none"},Wt=H({__name:"ArticleSeparatorMore",props:{count:{}},setup(d){return(a,e)=>(r(),b("div",Ft,[e[0]||(e[0]=p("div",{class:"line-more absolute top-1/2 z-0 w-full"},null,-1)),p("button",Nt,w(a.$t("load %s more",a.count)),1)]))}}),Qt=pe(Wt,[["__scopeId","data-v-4d9724f5"]]),Ot={},Kt={class:"line-new text-center select-none"},qt={class:"text-blue bg-black px-2"};function Gt(d,a){return r(),b("div",Kt,[p("span",qt,w(d.$t("new")),1)])}const Jt=pe(Ot,[["render",Gt],["__scopeId","data-v-b20cfed5"]]),Yt={class:"grow text-center"},Zt=H({__name:"ArticleSystem",props:{subject:{},to:{},reaction:{}},emits:["seen"],setup(d,{emit:a}){const e=a,o=O();return fe(o,e),(v,t)=>(r(),b("div",{ref_key:"articleElement",ref:o,class:"text-gray flex items-center gap-2"},[p("div",Yt,'"'+w(v.subject)+'" -> "'+w(v.to)+'"',1),v.reaction?(r(),C(xe,{key:0,class:"bg-blue w-7 border border-black text-black",reaction:v.reaction},null,8,["reaction"])):f("",!0)],512))}}),Xt=H({__name:"ArticlesList",props:{articles:{},ticket:{},totalCount:{}},emits:["load-previous"],setup(d,{emit:a}){const e=d,o=a,{contextOptions:v,articleContextShown:t,showArticleContext:_}=vt(),c=ae(),{rows:h}=gt(q(e,"articles"),q(e,"totalCount")),i=g=>g.attachmentsWithoutInline.filter(x=>!x.preferences||!x.preferences["original-format"]),s=g=>{var n;if(!((n=g.preferences)!=null&&n.remote_content_removed))return;let x;return g.attachmentsWithoutInline.forEach($=>{var B;if(((B=$.preferences)==null?void 0:B["original-format"])!==!0)return;const L=g.internalId,z=$.internalId;x=`/ticket_attachment/${e.ticket.internalId}/${L}/${z}?disposition=attachment`}),x},{newArticlesIds:u}=ne(),k=g=>{u.delete(g)};return(g,x)=>(r(),b(W,null,[p("section",{ref_key:"articlesElement",ref:c,role:"group","aria-label":"Articles",class:"relative flex-1 space-y-4 px-4 pt-4"},[(r(!0),b(W,null,Ie(m(h),(n,$)=>{var L,z,T,B,j,l;return r(),b(W,{key:n.key},[n.type==="article-bubble"?(r(),C(Rt,{key:0,content:n.article.bodyWithUrls,user:n.article.author,internal:n.article.internal,"content-type":n.article.contentType,position:((L=n.article.sender)==null?void 0:L.name)!==m(Ce).Customer?"left":"right","media-error":(z=n.article.mediaErrorState)==null?void 0:z.error,security:n.article.securityState,"ticket-internal-id":g.ticket.internalId,"article-id":n.article.id,attachments:i(n.article),"remote-content-warning":s(n.article),reaction:(j=(B=(T=n.article.preferences)==null?void 0:T.whatsapp)==null?void 0:B.reaction)==null?void 0:j.emoji,onSeen:A=>k(n.key),onShowContext:A=>m(_)(n.article,g.ticket)},null,8,["content","user","internal","content-type","position","media-error","security","ticket-internal-id","article-id","attachments","remote-content-warning","reaction","onSeen","onShowContext"])):f("",!0),n.type==="delivery"?(r(),C(Pt,{key:1,content:n.content,gap:((l=m(h)[$-1])==null?void 0:l.type)==="article-bubble"?"big":"small",onSeen:A=>k(n.key)},null,8,["content","gap","onSeen"])):f("",!0),n.type==="system"?(r(),C(Zt,{key:2,to:n.to,subject:n.subject,reaction:n.reaction,onSeen:A=>k(n.key)},null,8,["to","subject","reaction","onSeen"])):f("",!0),n.type==="date"?(r(),C(Ut,{key:3,date:n.date},null,8,["date"])):f("",!0),n.type==="new"?(r(),C(Jt,{key:4})):f("",!0),n.type==="more"?(r(),C(Qt,{key:5,count:n.count,onClick:x[0]||(x[0]=A=>o("load-previous"))},null,8,["count"])):f("",!0)],64)}),128))],512),I(te,{state:m(t),"onUpdate:state":x[1]||(x[1]=n=>He(t)?t.value=n:null),messages:m(v)},null,8,["state","messages"])],64))}}),en={class:"flex flex-1 flex-col items-center justify-center text-center text-sm leading-4"},tn={class:"font-bold"},nn={class:"text-gray"},sn=["aria-label"],rn=["aria-label"],on=["aria-label"],an=H({__name:"TicketDetailViewHeader",props:{ticket:{},liveUserList:{},loadingTicket:{type:Boolean},refetchingTicket:{type:Boolean}},setup(d){const a=d,e=ee(),o=ue({name:"ticket-viewers-dialog",component:()=>de(()=>import("./TicketViewersDialog-BIbuV5ub.js"),__vite__mapDeps([31,32,6,7,4,3,5,8,9,24,2,10,11,25,26,27,28,29,30]))}),v=ue({name:"ticket-header-actions-dialog",component:()=>de(()=>import("./TicketActionsDialog-N0IjNELq.js"),__vite__mapDeps([33,7,3,4,5,2,6,8,9,10,11,34,21,35,24,25,26,27,28,29,30,36,37]))}),t=()=>o.open({name:o.name,liveUsers:q(a,"liveUserList")}),_=()=>{a.ticket&&v.open({name:v.name,ticket:q(a,"ticket")})};return(c,h)=>{var s;const i=P("CommonIcon");return r(),C(mt,{class:"bg-gray-600/90",refetch:c.refetchingTicket||c.loadingTicket,"back-ignore":[`/tickets/${(s=c.ticket)==null?void 0:s.internalId}/information`],"back-url":"/"},{after:F(()=>[I(ce,{loading:c.loadingTicket},{default:F(()=>{var u;return[(u=c.liveUserList)!=null&&u.length?(r(),b("button",{key:0,class:"flex ltr:mr-0.5 rtl:ml-0.5",type:"button","aria-label":c.$t("Show ticket viewers"),onClick:h[0]||(h[0]=k=>t())},[I(me,{class:"z-10",entity:c.liveUserList[0].user,personal:"",size:"xs"},null,8,["entity"]),c.liveUserList.length-1?(r(),b("div",{key:0,class:"z-0 flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-xs text-black select-none ltr:-translate-x-2 rtl:translate-x-2",role:"img","aria-label":c.$t("Ticket has %s viewers",c.liveUserList.length)}," +"+w(c.liveUserList.length-1),9,rn)):f("",!0)],8,sn)):f("",!0),m(e).hasPermission("ticket.agent")?(r(),b("button",{key:1,type:"button","aria-label":c.$t("Show ticket actions"),onClick:h[1]||(h[1]=k=>_())},[I(i,{name:"more",size:"base",decorative:""})],8,on)):f("",!0)]}),_:1},8,["loading"])]),default:F(()=>[p("div",en,[p("div",tn,w(c.ticket&&`#${c.ticket.number}`),1),p("div",nn,w(c.ticket&&c.$t("created %s",c.i18n.relativeDateTime(c.ticket.createdAt))),1)])]),_:1},8,["refetch","back-ignore"])}}}),ln={key:0,class:"text-xs leading-[14px] uppercase ltr:ml-[2px] rtl:mr-[2px]"},cn=H({__name:"CommonTicketEscalationIndicator",props:{escalationAt:{}},setup(d){const a=d,e=ft(q(()=>a.escalationAt));return(o,v)=>{const t=P("CommonIcon");return m(e)!==m(oe).None?(r(),b("div",{key:0,class:M([{"bg-red-dark text-red-bright":m(e)===m(oe).Escalated,"bg-yellow-highlight text-yellow":m(e)===m(oe).Warning},"flex items-center rounded bg-gray-100 py-1 text-black select-none ltr:pr-1.5 ltr:pl-1 rtl:pr-1 rtl:pl-1.5"]),role:"alert"},[I(t,{name:"ticket-escalating",size:"tiny",decorative:""}),o.escalationAt?(r(),b("div",ln,w(o.$t("escalation %s",o.i18n.relativeDateTime(o.escalationAt))),1)):f("",!0)],2)):f("",!0)}}}),un={class:"relative"},dn={class:"border-b-[0.5px] border-white/10 bg-gray-600/90"},mn={class:"flex ltr:mr-3 rtl:ml-3"},pn={class:"flex text-sm leading-4 text-gray-100"},fn={class:"max-w-[40vw] truncate"},yn={class:"line-clamp-3 text-xl leading-7 font-bold break-words"},vn={class:"mt-2 flex flex-wrap gap-2"},gn=H({__name:"TicketDetailViewTitle",props:{ticket:{}},setup(d){const a=d,e=q(a,"ticket"),{isTicketAgent:o,isTicketEditable:v}=pt(e),{hasChannelAlert:t,channelAlert:_}=Oe(e),c=rt(),h=S(()=>{const{customer:i}=a.ticket;if(!i)return"";const{fullname:s}=i;return s==="-"?"":s});return(i,s)=>{var x;const u=P("CommonIcon"),k=P("CommonLink"),g=P("CommonAlert");return r(),b("div",un,[p("div",dn,[I(k,{class:"flex px-4 py-5",link:`/tickets/${i.ticket.internalId}/information`},{default:F(()=>{var n;return[p("div",mn,[I(me,{class:"z-10",entity:i.ticket.customer},null,8,["entity"]),i.ticket.organization?(r(),C(Ze,{key:0,class:"z-0 ltr:-translate-x-1 rtl:translate-x-1",entity:i.ticket.organization},null,8,["entity"])):f("",!0)]),p("div",{class:M(["overflow-hidden ltr:mr-1 rtl:ml-1",{"ltr:-ml-1 rtl:-mr-1":i.ticket.organization}])},[p("div",pn,[p("div",{class:M(["truncate",{"max-w-[80vw]":!i.ticket.organization,"max-w-[40vw]":i.ticket.organization}])},w(h.value),3),i.ticket.organization?(r(),b(W,{key:0},[s[0]||(s[0]=p("div",{class:"px-1"},"·",-1)),p("div",fn,w(i.ticket.organization.name),1)],64)):f("",!0)]),p("h1",yn,w(i.ticket.title),1),p("div",vn,[m(o)&&i.ticket.escalationAt?(r(),C(cn,{key:0,"escalation-at":i.ticket.escalationAt},null,8,["escalation-at"])):f("",!0),I(at,{"color-code":i.ticket.stateColorCode,label:i.ticket.state.name,pill:""},null,8,["color-code","label"]),m(o)?(r(),C(yt,{key:1,priority:i.ticket.priority},null,8,["priority"])):f("",!0)])],2),I(u,{name:`chevron-${((n=m(c).localeData)==null?void 0:n.dir)==="rtl"?"left":"right"}`,size:"base",class:"shrink-0 self-center ltr:-mr-2 ltr:ml-auto rtl:mr-auto rtl:-ml-2",decorative:""},null,8,["name"])]}),_:1},8,["link"])]),m(o)&&m(v)&&m(t)?(r(),C(g,{key:0,class:"rounded-b-lg",variant:(x=m(_))==null?void 0:x.variant},{default:F(()=>{var n,$;return[K(w(i.$t((n=m(_))==null?void 0:n.text,($=m(_))==null?void 0:$.textPlaceholder)),1)]}),_:1},8,["variant"])):f("",!0)])}}}),ie=new Set,bn=()=>{const d=ot(),a=S(()=>Number(d.config.ticket_articles_min??5));return{ticketArticlesMin:a,allTicketArticlesLoaded:t=>ie.has(t),markTicketArticlesLoaded:t=>{ie.add(t)},getTicketArticlesQueryVariables:t=>ie.has(t)?{ticketId:t,loadFirstArticles:!1,pageSize:100}:{ticketId:t,pageSize:a.value}}},Zn=H({__name:"TicketDetailArticlesView",props:{internalId:{}},setup(d){var ve,ge;const a=d,e=S(()=>Xe("Ticket",a.internalId)),{ticket:o,liveUserList:v,ticketQuery:t,scrolledToBottom:_,newArticlesIds:c,scrollDownState:h}=ne(),i=y=>(_.value=!0,y.scrollIntoView({behavior:"smooth",block:"start"}),!0),s=ee(),u=async(y,E=new Date().getTime())=>{if(new Date().getTime()-E>=5e3||typeof document>"u")return;const D=document.querySelector(`#article-${y}`);if(!D)return new Promise(N=>requestAnimationFrame(N)).then(()=>u(y,E));D.dataset.createdBy===s.userId&&D.scrollIntoView({behavior:"smooth",block:"start"})},k=()=>{var D;const y=((D=document.querySelector("main"))==null?void 0:D.scrollHeight)||window.innerHeight,E=window.scrollY+window.innerHeight;return y-E<20},g=()=>{var E;return(((E=document.querySelector("main"))==null?void 0:E.scrollHeight)||window.innerHeight)>window.innerHeight},x=({updates:y,previousArticlesEdges:E,previousArticlesEdgesCount:V,articlesQuery:D,result:N,allArticleLoaded:se,refetchArticlesQuery:re})=>{var be,ke,he,we;h.value=g(),c.add((be=y==null?void 0:y.addArticle)==null?void 0:be.id),u(Se((ke=y==null?void 0:y.addArticle)==null?void 0:ke.id));const ze=!E[V-1]||((he=y==null?void 0:y.addArticle)==null?void 0:he.createdAt)<=E[V-1].node.createdAt;!se.value||ze?re(null):D.fetchMore({variables:{pageSize:100,loadFirstArticles:!1,afterCursor:(we=N.value)==null?void 0:we.articles.pageInfo.endCursor}})},{ticketArticlesMin:n,markTicketArticlesLoaded:$,getTicketArticlesQueryVariables:L}=bn(),{articlesQuery:z,articleResult:T}=Ke(e,{firstArticlesCount:n,pageSize:L(e.value).pageSize,onAddArticleCallback:x}),B=async()=>{var y;$(e.value),await z.fetchMore({variables:{pageSize:100,loadFirstArticles:!1,beforeCursor:(y=T.value)==null?void 0:y.articles.pageInfo.startCursor}})},j=S(()=>t.loading().value&&!o.value),l=S(()=>t.loading().value&&!!o.value),A=S(()=>{var y;return((y=T.value)==null?void 0:y.articles.totalCount)||0}),Y=y=>new Date(y).getTime(),Q=S(()=>{var D,N;if(!T.value)return[];const y=et(T.value.articles),E=T.value.articles.totalCount||0,V=(N=(D=T.value.firstArticles)==null?void 0:D.edges[0])==null?void 0:N.node;return E>y.length&&V&&y.unshift(V),y.sort((se,re)=>Y(se.createdAt)-Y(re.createdAt))});it({title:S(()=>{if(!o.value)return"";const{number:y,title:E}=o.value;return`#${y} - ${E}`})}),T.value&&((ge=(ve=window.history)==null?void 0:ve.state)!=null&&ge.scroll)&&(_.value=!0);const R=Re();let Z=!1;const Te=async()=>{var V;if(R.hash){const D=document.querySelector(R.hash);if(D)return i(D);if(!D&&!Z){Z=!0,await B();const N=document.querySelector(R.hash);if(N)return i(N)}}const y=(V=Q.value[Q.value.length-1])==null?void 0:V.internalId;if(!y)return!1;const E=await tt(`#article-${y}`);return E?i(E):!1},Ee=Ae(()=>Q.value.length,async()=>{if(Q.value.length===0)return;g()&&!k()&&(h.value=!0),await Te()&&Ee()},{immediate:!0,flush:"post"}),{stickyStyles:ye,headerElement:Me}=Pe([j,o]);return je(window.document,"scroll",()=>{h.value=!k()},{passive:!0}),(y,E)=>(r(),b(W,null,[p("div",{id:"ticket-header",ref_key:"headerElement",ref:Me,class:"relative backdrop-blur-lg",style:$e(m(ye).header)},[I(an,{ticket:m(o),"live-user-list":m(v),"loading-ticket":j.value,"refetching-ticket":l.value},null,8,["ticket","live-user-list","loading-ticket","refetching-ticket"]),I(ce,{loading:j.value,class:"flex border-b-[0.5px] border-white/10 bg-gray-600/90 px-4 py-5"},{default:F(()=>[m(o)?(r(),C(gn,{key:0,ticket:m(o)},null,8,["ticket"])):f("",!0)]),_:1},8,["loading"])],4),p("div",{id:"ticket-articles-list",class:"flex flex-1 flex-col",style:$e(m(ye).body)},[I(ce,{loading:j.value,class:"mt-2"},{default:F(()=>[m(o)?(r(),C(Xt,{key:0,ticket:m(o),articles:Q.value,"total-count":A.value,onLoadPrevious:B},null,8,["ticket","articles","total-count"])):f("",!0)]),_:1},8,["loading"])],4)],64))}});export{Zn as default};
//# sourceMappingURL=TicketDetailArticlesView-Cye8cs8g.js.map
