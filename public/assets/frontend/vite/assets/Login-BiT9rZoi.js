import{f as E,ap as J,a1 as A,m as t,D as x,y as b,p as u,I as h,M as i,q as v,Q as $,u as e,E as w,J as T,x as K,c as B,r as I,k as Z,ar as ee,L as te}from"./vue-oicRkvo0.js";import{U as R,c as N,m as oe,M as ne,N as z}from"./apollo-Cj5TVUDk.js";import{u as se,a as re}from"./twoFactorMethodInitiateAuthentication.api-DmImhgjQ.js";import{e as Q,F as ae,T as ie,R as le}from"./routes-CgLO9M4y.js";import{u as W,e as ce,_ as ue,a as me,b as de}from"./mobile-Bk4bKGxF.js";import{u as pe}from"./usePublicLinks-CDMBq4UM.js";import{_ as U}from"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import{u as Y}from"./useForm-CUKec4n5.js";import{Y as fe,a4 as G}from"./overviewAttributes.api-C09LSZ8O.js";import{_ as _e,a as he}from"./LoginHeader.vue_vue_type_script_setup_true_lang-D6jjjg_P.js";import{_ as ye}from"./CommonLoader.vue_vue_type_script_setup_true_lang-BtrvaoyW.js";import"./vendor-C11O1Xx8.js";import"./commonjsHelpers-BosuxZz1.js";import"./lodash-pFOI14f-.js";import"./vite-FJshFMF2.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./formkit-5nol1GBe.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./CommonLogo.vue_vue_type_script_setup_true_lang-xQq9wMEL.js";import"./useLogoUrl-8sIhej5J.js";const ge={key:0,class:"mt-4 flex grow items-center justify-center"},we={class:"ltr:mr-1 rtl:ml-1"},ve=E({__name:"LoginCredentialsForm",emits:["error","finish","ask-two-factor"],setup(M,{emit:y}){const r=y,m=Q(),{forceDesktop:n}=W(),o=fe([{isLayout:!0,component:"FormGroup",children:[{name:"login",type:"text",label:__("Username / Email"),placeholder:__("Username / Email"),required:!0}]},{isLayout:!0,component:"FormGroup",children:[{name:"password",label:__("Password"),placeholder:__("Password"),type:"password",required:!0}]},{isLayout:!0,element:"div",attrs:{class:"mt-2.5 flex grow items-center justify-between text-white"},children:[{type:"checkbox",name:"rememberMe",label:__("Remember me"),wrapperClass:"!h-6"},...m.config.user_lost_password?[{isLayout:!0,component:"CommonLink",props:{class:"text-right text-white",link:"/#password_reset",onClick:n},children:__("Forgot password?")}]:[]]}]),{form:C,isDisabled:p}=Y(),{clearAllNotifications:F}=N(),f=G(),k=J(),g=l=>(F(),f.login(l).then(({twoFactor:s,afterAuth:c})=>{if(c)return ce(k,c);!s||!s.defaultTwoFactorAuthenticationMethod?r("finish"):r("ask-two-factor",s,l)}).catch(s=>{s instanceof R&&r("error",s)}));return(l,s)=>{const c=A("CommonLink"),d=A("FormKit");return t(),x(U,{id:"signin",ref_key:"form",ref:C,class:"text-left",schema:e(o),onSubmit:s[0]||(s[0]=a=>g(a))},{"after-fields":b(()=>[l.$c.user_create_account?(t(),u("div",ge,[h("span",we,i(l.$t("New user?")),1),v(c,{link:"/#signup",class:"!text-yellow cursor-pointer underline select-none",onClick:e(n)},{default:b(()=>[$(i(l.$t("Register")),1)]),_:1},8,["onClick"])])):w("",!0),v(d,{"wrapper-class":"mt-6 flex grow justify-center items-center","input-class":"py-2 px-4 w-full h-14 text-xl rounded-xl select-none",variant:"submit",type:"submit",disabled:e(p)},{default:b(()=>[$(i(l.$t("Sign in")),1)]),_:1},8,["disabled"])]),_:1},8,["schema"])}}}),be=E({__name:"LoginRecoveryCode",props:{credentials:{}},emits:["finish","error"],setup(M,{emit:y}){const r=M,m=y,n=[{isLayout:!0,component:"FormGroup",props:{help:__("Enter one of your unused recovery codes.")},children:[{type:"text",name:"code",label:__("Recovery Code"),required:!0}]}],{clearAllNotifications:o}=N(),C=G(),{form:p,isDisabled:F}=Y(),f=k=>{o();const{login:g,password:l,rememberMe:s}=r.credentials;return C.login({login:g,password:l,rememberMe:s,recoveryCode:k.code}).then(()=>{m("finish")}).catch(c=>{c instanceof R&&m("error",c)})};return(k,g)=>{const l=A("FormKit");return t(),x(U,{ref_key:"form",ref:p,schema:n,onSubmit:g[0]||(g[0]=s=>f(s))},{"after-fields":b(()=>[v(l,{"wrapper-class":"mt-6 flex grow justify-center items-center","input-class":"py-2 px-4 w-full h-14 text-xl rounded-xl select-none",variant:"submit",type:"submit",disabled:e(F)},{default:b(()=>[$(i(k.$t("Sign in")),1)]),_:1},8,["disabled"])]),_:1},512)}}}),ke={class:"mt-4 mb-16 w-full max-w-md"},xe={class:"p-3 text-center"},$e={class:"-m-2 flex flex-wrap p-1"},Ce=["action"],Fe=["value"],Le={class:"m-1 flex h-14 w-full cursor-pointer items-center justify-center rounded-xl bg-gray-600 px-4 py-2 text-white select-none"},Me={class:"truncate text-xl leading-7"},Ae=E({__name:"LoginThirdParty",props:{providers:{}},setup(M){const y=M,r=oe(),{fingerprint:m}=ae();return(n,o)=>{const C=A("CommonIcon");return t(),u("section",ke,[h("p",xe,i(n.$c.user_show_password_login?n.$t("Or sign in using"):n.$t("Sign in using")),1),h("div",$e,[(t(!0),u(T,null,K(y.providers,p=>(t(),u("form",{key:p.name,class:"flex min-w-1/2 grow",method:"post",action:`${p.url}?fingerprint=${e(m)}`},[h("input",{type:"hidden",name:"authenticity_token",value:e(r)},null,8,Fe),h("button",Le,[v(C,{name:p.icon,size:"base",decorative:"",class:"shrink-0 ltr:mr-2.5 rtl:ml-2.5"},null,8,["name"]),h("span",Me,i(n.$t(p.label)),1)])],8,Ce))),128))])])}}}),Se={key:1,class:"flex flex-col items-center justify-center"},Te={class:"text-gray pt-2 pb-2 leading-4 font-medium"},Ee=E({__name:"LoginTwoFactor",props:{credentials:{},twoFactor:{}},emits:["finish","error"],setup(M,{emit:y}){const r=M,m=y,n=B(()=>r.twoFactor.loginOptions),o=[{isLayout:!0,component:"FormGroup",props:{help:B(()=>n.value.helpMessage)},children:[{type:"text",name:"code",label:__("Security Code"),required:!0,props:{autocomplete:"one-time-code",autofocus:!0,inputmode:"numeric",pattern:"[0-9]*"}}]}],{clearAllNotifications:C}=N(),p=G(),F=I(!1),f=I(null),k=I(!0),g=s=>{C();const{login:c,password:d,rememberMe:a}=r.credentials;return p.login({login:c,password:d,rememberMe:a,twoFactorAuthentication:{payload:s,method:r.twoFactor.name}}).then(()=>{k.value=!1,m("finish")}).catch(P=>{P instanceof R&&m("error",P)})},l=async()=>{var c;if(!n.value.setup)return;const s=new ne(se());f.value=null,F.value=!0;try{const d=await s.send({twoFactorMethod:r.twoFactor.name,password:r.credentials.password,login:r.credentials.login});if(!((c=d==null?void 0:d.twoFactorMethodInitiateAuthentication)!=null&&c.initiationData)){f.value=__("Two-factor authentication method could not be initiated.");return}const a=await n.value.setup(d.twoFactorMethodInitiateAuthentication.initiationData);k.value=a.retry??!0,a!=null&&a.success?await g(a.payload):a!=null&&a.error&&(f.value=a.error)}catch(d){d instanceof R&&(f.value=d.errors[0].message)}finally{F.value=!1}};return Z(async()=>{await l()}),(s,c)=>{const d=A("FormKit");return n.value.form!==!1?(t(),x(U,{key:0,schema:o,onSubmit:c[0]||(c[0]=a=>g(a.code))},{"after-fields":b(()=>[v(d,{"wrapper-class":"mt-6 flex grow justify-center items-center","input-class":"py-2 px-4 w-full h-14 text-xl rounded-xl select-none",variant:"submit",type:"submit"},{default:b(()=>[$(i(s.$t("Sign in")),1)]),_:1})]),_:1})):n.value.setup?(t(),u("section",Se,[v(ye,{loading:F.value,error:f.value},null,8,["loading","error"]),h("div",Te,[f.value&&n.value.errorHelpMessage?(t(),u(T,{key:0},[$(i(s.$t(n.value.errorHelpMessage)),1)],64)):n.value.helpMessage?(t(),u(T,{key:1},[$(i(s.$t(n.value.helpMessage)),1)],64)):w("",!0)]),!F.value&&k.value?(t(),x(ue,{key:0,variant:"primary",class:"mt-3 px-5 py-2 text-base",onClick:l},{default:b(()=>[$(i(s.$t("Retry")),1)]),_:1})):w("",!0)])):w("",!0)}}}),Pe=E({__name:"LoginTwoFactorMethods",props:{methods:{},recoveryCodesAvailable:{type:Boolean}},emits:["select","use-recovery-code"],setup(M,{emit:y}){const r=y;return(m,n)=>(t(),u(T,null,[v(de,null,{default:b(()=>[(t(!0),u(T,null,K(m.methods,o=>(t(),x(me,{key:o.name,label:o.label,icon:o.icon,onClick:C=>r("select",o.name)},null,8,["label","icon","onClick"]))),128))]),_:1}),m.recoveryCodesAvailable?(t(),u("button",{key:0,class:"text-gray mb-6 w-full max-w-md text-center font-semibold",onClick:n[0]||(n[0]=o=>r("use-recovery-code"))},i(m.$t("Or use one of your recovery codes.")),1)):w("",!0)],64))}}),Re={class:"flex h-full min-h-screen flex-col items-center px-6 pt-6 pb-4"},Ne={key:0,class:"flex w-full"},je=["aria-label"],qe={class:"m-auto w-full max-w-md"},De={class:"flex grow flex-col justify-center"},Ie={class:"my-5 grow"},Be={key:0,class:"text-center"},Ke={key:2,class:"mb-6 w-full max-w-md text-center"},Ue={key:3,class:"text-gray pb-2 leading-4 font-medium"},Ge={key:4,class:"mt-4 flex w-full max-w-md flex-wrap items-center justify-center gap-1"},pt=E({__name:"Login",setup(M){const y=ee(),r=J(),{notify:m,clearAllNotifications:n}=N();y.query.invalidatedSession==="1"&&(m({id:"invalid-session",message:__("The session is no longer valid. Please log in again."),type:z.Warn}),r.replace({name:"Login"}));const{loginFlow:o,askTwoFactor:C,twoFactorPlugin:p,twoFactorAllowedMethods:F,updateState:f,updateSecondFactor:k,hasAlternativeLoginMethod:g,goBack:l,statePreviousMap:s,loginPageTitle:c}=re(n),d=Q(),{links:a}=pe(ie.Login),{enabledProviders:P,hasEnabledProviders:H}=le(),O=B(()=>d.config.user_show_password_login||!H.value),{forceDesktop:V}=W(),j=()=>{const{redirect:_}=y.query;typeof _=="string"?r.replace(_):r.replace("/")},q=_=>{m({id:"login-error",message:_.generalErrors[0],type:z.Error})};return(_,S)=>{const X=A("CommonIcon"),D=A("CommonLink");return t(),u("div",Re,[e(s)[e(o).state]?(t(),u("div",Ne,[h("button",{class:"cursor-pointer","aria-label":_.__("Go back"),onClick:S[0]||(S[0]=(...L)=>e(l)&&e(l)(...L))},[v(X,{name:"chevron-left",decorative:""})],8,je)])):w("",!0),h("main",qe,[h("div",De,[h("div",Ie,[v(_e,{title:e(c)},null,8,["title"]),e(o).state==="credentials"&&O.value?(t(),x(ve,{key:0,onAskTwoFactor:e(C),onError:q,onFinish:j},null,8,["onAskTwoFactor"])):e(o).state==="2fa"&&e(p)&&e(o).credentials?(t(),x(Ee,{key:1,credentials:e(o).credentials,"two-factor":e(p),onError:q,onFinish:j},null,8,["credentials","two-factor"])):e(o).state==="recovery-code"&&e(o).credentials?(t(),x(be,{key:2,credentials:e(o).credentials,onError:q,onFinish:j},null,8,["credentials"])):e(o).state==="2fa-select"?(t(),x(Pe,{key:3,methods:e(F),"recovery-codes-available":e(o).recoveryCodesAvailable,onSelect:e(k),onUseRecoveryCode:S[1]||(S[1]=L=>e(f)("recovery-code"))},null,8,["methods","recovery-codes-available","onSelect"])):w("",!0)])]),(e(o).state==="2fa"||e(o).state==="recovery-code")&&e(g)?(t(),u("section",Be,[$(i(_.$t("Having problems?"))+" ",1),h("button",{class:"text-gray cursor-pointer pb-2 leading-4 font-semibold",onClick:S[2]||(S[2]=te(L=>e(f)("2fa-select"),["prevent"]))},i(_.$t("Try another method")),1)])):w("",!0)]),e(H)&&e(o).state==="credentials"?(t(),x(Ae,{key:1,providers:e(P)},null,8,["providers"])):w("",!0),O.value?w("",!0):(t(),u("section",Ke,[h("p",null,i(_.$t("If you have problems with the third-party login you can request a one-time password login as an admin.")),1),v(D,{link:"/#admin_password_auth",class:"text-gray font-semibold",onClick:e(V)},{default:b(()=>[$(i(_.$t("Request the password login here.")),1)]),_:1},8,["onClick"])])),e(o).state!=="credentials"&&!e(g)?(t(),u("div",Ue,i(_.$t("Contact the administrator if you have any problems logging in.")),1)):w("",!0),v(D,{link:"/#login",class:"text-gray leading-4 font-medium",onClick:e(V)},{default:b(()=>[$(i(_.$t("Continue to desktop")),1)]),_:1},8,["onClick"]),e(a).length?(t(),u("nav",Ge,[(t(!0),u(T,null,K(e(a),L=>(t(),x(D,{key:L.id,link:L.link,title:L.description,"open-in-new-tab":L.newTab,class:"text-gray leading-4 font-semibold tracking-wide after:ml-1 after:font-medium after:text-gray-200 after:content-['|'] last:after:content-none"},{default:b(()=>[$(i(_.$t(L.title)),1)]),_:2},1032,["link","title","open-in-new-tab"]))),128))])):w("",!0),v(he)])}}});export{pt as default};
//# sourceMappingURL=Login-BiT9rZoi.js.map
