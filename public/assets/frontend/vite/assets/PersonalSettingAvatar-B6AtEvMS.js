import{n as F,u as G}from"./vendor-C11O1Xx8.js";import{f as j}from"./style-CXWFjTBn.js";import{f as O,ap as P,s as g,r as V,d as Z,w as J,c as v,u as l,m as d,p as z,I as m,q as u,y as _,D as I,Q as x,M as w,E as D}from"./vue-oicRkvo0.js";import{b7 as K,_ as W,b8 as R,aZ as X,a2 as Y}from"./overviewAttributes.api-C09LSZ8O.js";import{u as ee,Q as ae,M,N as te,c as re}from"./apollo-Cj5TVUDk.js";import{u as se,a as ie}from"./userCurrentAvatarDelete.api-BdjimpWn.js";import{a as oe}from"./routes-CgLO9M4y.js";import{_ as N}from"./mobile-Bk4bKGxF.js";import{_ as ne}from"./CommonButtonGroup.vue_vue_type_script_setup_true_lang-BTHDtl8G.js";import{_ as le}from"./CommonLoader.vue_vue_type_script_setup_true_lang-BtrvaoyW.js";import{u as ue}from"./useHeader-B3UlgUtw.js";import"./commonjsHelpers-BosuxZz1.js";import"./lodash-pFOI14f-.js";import"./formkit-5nol1GBe.js";import"./vite-FJshFMF2.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";const ce=F`
    query userCurrentAvatarActive {
  userCurrentAvatarActive {
    id
    default
    deletable
    initial
    imageFull
    imageResize
    createdAt
    updatedAt
  }
}
    `;function ve(A={}){return ee(ce,{},A)}const de={key:0,class:"px-4"},me={class:"flex flex-col items-center py-6"},fe=["accept"],pe=["accept"],ge={key:0,class:"flex w-full flex-col items-center justify-center"},_e={class:"flex w-full gap-2"},Be=O({__name:"PersonalSettingAvatar",setup(A){var C;const T=P(),f=g(),p=g(),s=g(),c=new ae(ve(),{errorNotificationMessage:__("The avatar could not be fetched.")}),t=V();c.watchOnResult(e=>{t.value=e==null?void 0:e.userCurrentAvatarActive});const y=c.loading(),i=Z({resizedImage:((C=t.value)==null?void 0:C.imageResize)||""});J(t,e=>{i.resizedImage=(e==null?void 0:e.imageResize)||""});const{user:n}=G(oe()),$=v(()=>{var e;return!((e=t.value)!=null&&e.deletable)}),Q=()=>{if(!i.resizedImage||!s.value)return;const e=new M(se({variables:{images:{original:s.value,resized:{name:"resized_avatar.png",type:"image/png",content:i.resizedImage}}}}),{errorNotificationMessage:__("The avatar could not be uploaded.")}),{notify:a,clearAllNotifications:o}=re();o(),e.send().then(r=>{var k;(k=r==null?void 0:r.userCurrentAvatarAdd)!=null&&k.avatar&&(t.value=r.userCurrentAvatarAdd.avatar,s.value=void 0,n.value&&(n.value.image=r.userCurrentAvatarAdd.avatar.imageHash))}).catch(r=>{a({id:"avatar-add-error",message:r.generalErrors[0],type:te.Error})})},b=()=>{var e,a;return!(!n.value||!((e=t.value)!=null&&e.id)||!((a=t.value)!=null&&a.deletable))},S=()=>{var a;if(!b()||!((a=t.value)!=null&&a.id))return;new M(ie({variables:{id:t.value.id}}),{errorNotificationMessage:__("The avatar could not be deleted.")}).send().then(o=>{var r;(r=o==null?void 0:o.userCurrentAvatarDelete)!=null&&r.success&&(i.resizedImage="",s.value=void 0,t.value=void 0,n.value&&(n.value.image=void 0))})},{waitForConfirmation:U}=Y(),B=async()=>{if(!b())return;await U(__("Do you really want to delete your current avatar?"),{buttonLabel:__("Delete avatar"),buttonVariant:"danger"})&&S()},L=v(()=>!!(i.resizedImage&&s.value));ue({title:__("Avatar"),backUrl:"/account",actionTitle:__("Done"),backIgnore:["/user/current/avatar"],refetch:v(()=>y.value&&!!c.result().value),onAction(){T.push("/account")}});const h=async e=>{const a=e==null?void 0:e.files;if(!a)return;const[o]=await X(a);s.value=o,e.value=""},E=e=>{e.canvas&&(i.resizedImage=e.canvas.toDataURL("image/png"))},H=()=>{var e;s.value=void 0,i.resizedImage=((e=t.value)==null?void 0:e.imageResize)||""},q=v(()=>[{label:__("Library"),icon:"photos",value:"library",onAction:()=>{var e;return(e=p.value)==null?void 0:e.click()}},{label:__("Camera"),icon:"camera",value:"camera",onAction:()=>{var e;return(e=f.value)==null?void 0:e.click()}},{label:__("Delete"),icon:"delete",value:"delete",disabled:$.value,class:"bg-red-dark !text-red-bright",onAction:B}]);return(e,a)=>l(n)?(d(),z("div",de,[m("div",me,[u(le,{loading:l(y)&&!l(c).result().value},{default:_(()=>[i.resizedImage?(d(),I(K,{key:0,image:i.resizedImage,size:"xl"},null,8,["image"])):(d(),I(W,{key:1,entity:l(n),size:"xl",personal:""},null,8,["entity"])),u(ne,{class:"mt-6",mode:"full",options:q.value},null,8,["options"])]),_:1},8,["loading"]),m("input",{ref_key:"fileGalleryInput",ref:p,type:"file",class:"hidden","aria-hidden":"true",accept:l(R)(),onChange:a[0]||(a[0]=o=>h(p.value))},null,40,fe),m("input",{ref_key:"fileCameraInput",ref:f,type:"file",class:"hidden","aria-hidden":"true",accept:l(R)(),capture:"user",onChange:a[1]||(a[1]=o=>h(f.value))},null,40,pe),s.value?(d(),z("div",ge,[u(l(j),{class:"mt-4 mb-4 !max-h-[250px] !max-w-[400px]",src:s.value.content,"stencil-props":{aspectRatio:1},transitions:!1,"background-class":"!bg-black","foreground-class":"!bg-black",onChange:E},null,8,["src"]),m("div",_e,[u(N,{class:"h-10 flex-1",onClick:H},{default:_(()=>[x(w(e.$t("Cancel")),1)]),_:1}),u(N,{variant:"primary",disabled:!L.value,class:"h-10 flex-1",onClick:Q},{default:_(()=>[x(w(e.$t("Save")),1)]),_:1},8,["disabled"])])])):D("",!0)])])):D("",!0)}});export{Be as default};
//# sourceMappingURL=PersonalSettingAvatar-B6AtEvMS.js.map
