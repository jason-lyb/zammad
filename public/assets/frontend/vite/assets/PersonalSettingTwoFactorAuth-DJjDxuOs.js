const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TwoFactorConfigurationFlyout-CrehsizT.js","assets/routes-CgLO9M4y.js","assets/vite-FJshFMF2.js","assets/vendor-C11O1Xx8.js","assets/vue-oicRkvo0.js","assets/commonjsHelpers-BosuxZz1.js","assets/apollo-Cj5TVUDk.js","assets/lodash-pFOI14f-.js","assets/CommonFlyout.vue_vue_type_script_setup_true_lang-Cr1ukr3s.js","assets/overviewAttributes.api-C09LSZ8O.js","assets/formkit-5nol1GBe.js","assets/overviewAttributes-r_4zXopK.css","assets/desktop-l0eJ1dZN.js","assets/Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js","assets/FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js","assets/Form-BSACsGR2.css","assets/useForm-CUKec4n5.js","assets/useCopyToClipboard-CjkPg__g.js","assets/theme-Bv2ClBzZ.js","assets/datepicker-BBNcWeHz.js","assets/date-B2UyDZN7.js","assets/autocompleteTags.api-CG5-cm_A.js","assets/autocompleteSearchTicket.api-DfOQWGlO.js","assets/ticketUpdates.api-BhGIG_Ti.js","assets/ticketAttributes.api-rqx5ITab.js","assets/useTicketCreateArticleType-D7iVcJ_6.js","assets/types-Cu-Nkl7K.js","assets/useTicketCreateView-HCH46SPv.js","assets/desktop-BAkSnNV9.css","assets/CommonOverlayContainer.vue_vue_type_script_setup_true_lang-CxyKmNUC.js","assets/LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js","assets/useFlyout-KZXqW5RR.js"])))=>i.map(i=>d[i]);
import{_ as X}from"./vite-FJshFMF2.js";import{c as p,w as j,f as K,ap as W,a1 as A,m as i,D as C,y as c,I as h,q as _,Q as l,M as d,p as B,x as Y,E as g,u as b,J as L}from"./vue-oicRkvo0.js";import{e as q,a as Z,S as ee,E as I,M as O,N as V,c as oe}from"./apollo-Cj5TVUDk.js";import{f as H,a as G}from"./routes-CgLO9M4y.js";import{n as U,u as te}from"./vendor-C11O1Xx8.js";import{X as J,aT as P,aU as z}from"./overviewAttributes.api-C09LSZ8O.js";import{b as re,c as ae}from"./desktop-l0eJ1dZN.js";import{u as se}from"./useFlyout-KZXqW5RR.js";import{a as ne}from"./LayoutContent.vue_vue_type_script_setup_true_lang-SafgfcNL.js";import{u as ue}from"./useBreadcrumb-DUhE6wbZ.js";import"./lodash-pFOI14f-.js";import"./commonjsHelpers-BosuxZz1.js";import"./formkit-5nol1GBe.js";import"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./useForm-CUKec4n5.js";import"./useCopyToClipboard-CjkPg__g.js";import"./theme-Bv2ClBzZ.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js";import"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";import"./useResizeGridColumns-CieKHty_.js";const ce=U`
    mutation userCurrentTwoFactorRemoveMethod($methodName: String!, $token: String!) {
  userCurrentTwoFactorRemoveMethod(methodName: $methodName, token: $token) {
    success
    errors {
      ...errors
    }
  }
}
    ${J}`;function ie(a={}){return q(ce,a)}const le=U`
    mutation userCurrentTwoFactorSetDefaultMethod($methodName: String!) {
  userCurrentTwoFactorSetDefaultMethod(methodName: $methodName) {
    success
    errors {
      ...errors
    }
  }
}
    ${J}`;function de(a={}){return q(le,a)}const me=U`
    subscription userCurrentTwoFactorUpdates {
  userCurrentTwoFactorUpdates {
    configuration {
      recoveryCodesExist
      enabledAuthenticationMethods {
        configured
        authenticationMethod
      }
    }
  }
}
    `;function fe(a={}){return Z(me,{},a)}const pe=()=>{const{twoFactorEnabledMethods:a,hasEnabledMethods:T,hasEnabledRecoveryCodes:$}=H(),F=G(),{user:N}=te(F),D=p(()=>{var o,s,r;return(r=(s=(o=N.value)==null?void 0:o.preferences)==null?void 0:s.two_factor_authentication)==null?void 0:r.default}),k=new ee(fe()),R=k.result(),v=p(()=>{var o;return(o=R.value)==null?void 0:o.userCurrentTwoFactorUpdates.configuration}),E=p(()=>{var o;return(o=v.value)==null?void 0:o.enabledAuthenticationMethods.reduce((s,r)=>(s[r.authenticationMethod]={...r,default:r.authenticationMethod===D.value},s),{})}),M=p(()=>{const o=[];return a.value.forEach(s=>{var m;const r=(m=E.value)==null?void 0:m[s.name];o.push({...s,configured:!!(r!=null&&r.configured),default:!!(r!=null&&r.default)})}),o}),w=p(()=>Object.values(E.value||{}).some(o=>o.configured)),y=p(()=>{var o;return!!((o=v.value)!=null&&o.recoveryCodesExist)});return j(a,()=>k.operationResult.restart()),{twoFactorConfigurationMethods:M,hasEnabledMethods:T,hasEnabledRecoveryCodes:$,hasConfiguredMethods:w,hasRecoveryCodes:y}},he={class:"flex flex-col gap-2.5"},_e={class:"flex flex-col rounded-lg bg-blue-200 p-1 dark:bg-gray-700"},be={class:"flex grow flex-col gap-0.5"},ve={class:"flex grow gap-1.5"},we={class:"flex justify-end"},Ke=K({beforeRouteEnter(){const{hasEnabledMethods:a}=H();return a.value?!0:P({type:z.AuthenticatedError,title:__("Forbidden"),message:__("There are no enabled two-factor authentication methods."),statusCode:I.Forbidden})},__name:"PersonalSettingTwoFactorAuth",setup(a){const T=G(),$=W(),{notify:F}=oe(),{hasEnabledMethods:N,hasEnabledRecoveryCodes:D,hasConfiguredMethods:k,hasRecoveryCodes:R,twoFactorConfigurationMethods:v}=pe();j(N,e=>{e||$.replace(P({type:z.AuthenticatedError,title:__("Forbidden"),message:__("There are no enabled two-factor authentication methods."),statusCode:I.Forbidden}))});const{breadcrumbItems:E}=ue(__("Two-factor Authentication")),M=se({name:"two-factor-flyout",component:()=>X(()=>import("./TwoFactorConfigurationFlyout-CrehsizT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]))}),w=async e=>M.open({type:e}),y=new O(de(),{errorNotificationMessage:__("Could not set two-factor authentication method as default")}),o=e=>{e&&y.send({methodName:e.name}).then(()=>{var u,t;T.setUserPreference("two_factor_authentication",{...((t=(u=T.user)==null?void 0:u.preferences)==null?void 0:t.two_factor_authentication)||{},default:e.name}),F({id:"two-factor-method-set-default",type:V.Success,message:__("Two-factor authentication method was set as default.")})})},s=new O(ie(),{errorNotificationMessage:__("Could not remove two-factor authentication method.")}),r=async e=>{if(e)return M.open({type:"removal_confirmation",successCallback:async({token:u})=>{var f;const t=await s.send({methodName:e.name,token:u});(f=t==null?void 0:t.userCurrentTwoFactorRemoveMethod)!=null&&f.success&&F({id:"two-factor-method-removed",type:V.Success,message:__("Two-factor authentication method was removed.")})}})},m=(e,u)=>{var f;const t=v.value.find(S=>S.name===e.name);return((f=t==null?void 0:t.configurationOptions)==null?void 0:f.getActionA11yLabel(u))||""},Q=p(()=>[{key:"setup",label:__("Set up"),ariaLabel:e=>m(e,"setup"),icon:"wrench",show:e=>!(e!=null&&e.configured),onClick:e=>w(e==null?void 0:e.name)},{key:"edit",label:__("Edit"),ariaLabel:e=>m(e,"edit"),icon:"pencil",show:e=>!!(e!=null&&e.configured&&(e!=null&&e.configurationOptions.editable)),onClick:e=>w(e==null?void 0:e.name)},{key:"setAsDefault",label:__("Set as default"),ariaLabel:e=>m(e,"default"),icon:"arrow-repeat",show:e=>!!(e!=null&&e.configured&&!(e!=null&&e.default)),onClick:e=>o(e)},{key:"remove",label:__("Remove"),ariaLabel:e=>m(e,"remove"),icon:"trash3",variant:"danger",show:e=>!!(e!=null&&e.configured),onClick:e=>r(e)}]);return(e,u)=>{const t=A("CommonLabel"),f=A("CommonIcon"),S=A("CommonBadge");return i(),C(ne,{"breadcrumb-items":b(E),width:"narrow"},{default:c(()=>[h("div",he,[h("div",null,[_(t,{class:"mb-1.5"},{default:c(()=>[l(d(e.$t("Available methods")),1)]),_:1}),h("div",_e,[(i(!0),B(L,null,Y(b(v),n=>{var x;return i(),B("div",{key:n.name,class:"flex items-start gap-1.5 p-2.5"},[_(f,{class:"text-stone-200 dark:text-neutral-500",name:n.icon,size:"small"},null,8,["name"]),h("div",be,[h("div",ve,[_(t,{class:"text-black dark:text-white"},{default:c(()=>[l(d(e.$t(n.label)),1)]),_:2},1024),n.configured?(i(),C(S,{key:0,variant:"success"},{default:c(()=>[l(d(e.$t("Active")),1)]),_:1})):g("",!0),n.default?(i(),C(S,{key:1,variant:"info"},{default:c(()=>[l(d(e.$t("Default")),1)]),_:1})):g("",!0)]),n.description?(i(),C(t,{key:0,class:"text-stone-200 dark:text-neutral-500",size:"small"},{default:c(()=>[l(d(e.$t(n.description)),1)]),_:2},1024)):g("",!0)]),_(re,{entity:n,"custom-menu-button-label":(x=n.configurationOptions)==null?void 0:x.actionButtonA11yLabel,actions:Q.value},null,8,["entity","custom-menu-button-label","actions"])])}),128))])]),b(k)&&b(D)?(i(),B(L,{key:0},[_(t,null,{default:c(()=>[l(d(e.$t("Recovery codes can be used to access your account in the event you lose access to other two-factor authentication methods.")),1)]),_:1}),b(R)?(i(),C(t,{key:0},{default:c(()=>[l(d(e.$t("If you lose your recovery codes it's possible to generate new ones. This action is going to invalidate previous recovery codes.")),1)]),_:1})):g("",!0),h("div",we,[_(ae,{variant:"submit",type:"submit",size:"medium",onClick:u[0]||(u[0]=n=>w("recovery_codes"))},{default:c(()=>[l(d(b(R)?e.$t("Regenerate Recovery Codes"):e.$t("Generate Recovery Codes")),1)]),_:1})])],64)):g("",!0)])]),_:1},8,["breadcrumb-items"])}}});export{Ke as default};
//# sourceMappingURL=PersonalSettingTwoFactorAuth-DJjDxuOs.js.map
