const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TicketSharedDraftConflictDialog-TzNfyjo2.js","assets/apollo-Cj5TVUDk.js","assets/vue-oicRkvo0.js","assets/vendor-C11O1Xx8.js","assets/commonjsHelpers-BosuxZz1.js","assets/lodash-pFOI14f-.js","assets/CommonDropdown.vue_vue_type_script_setup_true_lang-DOCvnZ_a.js","assets/routes-CgLO9M4y.js","assets/vite-FJshFMF2.js","assets/CommonError.vue_vue_type_script_setup_true_lang-B76hdJ4v.js","assets/LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js","assets/desktop-l0eJ1dZN.js","assets/overviewAttributes.api-C09LSZ8O.js","assets/formkit-5nol1GBe.js","assets/overviewAttributes-r_4zXopK.css","assets/Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js","assets/FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js","assets/Form-BSACsGR2.css","assets/useForm-CUKec4n5.js","assets/useCopyToClipboard-CjkPg__g.js","assets/theme-Bv2ClBzZ.js","assets/datepicker-BBNcWeHz.js","assets/date-B2UyDZN7.js","assets/autocompleteTags.api-CG5-cm_A.js","assets/autocompleteSearchTicket.api-DfOQWGlO.js","assets/ticketUpdates.api-BhGIG_Ti.js","assets/ticketAttributes.api-rqx5ITab.js","assets/useTicketCreateArticleType-D7iVcJ_6.js","assets/types-Cu-Nkl7K.js","assets/useTicketCreateView-HCH46SPv.js","assets/desktop-BAkSnNV9.css","assets/index-DwuY2HL4.js","assets/CommonInlineEdit.vue_vue_type_script_setup_true_lang-Blo3VlqB.js","assets/useHtmlLinks-53b5zJaG.js","assets/pwa-THoW_3xc.js","assets/useBaseUrl-BsZiEKQE.js","assets/useUserDetail-C29_PwWz.js","assets/user.api-BwewaCks.js","assets/ObjectAttributes.vue_vue_type_script_setup_true_lang-B0DrxGTz.js","assets/useDisplayObjectAttributes-sspS-pHp.js","assets/useTicketView-CMOCBKg-.js","assets/useFlyout-KZXqW5RR.js","assets/CommonSectionCollapse.vue_vue_type_script_setup_true_lang-B-hHJAEI.js","assets/LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js","assets/NavigationMenuList.vue_vue_type_script_setup_true_lang-CYOBePFr.js","assets/useTicketAccountedTime-CSL2Xls9.js","assets/useTicketSubscribe-CmWzZx1x.js","assets/useOrganizationDetail-CenI9U-0.js","assets/dom-0wVl69Vp.js","assets/useAttachments-0IU6Vvzp.js","assets/getAttachmentLinks-Dz1qdLDp.js","assets/CommonDialog.vue_vue_type_script_setup_true_lang-OZd3qkEh.js","assets/CommonOverlayContainer.vue_vue_type_script_setup_true_lang-CxyKmNUC.js","assets/ArticleBubbleHeader-Bx1hJ83i.js","assets/useArticleSecurity-D_0zJIjN.js","assets/ticketArticleRetrySecurityProcess.api-pSAexXXb.js","assets/index-D5f5eTVX.js","assets/useTicketSignature-LslYi6X7.js","assets/openExternalLink-B2ZtqYBi.js","assets/useWhatsapp-Da8aokvI.js","assets/ObjectAttribute.vue_vue_type_script_setup_true_lang-S7kCEp8d.js","assets/TimeAccountingFlyout-CxNs2q4Y.js","assets/CommonFlyout.vue_vue_type_script_setup_true_lang-Cr1ukr3s.js"])))=>i.map(i=>d[i]);
import{g as ur,_ as dr,h as lt,i as mr,j as oe,d as ct,k as pr,l as fr,m as vr,A as br,a as hr,u as kr,b as gr,c as yr,p as _r,e as Tr,T as Cr,f as wr}from"./CommonDropdown.vue_vue_type_script_setup_true_lang-DOCvnZ_a.js";import{_ as xe}from"./vite-FJshFMF2.js";import{r as N,c as b,R as Ar,n as te,ar as ut,w as Z,a0 as $r,f as z,m as c,D as w,u as e,t as ee,p as E,J as X,x as ne,M as I,E as C,q as v,y as _,Q as L,I as F,ab as Le,k as Me,a1 as U,K as de,H as M,v as dt,T as ze,z as Ze,a8 as me,U as re,W as pe,aa as Ee,C as Be,a9 as qe,aT as Ir,aU as Sr,aJ as Dr,aX as Er,L as Je,b1 as Br,as as xr,b2 as Lr,a4 as Mr,al as zr,aS as Fr,$ as Ur,a7 as $e,d as Pr,b as Rr,V as Hr,X as Nr,G as Vr}from"./vue-oicRkvo0.js";import{u as Or,a as jr,S as Gr,Q as Wr,e as mt,M as Fe,N as fe,c as ve,k as Qr,U as Kr,G as Xe}from"./apollo-Cj5TVUDk.js";import{_ as Zr}from"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import{u as qr}from"./useForm-CUKec4n5.js";import{X as pt,_ as Ue,aS as Jr,l as ce,i as Xr,ap as ft,aQ as Yr,aL as ea,aW as ta,an as Ie,b3 as Ye,Z as et,aB as ra,a2 as aa}from"./overviewAttributes.api-C09LSZ8O.js";import{n as be,q as oa,u as ae,l as na}from"./vendor-C11O1Xx8.js";import{a6 as K,a as he,e as ke,d as ue,a7 as Se,j as ia,r as sa,a8 as tt}from"./routes-CgLO9M4y.js";import{w as la,v as ca,b as ua,a as da}from"./lodash-pFOI14f-.js";import{u as ma,a as vt,g as pa,b as fa,c as va,d as ba,e as ha}from"./ticketArticleRetrySecurityProcess.api-pSAexXXb.js";import{u as ka,a as ga,b as ya,c as _a}from"./useTicketLiveUserList-fkbxnu3k.js";import{u as Ta}from"./useFlyout-KZXqW5RR.js";import{c as J,j as Ca,b as bt,g as wa,a as ht,f as Aa,D as kt,d as $a}from"./desktop-l0eJ1dZN.js";import{_ as Ia,a as Sa}from"./LayoutContent.vue_vue_type_script_setup_true_lang-SafgfcNL.js";import{u as Da}from"./LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js";import{u as Ea}from"./useTicketLiveUsersDisplay-CMSLuo_a.js";import{c as Ba,u as xa}from"./index-D5f5eTVX.js";import{u as gt,b as La,_ as yt}from"./theme-Bv2ClBzZ.js";import{u as Ma}from"./useColorPallet-BR2oNgrf.js";import"./pwa-THoW_3xc.js";import{u as za}from"./useAttachments-0IU6Vvzp.js";import{u as Fa}from"./useHtmlLinks-53b5zJaG.js";import{u as _t}from"./useArticleSecurity-D_0zJIjN.js";import{b as Ua,c as Pa}from"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";import{u as Ra}from"./useElementScroll-BdrPIdz0.js";import{u as Tt}from"./useTicketView-CMOCBKg-.js";import{u as Ha}from"./useCopyToClipboard-CjkPg__g.js";import{_ as Na}from"./CommonInlineEdit.vue_vue_type_script_setup_true_lang-Blo3VlqB.js";import{u as Va,E as rt}from"./useEscalationState-Dv4jDro1.js";import{_ as Oa}from"./CommonTicketPriorityIndicatorIcon.vue_vue_type_script_setup_true_lang-BmacuuuP.js";import{g as at}from"./getTicketNumber-CTSsSeKd.js";import"./CommonError.vue_vue_type_script_setup_true_lang-B76hdJ4v.js";import"./ticketAttributes.api-rqx5ITab.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./index-DwuY2HL4.js";import"./useUserDetail-C29_PwWz.js";import"./user.api-BwewaCks.js";import"./ObjectAttributes.vue_vue_type_script_setup_true_lang-B0DrxGTz.js";import"./useDisplayObjectAttributes-sspS-pHp.js";import"./CommonSectionCollapse.vue_vue_type_script_setup_true_lang-B-hHJAEI.js";import"./NavigationMenuList.vue_vue_type_script_setup_true_lang-CYOBePFr.js";import"./useTicketAccountedTime-CSL2Xls9.js";import"./useTicketSubscribe-CmWzZx1x.js";import"./formkit-5nol1GBe.js";import"./useOrganizationDetail-CenI9U-0.js";import"./dom-0wVl69Vp.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./commonjsHelpers-BosuxZz1.js";import"./utils-C-eON4SW.js";import"./useObjectAttributeFormData-BTXeBYyl.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./useResizeGridColumns-CieKHty_.js";import"./useBaseUrl-BsZiEKQE.js";import"./useTicketSignature-LslYi6X7.js";import"./openExternalLink-B2ZtqYBi.js";import"./getAttachmentLinks-Dz1qdLDp.js";const ja=be`
    query macros($groupId: ID!) {
  macros(groupId: $groupId) {
    id
    active
    name
    uxFlowNextUp
  }
}
    `;function Ga(s,t={}){return Or(ja,s,t)}const Wa=be`
    subscription macrosUpdate {
  macrosUpdate {
    macroId
    groupIds
    removeMacroId
  }
}
    `;function Qa(s={}){return jr(Wa,{},s)}const Ka=oa("macro",()=>{const s=N([]),t=new Map,r=(a,l)=>{s.value.push(a),t.set(a,l)},o=b(()=>s.value.length>0);return new Gr(Qa(()=>({enabled:o}))).onResult(a=>{var k,f,y;const l=(k=a.data)==null?void 0:k.macrosUpdate.macroId,p=(f=a.data)==null?void 0:f.macrosUpdate.groupIds,g=(y=a.data)==null?void 0:y.macrosUpdate.removeMacroId;if(!l&&!g)return;const u={};t.forEach(d=>{var h;const D=(h=d.operationResult.result.value)==null?void 0:h.macros;if(!D||g&&!D.find(A=>A.id===g))return;const{groupId:m}=Ar(d.operationResult.variables)??{};!m||u[m]||p&&p.length&&!p.includes(m)&&!D.find(A=>A.id===l)||(d.refetch(),u[m]=!0)})}),{usageKeys:s,activate:r,deactivate:a=>{s.value.includes(a)&&te(()=>{s.value=la(s.value,a),t.delete(a)})}}}),Za={next_task:K.CloseTab,next_from_overview:K.CloseNextInOverview,next_task_on_close:K.CloseTabOnTicketClose,none:K.StayOnTab},qa=(s,t)=>{const r=b(()=>!!(t.value&&s.value)),o=new Wr(Ga(()=>({groupId:s.value}),()=>({enabled:r.value}))),{activate:n,deactivate:i}=Ka(),l=ut().meta.taskbarTabEntityKey??"apply-template";Z(r,u=>{u?n(l,o):i(l)},{immediate:!0}),$r(()=>{i(l)});const p=o.result();return{macros:b(()=>{var u;return(u=p.value)==null?void 0:u.macros})}},Ja=s=>{const t=N();return{activeMacro:t,executeMacro:async n=>{t.value=n,s()},disposeActiveMacro:()=>{t.value=void 0}}},Xa=be`
    mutation ticketSharedDraftZoomCreate($input: TicketSharedDraftZoomInput!) {
  ticketSharedDraftZoomCreate(input: $input) {
    sharedDraft {
      ...ticketSharedDraftZoomAttributes
    }
    errors {
      ...errors
    }
  }
}
    ${ur}
${pt}`;function Ya(s={}){return mt(Xa,s)}const eo=be`
    mutation userCurrentTicketScreenBehavior($behavior: EnumTicketScreenBehavior!) {
  userCurrentTicketScreenBehavior(behavior: $behavior) {
    success
    errors {
      ...errors
    }
  }
}
    ${pt}`;function to(s={}){return mt(eo,s)}const Ct=[{key:K.StayOnTab,label:__("Stay on tab")},{key:K.CloseTab,label:__("Close tab")},{key:K.CloseTabOnTicketClose,label:__("Close tab on ticket close")}],ro=Ct.reduce((s,t)=>(s[t.key]=t,s),{}),ao=z({__name:"TicketScreenBehavior",setup(s){const t=he(),{setUserPreference:r}=t,{user:o}=ae(t),n=ke(),{config:i}=ae(n),{notify:a}=ve(),l=new Fe(to()),p=b(()=>{var u,k;return((k=(u=o.value)==null?void 0:u.preferences)==null?void 0:k.secondaryAction)||i.value.ticket_secondary_action||K.StayOnTab}),g=b({get:()=>ro[p.value],set:u=>{l.send({behavior:u.key}).then(()=>{r("secondaryAction",u.key),a({id:"ticket-screen-behavior-updated",type:fe.Success,message:__("Ticket screen behavior updated successfully")})})}});return(u,k)=>(c(),w(dr,{modelValue:g.value,"onUpdate:modelValue":k[0]||(k[0]=f=>g.value=f),items:e(Ct),orientation:"top"},null,8,["modelValue","items"]))}}),oo={class:"flex items-center gap-2"},no={key:0,class:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-200 text-sm outline outline-1 -outline-offset-1 outline-neutral-100 dark:bg-gray-700 dark:outline-gray-900"},De=9,io=z({__name:"TicketLiveUsers",props:{liveUserList:{}},setup(s){const t=s,{liveUsers:r}=Ea(ee(t,"liveUserList")),o=b(()=>r.value.slice(0,De)),n=b(()=>{if(r.value.length<=De)return;const i=r.value.length-De;return i>999?"+999":`+${i}`});return(i,a)=>(c(),E("div",oo,[(c(!0),E(X,null,ne(o.value,l=>(c(),w(Ue,{key:l.user.id,entity:l.user,live:l,size:"small"},null,8,["entity","live"]))),128)),n.value?(c(),E("div",no,I(n.value),1)):C("",!0)]))}}),so={class:"flex items-center gap-2.5"},lo=z({__name:"TicketSharedDraftZoom",props:{sharedDraftId:{},form:{}},setup(s){const{openSharedDraftFlyout:t}=lt();return(r,o)=>(c(),E("div",so,[v(J,{"prefix-icon":"template",size:"large",variant:"tertiary",onClick:o[0]||(o[0]=n=>e(t)("detail-view",r.sharedDraftId,r.form))},{default:_(()=>[L(I(r.$t("Draft Available")),1)]),_:1})]))}}),co={class:"flex gap-4 ltr:mr-auto rtl:ml-auto"},uo=z({__name:"TicketDetailBottomBar",props:{dirty:{type:Boolean},disabled:{type:Boolean},isTicketEditable:{type:Boolean},isTicketAgent:{type:Boolean},ticketId:{},groupId:{},form:{},hasAvailableDraft:{type:Boolean},canUseDraft:{type:Boolean},sharedDraftId:{},liveUserList:{}},emits:["submit","discard","execute-macro"],setup(s,{emit:t}){const r=s,o=ee(r,"groupId"),n=ee(r,"isTicketEditable"),i=t,{macros:a}=qa(o,n),{notify:l}=ve(),p={drafts:__("Drafts"),macros:__("Macros")},{mapSharedDraftParams:g}=lt(),u=Ca({name:"shared-draft-conflict",component:()=>xe(()=>import("./TicketSharedDraftConflictDialog-TzNfyjo2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52]))}),k=b(()=>{const f={label:__("Save as draft"),groupLabel:p.drafts,icon:"floppy",key:"save-draft",show:()=>r.canUseDraft,onClick:()=>{if(r.sharedDraftId){u.open({sharedDraftId:r.sharedDraftId,sharedDraftParams:g(r.ticketId,r.form),form:r.form});return}new Fe(Ya(),{errorNotificationMessage:__("Draft could not be saved.")}).send({input:g(r.ticketId,r.form)}).then(()=>{l({id:"shared-draft-detail-view-created",type:fe.Success,message:__("Shared draft has been created successfully.")})})}};if(!a.value)return[f];const y=a.value.map(d=>({key:d.id,label:d.name,groupLabel:p.macros,onClick:()=>i("execute-macro",d)}));return[f,...o.value?y:[]]});return(f,y)=>{var d;return c(),E(X,null,[F("div",co,[(d=f.liveUserList)!=null&&d.length?(c(),w(io,{key:0,"live-user-list":f.liveUserList},null,8,["live-user-list"])):C("",!0),f.hasAvailableDraft?(c(),w(lo,{key:1,form:f.form,"shared-draft-id":f.sharedDraftId},null,8,["form","shared-draft-id"])):C("",!0)]),n.value?(c(),E(X,{key:0},[f.dirty?(c(),w(J,{key:0,size:"large",variant:"danger",disabled:f.disabled,onClick:y[0]||(y[0]=D=>f.$emit("discard",D))},{default:_(()=>[L(I(f.$t("Discard your unsaved changes")),1)]),_:1},8,["disabled"])):C("",!0),v(ao),v(J,{size:"large",variant:"submit",type:"button",disabled:f.disabled,onClick:y[1]||(y[1]=D=>f.$emit("submit",D))},{default:_(()=>[L(I(f.$t("Update")),1)]),_:1},8,["disabled"]),f.isTicketAgent?(c(),w(bt,{key:1,class:"flex!","button-size":"large","no-single-action-mode":"",placement:"arrowEnd","custom-menu-button-label":"Additional ticket edit actions",actions:k.value},null,8,["actions"])):C("",!0)],64)):C("",!0)],64)}}}),mo=s=>{const{deleteTaskbarTab:t}=wa(),{user:r}=ae(he()),o=Jr(),n=b(()=>{var p,g;return(g=(p=r.value)==null?void 0:p.preferences)==null?void 0:g.secondaryAction}),i=()=>{s.value&&t(s.value)},a=()=>{o.back("/"),i()};return{handleScreenBehavior:({screenBehaviour:p,ticket:g})=>{switch(p||n.value){case K.CloseTabOnTicketClose:g.state.stateType.name==="closed"&&a();break;case K.CloseTab:a();break;case K.CloseNextInOverview:break;case K.StayOnTab:}}}},po={class:"flex items-center gap-1"},fo=["aria-label","onClick"],vo=z({__name:"HighlightMenu",props:{currentColor:{},currentColorModifiers:{}},emits:["update:currentColor"],setup(s){const{highlightColors:t}=Ma(),r=t.map(d=>({key:`${d.label}`,...d})),o=t.map(d=>d.label),n=Le(s,"currentColor"),i=N(!1),{popover:a,popoverTarget:l,toggle:p,close:g,isOpen:u}=gt(),{isDarkMode:k}=ae(La()),f=d=>{n.value=d,g(),i.value=!0},y=()=>{i.value=!i.value};return Me(()=>{n.value=r[0]}),(d,D)=>{var A,T,R,V,B;const m=U("CommonIcon"),h=U("CommonLabel");return c(),E("div",null,[F("div",po,[F("button",{class:"flex items-center gap-2 bg-(--highlight-color)",style:de({"--highlight-color":e(k)?(T=(A=n.value)==null?void 0:A.value)==null?void 0:T.dark:(V=(R=n.value)==null?void 0:R.value)==null?void 0:V.light,background:i.value?void 0:"transparent"}),onClick:y},[v(m,{size:"xs",name:"highlighter"}),v(h,{class:M(["rounded-xs p-1 text-xs",{"text-black! dark:text-white!":i.value}]),style:de({backgroundColor:i.value?(B=n.value)==null?void 0:B.value:void 0})},{default:_(()=>[L(I(d.$t("Highlight")),1)]),_:1},8,["class","style"])],4),v(m,{ref_key:"popoverTarget",ref:l,class:M(["cursor-pointer text-gray-100 transition-transform dark:text-neutral-400",{"rotate-180":e(u)}]),role:"button",size:"xs",name:"chevron-down",onClick:D[0]||(D[0]=j=>e(p)(!0))},null,8,["class"])]),v(yt,{ref_key:"popover",ref:a,placement:"arrowEnd",owner:e(l)},{default:_(()=>[v(ht,{class:"overflow-clip",items:e(r),popover:e(a)},dt({_:2},[ne(e(o),(j,H)=>({name:`item-${j}`,fn:_(x=>{var O;return[F("button",{"aria-label":d.$t(x.name),class:M(["relative flex grow items-center gap-2 p-2.5 text-gray-100 outline-hidden dark:text-neutral-400",{"bg-blue-600 text-black dark:bg-blue-900 dark:text-white":x.id===((O=n.value)==null?void 0:O.id),"rounded-t-lg":H===0,"rounded-b-lg":H===e(o).length-1,"after:absolute after:bottom-0 after:left-1/2 after:h-[1px] after:w-[calc(100%-1rem)] after:-translate-x-1/2 after:bg-neutral-100 after:dark:bg-gray-900":H!==e(o).length-1}]),onClick:ie=>f(x)},[F("span",{class:"inline-block h-4 w-4",style:de({backgroundColor:x.value.light})},null,4),v(h,{class:"p-1 text-current"},{default:_(()=>[L(I(d.$t(j)),1)]),_:2},1024),v(ze,{name:"fade"},{default:_(()=>{var ie;return[x.id===((ie=n.value)==null?void 0:ie.id)?(c(),w(m,{key:0,class:"rtl:-order-1",size:"small",name:"check2"})):C("",!0)]}),_:2},1024)],10,fo)]})}))]),1032,["items","popover"])]),_:1},8,["owner"])])}}}),bo=z({__name:"CommonTicketEscalationIndicator",props:{escalationAt:{}},setup(s){const t=s,r=Va(ee(()=>t.escalationAt));return(o,n)=>{const i=U("CommonIcon"),a=U("CommonBadge");return o.escalationAt&&e(r)!==e(rt).None?(c(),w(a,{key:0,variant:e(r)===e(rt).Escalated?"danger":"warning",class:"uppercase",role:"alert"},{default:_(()=>[v(i,{name:"warning-triangle",class:"me-1",size:"xs",decorative:""}),L(" "+I(o.$t("escalation %s",o.i18n.relativeDateTime(o.escalationAt))),1)]),_:1},8,["variant"])):C("",!0)}}}),ho=z({__name:"CommonTicketPriorityIndicator",props:{priority:{}},setup(s){const{config:t}=ae(ke()),r=s,o=b(()=>{var n;switch((n=r.priority)==null?void 0:n.uiColor){case"high-priority":return"danger";case"low-priority":return"tertiary";default:return"info"}});return(n,i)=>{const a=U("CommonBadge");return c(),w(a,{variant:o.value,class:"uppercase",role:"status","aria-live":"polite"},{default:_(()=>{var l,p;return[e(t).ui_ticket_priority_icons?(c(),w(Oa,{key:0,"ui-color":(l=n.priority)==null?void 0:l.uiColor},null,8,["ui-color"])):C("",!0),L(" "+I(n.$t((p=n.priority)==null?void 0:p.name)),1)]}),_:1},8,["variant"])}}}),ko=z({__name:"CommonTicketStateIndicator",props:{colorCode:{},label:{}},setup(s){const t=s,r=b(()=>{switch(t.colorCode){case ue.Closed:return"success";case ue.Pending:return"tertiary";case ue.Escalating:return"danger";case ue.Open:default:return"warning"}});return(o,n)=>{const i=U("CommonBadge");return c(),w(i,{variant:r.value,role:"group",class:"uppercase"},{default:_(()=>[v(Aa,{class:"ltr:mr-1.5 rtl:ml-1.5","color-code":t.colorCode,label:o.label},null,8,["color-code","label"]),L(" "+I(o.$t(o.label)),1)]),_:1},8,["variant"])}}}),go={};function yo(s,t){const r=U("CommonIcon"),o=U("CommonLabel"),n=U("CommonBadge");return c(),w(n,{tag:"div",variant:"info",class:"flex items-center gap-1"},{default:_(()=>[v(r,{name:"checklist",size:"xs"}),Ze(s.$slots,"label",{},()=>[v(o,{size:"small",class:"text-current uppercase"},{default:_(()=>[L(I(s.$t("tracked in")),1)]),_:1})]),Ze(s.$slots,"default")]),_:3})}const wt=ce(go,[["render",yo]]),_o=z({__name:"ReferencingTicketsBadgePopover",props:{referencingTickets:{}},setup(s){const{popover:t,popoverTarget:r,isOpen:o,toggle:n,close:i}=gt(),{config:a}=ae(ke()),l=s,p=b(()=>{var k;return(k=l.referencingTickets)==null?void 0:k.map((f,y)=>({ticket:f,key:`popover-checklist-title-item-${y}`}))}),g=b(()=>l.referencingTickets.length),u=b(()=>{var k;return(k=p.value)==null?void 0:k.map(f=>f.key)});return(k,f)=>{const y=U("CommonLabel"),d=me("tooltip");return c(),E(X,null,[re((c(),w(wt,{ref_key:"popoverTarget",ref:r,role:"button",tag:"div",tabindex:"0",class:M(["cursor-pointer hover:outline hover:outline-1 hover:outline-offset-1 hover:outline-blue-600 focus:outline-transparent focus-visible:outline-1 focus-visible:outline-offset-1 focus-visible:outline-blue-800 active:outline-blue-800 dark:hover:outline-blue-900",{"outline outline-1 outline-offset-1 !outline-blue-800":e(o)}]),onClick:f[0]||(f[0]=D=>e(n)(!0)),onKeydown:f[1]||(f[1]=pe(D=>e(n)(!0),["enter"]))},{default:_(()=>[v(y,{size:"small",class:"text-black! dark:text-white!"},{default:_(()=>[L(I(g.value===1?e(at)(e(a).ticket_hook,k.referencingTickets[0].number):k.$t("%s tickets",g.value)),1)]),_:1})]),_:1},8,["class"])),[[d,g.value===1?k.$t("Show tracking ticket"):k.$t("Show tracking tickets")]]),v(yt,{id:"checklist-badge-popover",ref_key:"popover",ref:t,placement:"arrowEnd",orientation:"bottom",owner:e(r)},{default:_(()=>[v(ht,{ref:"popoverMenu","header-label":k.$t("Tracked as checklist item in"),items:p.value,popover:e(t)},dt({_:2},[ne(u.value,D=>({name:`item-${D}`,fn:_(m=>[re(v(mr,{class:"group p-2.5 focus-visible:outline-transparent",classes:{indicator:"group-focus:text-white",label:"group-focus:text-white"},ticket:m.ticket,onClick:e(i)},null,8,["ticket","onClick"]),[[d,e(at)(e(a).ticket_hook,m.ticket.number)]])])}))]),1032,["header-label","items","popover"])]),_:1},8,["owner"])],64)}}}),To=z({__name:"ChecklistBadgeList",setup(s){const{ticket:t}=oe(),r=ct(),o=b(()=>{var u;return(u=t==null?void 0:t.value)==null?void 0:u.referencingChecklistTickets}),n=b(()=>{var u;return(u=t==null?void 0:t.value)==null?void 0:u.checklist}),i=b(()=>{var u;return(u=n.value)==null?void 0:u.complete}),a=b(()=>{var u;return(u=n.value)==null?void 0:u.total}),l=b(()=>{var u;return(u=n.value)==null?void 0:u.completed}),{userId:p}=he(),g=()=>{r.switchSidebar("checklist"),Qr.emit("expand-collapsed-content",`${p}-ticket-detail`)};return(u,k)=>{var d;const f=U("CommonLabel"),y=me("tooltip");return c(),E(X,null,[!l.value&&a.value?re((c(),w(wt,{key:0,role:"button",tabindex:"0",class:"cursor-pointer hover:outline hover:outline-1 hover:outline-offset-1 hover:outline-blue-600 focus:outline-transparent focus-visible:outline focus-visible:outline-1 focus-visible:outline-offset-1 focus-visible:outline-blue-800 active:outline-blue-800 dark:hover:outline-blue-900 dark:active:outline-blue-800",onClick:g,onKeydown:pe(g,["enter"])},{label:_(()=>[v(f,{size:"small",class:"text-current! uppercase"},{default:_(()=>[L(I(u.$t("checked")),1)]),_:1})]),default:_(()=>[v(f,{size:"small",class:"text-black! dark:text-white!"},{default:_(()=>[L(I(u.$t("%s of %s",i.value,a.value)),1)]),_:1})]),_:1})),[[y,u.$t("Open Checklist")]]):C("",!0),(d=o.value)!=null&&d.length?(c(),w(_o,{key:1,"referencing-tickets":o.value},null,8,["referencing-tickets"])):C("",!0)],64)}}}),Co={key:0,class:"flex max-w-full items-center gap-2.5 text-nowrap *:h-7"},wo=z({__name:"TicketInformationBadgeList",setup(s){const{ticket:t}=oe(),{config:r}=ae(ke()),o=b(()=>!!r.value.checklist);return(n,i)=>{const a=U("CommonDateTime"),l=U("CommonBadge");return e(t)?(c(),E("div",Co,[v(bo,{"escalation-at":e(t).escalationAt},null,8,["escalation-at"]),v(ko,{"color-code":e(t).stateColorCode,label:e(t).state.name},null,8,["color-code","label"]),v(ho,{priority:e(t).priority},null,8,["priority"]),v(l,{variant:"tertiary",class:"uppercase"},{default:_(()=>[v(a,{"date-time":e(t).createdAt,"absolute-format":"date",class:"ms-1"},{prefix:_(()=>[L(I(n.$t("Created")),1)]),_:1},8,["date-time"])]),_:1}),o.value?(c(),w(To,{key:0})):C("",!0)])):C("",!0)}}}),Ao=s=>{const{notify:t}=ve(),r=new Fe(ka());return{updateTitle:async n=>r.send({ticketId:s.value,input:{title:n},meta:{}}).then(()=>{t({type:fe.Success,id:"ticket-updated-successfully",message:__("Ticket updated successfully.")})})}},$o={class:"grow basis-full"},Io={key:0,class:"mb-1 flex items-center gap-1"},So=z({__name:"TicketInformation",props:{hideDetails:{type:Boolean}},setup(s){const{ticket:t,ticketId:r}=oe(),o=N(!1),{updateTitle:n}=Ao(r);return(i,a)=>{var p;const l=U("CommonLabel");return e(t)?(c(),E("div",{key:0,class:M(["grid grid-cols-[max-content_1fr] gap-4",{"items-center gap-3":i.hideDetails}])},[F("div",{class:M(["flex",{"mt-1":!i.hideDetails}])},[e(t).customer?(c(),w(Ue,{key:0,size:i.hideDetails?"medium":"normal",entity:e(t).customer},null,8,["size","entity"])):C("",!0),e(t).organization?(c(),w(Xr,{key:1,class:"ltr:-translate-x- -z-10 ltr:-translate-x-1.5 rtl:translate-x-1.5",size:i.hideDetails?"medium":"normal",entity:e(t).organization},null,8,["size","entity"])):C("",!0)],2),F("div",$o,[F("div",{class:M(["flex flex-col justify-center",{"mb-3.5":!i.hideDetails}])},[i.hideDetails?C("",!0):(c(),E("div",Io,[v(l,{tag:"p",class:M(["flex items-center gap-1",{"after:inline-block after:h-[.12rem] after:w-[.12rem] after:shrink-0 after:rounded-full after:bg-current":e(t).organization}])},{default:_(()=>[L(I(e(t).customer.fullname),1)]),_:1},8,["class"]),(p=e(t).organization)!=null&&p.name?(c(),w(l,{key:0},{default:_(()=>{var g;return[L(I((g=e(t).organization)==null?void 0:g.name),1)]}),_:1})):C("",!0)])),v(Na,{editing:o.value,"onUpdate:editing":a[0]||(a[0]=g=>o.value=g),size:"xl",required:"",block:"",disabled:!e(t).policy.update||i.hideDetails,value:e(t).title,classes:{label:i.hideDetails?"dark:text-white font-medium line-clamp-1":"dark:text-white font-medium line-clamp-4",input:"dark:text-white font-medium"},"label-attrs":{role:"heading","aria-level":"2"},label:i.$t("Edit ticket title"),onSubmitEdit:e(n)},null,8,["editing","disabled","value","classes","label","onSubmitEdit"])],2),i.hideDetails?C("",!0):(c(),w(wo,{key:0}))])],2)):C("",!0)}}}),Do=z({__name:"TopBarHeader",props:{hideDetails:{type:Boolean}},setup(s){const t=s,{ticket:r}=oe(),{isTicketAgent:o,isTicketEditable:n}=Tt(r),{copyToClipboard:i}=Ha(),{ticketNumber:a,ticketNumberWithTicketHook:l}=kt(r),p=b(()=>[{label:"Tickets",to:{name:"ticket-list"}},{label:l.value||"",noOptionLabelTranslation:!0,to:{name:"ticket-list"}}]),g=b(()=>t.hideDetails?["ticket-detail-grid-compact gap-x-2 grid-cols-[1fr_max-content] items-center p-2 px-10"]:[" ticket-detail-grid-full grid-cols-2 gap-y-2.5"]);return(u,k)=>{const f=U("CommonIcon"),y=me("tooltip");return c(),E("header",{class:M(["relative z-10 grid border-b border-neutral-100 bg-neutral-50 p-3 dark:border-gray-900 dark:bg-gray-500",g.value])},[u.hideDetails?C("",!0):(c(),w(Ia,{key:0,"emphasize-last-item":"",size:"small",style:{gridTemplate:"breadcrumbs"},items:p.value,class:"flex"},{trailing:_(()=>[e(a)?re((c(),w(f,{key:0,"aria-label":u.$t("Copy ticket number"),role:"button",name:"files",size:"xs",class:"cursor-pointer text-blue-800 ltr:ml-2 rtl:mr-2",onClick:k[0]||(k[0]=d=>e(i)(e(l)))},null,8,["aria-label"])),[[y,u.$t("Copy ticket number")]]):C("",!0)]),_:1},8,["items"])),e(o)&&e(n)&&!u.hideDetails?(c(),w(vo,{key:1,class:"justify-self-end",style:{gridTemplate:"actions"}})):C("",!0),v(So,{"hide-details":u.hideDetails,style:de({gridArea:u.hideDetails?"breadcrumbs":"info"}),class:M({"mx-10":!u.hideDetails})},null,8,["hide-details","style","class"])],2)}}}),ot=ce(Do,[["__scopeId","data-v-192c08ba"]]),Eo=["tabindex"],nt=z({__name:"TicketDetailTopBar",props:Ee({hideDetails:{type:Boolean}},{hover:{type:Boolean,required:!1},hoverModifiers:{}}),emits:["update:hover"],setup(s){const t=Le(s,"hover"),{ticket:r}=oe(),{isTicketAgent:o,isTicketEditable:n}=Tt(r),{hasChannelAlert:i,channelAlert:a}=ma(r),{isTouchDevice:l}=ft(),p=b(()=>l.value?{touchstart(){t.value=!0},touchend(){t.value=!1}}:{mouseenter(){t.value=!0},mouseleave(){t.value=!1}});return(g,u)=>{var f;const k=U("CommonAlert");return e(o)&&e(n)&&e(i)?(c(),E("div",Be({key:0,class:"z-10",tabindex:g.hideDetails?0:-1},qe(p.value,!0)),[v(ot,{"hide-details":g.hideDetails},null,8,["hide-details"]),v(k,{class:"rounded-none px-14 md:grid-cols-none md:justify-center",variant:(f=e(a))==null?void 0:f.variant},{default:_(()=>{var y,d;return[L(I(g.$t((y=e(a))==null?void 0:y.text,(d=e(a))==null?void 0:d.textPlaceholder)),1)]}),_:1},8,["variant"])],16,Eo)):(c(),w(ot,Be({key:1,"hide-details":g.hideDetails},qe(p.value)),null,16,["hide-details"]))}}}),Bo=(s,t,r,o)=>{let i=!1;const{arrivedState:a}=Ir(t,{eventListenerOptions:{passive:!0}}),l=N(!1),p=N(!1),g=N(0),u=()=>{p.value=!1,l.value=!1,g.value=0},k=N(!1),f=b({get:()=>k.value,set:d=>{k.value=d,d&&(l.value=!1)}}),y=Sr(d=>{var R;if(!i){i=!0;return}const D=d.target,{scrollHeight:m,clientHeight:h}=D;if(!(m>h))return u();const T=D.scrollTop??0;p.value=T+h<m,f.value||(l.value=T>(((R=o.value)==null?void 0:R.$el.clientHeight)??0)),g.value=T},250);return Dr(()=>a.top,()=>{f.value||(l.value=!1)}),Z(()=>a.bottom,d=>{p.value=!d}),Z(()=>{var d;return(d=s.value)==null?void 0:d.id},()=>{var d;(d=r.value)==null||d.setDidInitialScroll(!1)},{immediate:!0}),Z(()=>{var d;return(d=r.value)==null?void 0:d.rows},async()=>{var d,D,m;(d=r.value)!=null&&d.didScrollInitially||(await((D=r.value)==null?void 0:D.scrollToArticle()),(m=r.value)==null||m.setDidInitialScroll(!0),u())},{flush:"post"}),Z(()=>{var d;return(d=r.value)==null?void 0:d.rows},(d,D)=>{var m,h,A,T,R;!d||!D||((m=d.at(-1))==null?void 0:m.key)!==((h=D.at(-1))==null?void 0:h.key)&&((A=d.at(-1))==null?void 0:A.key)!==((T=D.at(-2))==null?void 0:T.key)&&((R=r.value)==null||R.scrollToArticle())}),Me(()=>{i=!1,l.value=!1}),Er(()=>{i=!1,l.value=!1}),{handleScroll:y,isHoveringOnTopBar:f,isHidingTicketDetails:l,isReachingBottom:p}},xo=(s,t)=>{const r=N(),o=b({get:()=>r.value!==void 0?r.value:t.value,set:l=>{r.value=l}}),n=b(()=>{var l;if(o.value)return(l=s.value)==null?void 0:l.getNodeByName("article")}),i=b(()=>{var l,p;return!!((p=(l=n.value)==null?void 0:l.context)!=null&&p.state.valid)});return{newTicketArticlePresent:o,articleFormGroupNode:n,isArticleFormGroupValid:i,showTicketArticleReplyForm:()=>{o.value=!0}}},Lo=z({__name:"ArticleBubbleActionList",props:{position:{},article:{}},setup(s){const t=s,{ticket:r,isTicketEditable:o,showTicketArticleReplyForm:n,form:i}=oe(),{isTouchDevice:a}=ft(),l=b(()=>t.position==="left"?"border! border-neutral-100! outline-transparent! hover:border-blue-700! hover:border-blue-800! bg-neutral-50! hover:dark:bg-gray-500! hover:bg-white!  text-gray-100! dark:border-gray-900! dark:bg-gray-500! dark:text-neutral-400!":"border! border-neutral-100! outline-transparent! hover:border-blue-700! dark:hover:border-blue-700! bg-blue-100! bg-blue-100!  text-gray-100! dark:border-gray-900! dark:bg-stone-500! dark:text-neutral-400!"),{getNewArticleBody:p,openReplyForm:g}=vt(i,n),u=[],k=m=>{u.push(m)},f=()=>{u.forEach(m=>m()),u.length=0},y=N(0),d=m=>{try{return pa(m)}catch(h){na.error("[Article Quote] Failed to parse article selection",h);return}},D=b(()=>{if(!r.value||y.value<0)return{popoverActions:[],alwaysVisibleActions:[]};f();const m=Ba(r.value,t.article,"desktop",{onDispose:k,recalculate:()=>{y.value+=1}}),h=[],A=[];return m.forEach(T=>{const R={key:T.name,label:T.label,icon:T.icon,link:T.link,...T!=null&&T.perform?{onClick:()=>{var V;!(T!=null&&T.perform)||!r.value||T.perform(r.value,t.article,{formId:((V=i.value)==null?void 0:V.formId)||"",selection:d(t.article.internalId),openReplyForm:g,getNewArticleBody:p})}}:{}};T.alwaysVisible?A.push(R):h.push(R)}),{alwaysVisibleActions:A,popoverActions:h}});return(m,h)=>e(o)?(c(),E("div",{key:0,class:M(["absolute bottom-0 flex w-fit translate-y-1/2 items-center gap-1 ltr:right-3 rtl:left-3",{"ltr:left-3 rtl:right-3":m.position==="left"}])},[(c(!0),E(X,null,ne(D.value.alwaysVisibleActions,A=>(c(),E("div",{key:A.key,class:M(["order-1 flex items-center",{"-order-1!":m.position==="right","opacity-0 transition-opacity group-hover/article:opacity-100 focus-within:opacity-100":!e(a)}])},[v(J,{class:M(["px-1 py-0.5! text-xs! focus-visible:outline-offset-0! focus-visible:outline-blue-800!",[l.value]]),"prefix-icon":A.icon,size:"large",onClick:A.onClick},{default:_(()=>[L(I(m.$t(A.label)),1)]),_:2},1032,["class","prefix-icon","onClick"])],2))),128)),v(bt,{class:"flex!","no-padded-default-button":!1,"no-small-rounding-default-button":"",entity:{ticket:e(r),article:m.article},"button-size":"medium",placement:m.position==="left"?"arrowStart":"arrowEnd","default-button-variant":m.position==="left"?"neutral-dark":"neutral-light",actions:D.value.popoverActions,"no-single-action-mode":""},null,8,["entity","placement","default-button-variant","actions"])],2)):C("",!0)}}),Mo={key:0,class:"flex flex-row gap-1 p-3",role:"alert"},zo=z({__name:"ArticleBubbleBlockedContentWarning",props:{article:{}},setup(s){const t=s,{ticketInternalId:r}=oe(),{originalFormattingUrl:o}=xa(t.article,r);return(n,i)=>{var p;const a=U("CommonLink"),l=U("CommonLabel");return(p=n.article.preferences)!=null&&p.remote_content_removed?(c(),E("div",Mo,[v(Yr,{class:"shrink-0",name:"exclamation-triangle",size:"small"}),v(l,{class:"block!"},{default:_(()=>[L(I(n.$t("This message contains images or other content hosted by an external source. It was blocked, but you can download the original formatting."))+" ",1),i[0]||(i[0]=F("br",null,null,-1)),e(o)?(c(),w(a,{key:0,link:e(o),size:"medium",target:"_blank"},{default:_(()=>[L(I(n.$t("Original Formatting")),1)]),_:1},8,["link"])):C("",!0)]),_:1})])):C("",!0)}}}),Fo={key:0,class:"absolute top-3 flex w-full px-3 ltr:left-0 rtl:right-0",role:"group","aria-describedby":"author-name-and-creation-date"},Uo={id:"author-name-and-creation-date",class:"sr-only"},Po=["innerHTML"],Ro=z({__name:"ArticleBubbleBody",props:{article:{},showMetaInformation:{type:Boolean},position:{},inlineImages:{}},emits:["preview"],setup(s,{emit:t}){const r=s,o=t,{shownMore:n,bubbleElement:i,hasShowMore:a,toggleShowMore:l}=fa(),p=b(()=>r.position==="right"?["dark:bg-stone-500","bg-blue-100","Content--customer"]:["dark:bg-gray-400","bg-white","Content--agent"]),g=b(()=>r.article.contentType!=="text/html"?ea(r.article.bodyWithUrls):r.article.bodyWithUrls),u=b(()=>{const y=r.article.author.fullname;return!r.showMetaInformation&&y!=="-"&&((y==null?void 0:y.length)??0)>0}),{setupLinksHandlers:k}=Fa("/desktop"),{populateInlineImages:f}=va(ee(r,"inlineImages"),y=>o("preview",r.inlineImages[y]));return Z(()=>g,async()=>{await te(),i.value&&(k(i.value),f(i.value))}),Me(()=>{i.value&&(k(i.value),f(i.value))}),(y,d)=>{const D=U("CommonLabel"),m=U("CommonDateTime"),h=U("CommonLink");return c(),E("div",{class:M(["Content relative p-3 transition-[padding]",[p.value,{"pt-3!":y.showMetaInformation,"pt-9!":u.value}]])},[u.value?(c(),E("div",Fo,[F("p",Uo,I(y.$t("Author name and article creation date")),1),v(D,{class:"font-bold",size:"small",variant:"neutral"},{default:_(()=>[L(I(y.article.author.fullname),1)]),_:1}),v(m,{class:"text-xs ltr:ml-auto rtl:mr-auto","date-time":y.article.createdAt},null,8,["date-time"])])):C("",!0),F("div",{ref_key:"bubbleElement",ref:i,class:"overflow-hidden text-sm"},[F("div",{class:"inner-article-body",innerHTML:g.value},null,8,Po)],512),e(a)?(c(),E("div",{key:1,class:M(["relative",{BubbleGradient:e(a)&&!e(n)}])},null,2)):C("",!0),e(a)?(c(),w(h,{key:2,class:"mb-1 inline-block! outline-transparent! hover:no-underline! focus-visible:outline-blue-800!",role:"button",link:"#",size:"medium",onClick:Je(e(l),["prevent"]),onKeydown:pe(Je(e(l),["prevent"]),["enter"])},{default:_(()=>[L(I(e(n)?y.$t("See less"):y.$t("See more")),1)]),_:1},8,["onClick","onKeydown"])):C("",!0)],2)}}}),Ho=ce(Ro,[["__scopeId","data-v-cb631efb"]]),No={key:0,class:"flex flex-col gap-1 bg-blue-300 p-3 dark:bg-stone-700"},Vo={class:"flex flex-row"},Oo=z({__name:"ArticleBubbleFooter",props:{article:{},articleAttachments:{}},emits:["preview"],setup(s){return(t,r)=>{const o=U("CommonLabel");return t.articleAttachments.length>0?(c(),E("footer",No,[F("div",Vo,[v(o,{"prefix-icon":"paperclip",size:"small"},{default:_(()=>[L(I(t.articleAttachments.length===1?t.$t("1 attached file"):t.$t("%s attached files",t.articleAttachments.length)),1)]),_:1})]),(c(!0),E(X,null,ne(t.articleAttachments,n=>(c(),w(ta,{key:n.internalId,"download-url":n.downloadUrl,"preview-url":n.preview,file:n,"no-preview":!t.$c.ui_ticket_zoom_attachments_preview,"no-remove":"",onPreview:(i,a)=>t.$emit("preview",a,n)},null,8,["download-url","preview-url","file","no-preview","onPreview"]))),128))])):C("",!0)}}}),jo=z({__name:"ArticleBubbleMediaError",props:{article:{}},setup(s){const t=s,r=b(()=>{var a;return(a=t.article.mediaErrorState)==null?void 0:a.error}),{loading:o,tryAgain:n}=ba(ee(t.article,"id")),i=async()=>{try{await n()}catch{}};return(a,l)=>{const p=U("CommonAlert");return r.value?(c(),w(p,{key:0,class:"rounded-none",variant:"warning"},{default:_(()=>[F("div",null,[F("h2",null,I(a.$t("Failed to load content.")),1),v(J,{class:"p-0! text-current! underline hover:outline-transparent dark:hover:outline-transparent",size:"medium","transparent-background":"",disabled:e(o),onClick:i},{default:_(()=>[L(I(a.$t("Retry Attachment Download")),1)]),_:1},8,["disabled"])])]),_:1})):C("",!0)}}}),Go={key:0,role:"list",class:"flex gap-3 p-3 dark:bg-gray-500"},Wo=z({__name:"ArticleBubbleSecurityStatusBar",props:{article:{}},setup(s){const t=s,{signingIcon:r,encryptionIcon:o,hasError:n}=_t(ee(t.article));return(i,a)=>{const l=U("CommonIcon");return i.article.securityState&&!e(n)?(c(),E("div",Go,[v(l,{size:"xs",role:"listitem",name:e(o)},null,8,["name"]),v(l,{size:"xs",role:"listitem",name:e(r)},null,8,["name"])])):C("",!0)}}}),Qo={key:0},Ko={key:1},Zo={key:2,class:"block"},qo=z({__name:"ArticleBubbleSecurityWarning",props:{article:{}},setup(s){const t=s,{hasError:r,signingMessage:o,encryptionMessage:n,retrySecurityProcess:i}=_t(ee(t.article));return(a,l)=>{const p=U("CommonAlert");return e(r)?(c(),w(p,{key:0,class:"rounded-none",variant:"warning"},{default:_(()=>[F("div",null,[F("h2",null,I(a.$t("Security Error")),1),e(o)?(c(),E("p",Qo,I(a.$t("Sign:"))+" "+I(e(o)),1)):C("",!0),e(n)?(c(),E("p",Ko,I(a.$t("Encryption:"))+" "+I(e(n)),1)):C("",!0),!e(o)&&!e(n)?(c(),E("p",Zo,I(a.$t("No security information available.")),1)):C("",!0),v(J,{class:"p-0! text-current! underline hover:outline-transparent dark:hover:outline-transparent",size:"medium","transparent-background":"",onClick:e(i)},{default:_(()=>[L(I(a.$t("Retry Security Process")),1)]),_:1},8,["onClick"])])]),_:1})):C("",!0)}}}),Jo=()=>{const s=N(!1),t=a=>{if(!a)return!1;const l=new Set(["A","BUTTON"]),p=a.closest(Array.from(l).join(","));return l.has(a.tagName)||p},r=a=>{if(!a)return!1;const l=window.getSelection();return!(!l||l.type!=="Range")},{start:o,stop:n}=Br(200,{controls:!0,callback:()=>{s.value=!s.value},immediate:!1});return{showMetaInformation:s,toggleHeader:async a=>{n(),!(a.detail===2||t(a.target)||r(a.target))&&o()}}},Xo=(s,t)=>{const r=b(()=>s.value==="right"?["dark:bg-stone-500","bg-blue-100"]:["dark:bg-gray-400","bg-neutral-100"]),o=b(()=>s.value==="right"?"border-t border-t-neutral-100 dark:border-t-gray-900":"border-t border-t-neutral-300 dark:border-t-gray-900"),n=b(()=>t.value?"":s.value==="right"?"border border-neutral-100 dark:border-gray-900":"border border-neutral-300 dark:border-gray-900"),i=b(()=>s.value==="right"?["dark:bg-stone-700","bg-blue-300"]:["dark:bg-gray-500","bg-neutral-50"]),a=b(()=>s.value==="right"?"ltr:rounded-br-none rtl:rounded-bl-none":"ltr:rounded-bl-none rtl:rounded-br-none"),l=b(()=>t.value?s.value==="right"?"bg-stripes before:rounded-2xl relative z-0 rounded-xl outline outline-1 outline-blue-700 ltr:rounded-br-none rtl:rounded-bl-none ltr:before:rounded-br-none rtl:before:rounded-bl-none":"bg-stripes before:rounded-2xl relative z-0 rounded-xl outline outline-1 outline-blue-700 ltr:rounded-bl-none rtl:rounded-br-none ltr:before:rounded-bl-none rtl:before:rounded-br-none":"");return{bodyClasses:r,dividerClass:o,frameBorderClass:n,headerAndIconBarBackgroundClass:i,articleWrapperBorderClass:a,internalNoteClass:l}},At=z({__name:"ArticleReactionBadge",props:{position:{},reaction:{}},setup(s){return(t,r)=>{const o=U("CommonLabel");return t.reaction?(c(),E("div",{key:0,class:M(["absolute bottom-0 flex w-fit translate-y-1/2 items-center gap-1",{"ltr:right-3 rtl:left-3":t.position==="left"||t.position==="system","ltr:left-3 rtl:right-3":t.position==="right"}])},[v(o,{class:M(["cursor-default rounded-md border px-1 py-0.5",{"border-neutral-100 bg-neutral-50 dark:border-gray-900 dark:bg-gray-500":t.position==="left","border-neutral-100 bg-blue-100 dark:border-gray-900 dark:bg-stone-500":t.position==="right","border-neutral-500 bg-blue-50 dark:border-neutral-500 dark:bg-gray-800":t.position==="system"}]),size:"small"},{default:_(()=>[L(I(t.reaction),1)]),_:1},8,["class"])],2)):C("",!0)}}}),Yo=["data-test-id"],en=["aria-hidden"],tn=z({__name:"ArticleBubble",props:{article:{}},setup(s){const t=xr(()=>xe(()=>import("./ArticleBubbleHeader-Bx1hJ83i.js"),__vite__mapDeps([53,12,2,3,4,7,8,1,5,13,14,54,55,56,35,19,57,58,50,40,48,59,60,39]))),r=s,{showMetaInformation:o,toggleHeader:n}=Jo(),i=b(()=>{var h;switch((h=r.article.sender)==null?void 0:h.name){case Se.Customer:return"right";case Se.System:return"left";case Se.Agent:return"left";default:return"left"}}),a=b(()=>{var h;return((h=r.article.type)==null?void 0:h.name)==="note"&&r.article.internal||r.article.internal}),{frameBorderClass:l,dividerClass:p,bodyClasses:g,headerAndIconBarBackgroundClass:u,articleWrapperBorderClass:k,internalNoteClass:f}=Xo(i,a),y=b(()=>r.article.attachmentsWithoutInline.filter(h=>!h.preferences||!h.preferences["original-format"])),{attachments:d}=za({attachments:y}),D=N([]),{showPreview:m}=pr(b(()=>[...D.value,...d.value]));return(h,A)=>{var T,R,V;return c(),E("div",{class:M(["group/article relative rounded-t-xl backface-hidden",[{"ltr:rounded-bl-xl rtl:rounded-br-xl":i.value==="right","ltr:rounded-br-xl rtl:rounded-bl-xl":i.value==="left"},e(l),e(f)]]),"data-test-id":`article-bubble-container-${h.article.internalId}`},[v(Ue,{class:M(["!absolute bottom-0",{"ltr:-right-2.5 ltr:translate-x-full rtl:-left-2.5 rtl:-translate-x-full":i.value==="right","ltr:-left-2.5 ltr:-translate-x-full rtl:-right-2.5 rtl:translate-x-full":i.value==="left"}]),entity:h.article.author,size:"small","no-indicator":""},null,8,["class","entity"]),F("div",{class:M(["grid w-full grid-rows-[0fr] overflow-hidden rounded-xl transition-[grid-template-rows]",[{"grid-rows-[1fr]":e(o)},e(k)]])},[F("div",{"aria-hidden":!e(o),class:"grid w-full grid-rows-[0fr] overflow-hidden"},[v(ze,{name:"pseudo-transition"},{default:_(()=>[e(o)?(c(),w(e(t),{key:0,"aria-label":h.$t("Article meta information"),class:M(e(u)),"show-meta-information":e(o),position:i.value,article:h.article},null,8,["aria-label","class","show-meta-information","position","article"])):C("",!0)]),_:1})],8,en),e(o)?C("",!0):(c(),w(Wo,{key:0,class:M([e(u),e(o)?e(p):""]),article:h.article},null,8,["class","article"])),v(qo,{article:h.article},null,8,["article"]),v(jo,{article:h.article},null,8,["article"]),v(Ho,{tabindex:"0","data-test-id":`article-bubble-body-${h.article.internalId}`,class:M(["last:rounded-b-xl focus:outline-hidden focus-visible:outline focus-visible:-outline-offset-1 focus-visible:outline-blue-800",[e(g),{"pt-3":e(o),"[&:nth-child(2)]:rounded-t-xl":!e(o),"rtl:rounded-br-none [&:nth-child(2)]:ltr:rounded-br-none":i.value==="right","rtl:rounded-br-none [&:nth-child(2)]:ltr:rounded-bl-none":i.value==="left"}]]),position:i.value,"show-meta-information":e(o),"inline-images":D.value,article:h.article,onClick:e(n),onKeydown:pe(e(n),["enter"]),onPreview:A[0]||(A[0]=B=>e(m)("image",B))},null,8,["data-test-id","class","position","show-meta-information","inline-images","article","onClick","onKeydown"]),v(zo,{class:M([e(p),e(g),{"pt-3":e(o)}]),article:h.article},null,8,["class","article"]),v(Oo,{article:h.article,"article-attachments":e(d),onPreview:e(m)},null,8,["article","article-attachments","onPreview"])],2),v(Lo,{article:h.article,position:i.value},null,8,["article","position"]),v(At,{position:i.value,reaction:(V=(R=(T=h.article.preferences)==null?void 0:T.whatsapp)==null?void 0:R.reaction)==null?void 0:V.emoji},null,8,["position","reaction"])],10,Yo)}}}),rn={class:"flex items-center gap-3 px-5 text-center"},an=z({__name:"ArticleMore",props:{disabled:{type:Boolean}},setup(s){return(t,r)=>(c(),E("div",rn,[r[0]||(r[0]=F("div",{class:"line-more grow"},null,-1)),v(J,{class:"shrink-0",disabled:t.disabled},{default:_(()=>[L(I(t.$t("See more")),1)]),_:1},8,["disabled"]),r[1]||(r[1]=F("div",{class:"line-more grow"},null,-1))]))}}),on=ce(an,[["__scopeId","data-v-f884cd26"]]),nn=z({__name:"DeliveryMessage",props:{content:{}},setup(s){return(t,r)=>{const o=U("CommonAlert");return c(),w(o,{id:"bottom",variant:"warning"},{default:_(()=>[F("p",null,I(t.$t('Delivery failed: "%s"',t.content)),1)]),_:1})}}}),sn={class:"relative rounded-lg border border-current p-3 text-center text-neutral-500"},ln=z({__name:"SystemMessage",props:{subject:{},to:{},reaction:{}},setup(s){return(t,r)=>{const o=U("CommonLabel");return c(),E("div",sn,[v(o,null,{default:_(()=>[L('"'+I(t.subject)+'"',1)]),_:1}),t.to?(c(),E(X,{key:0},[r[0]||(r[0]=L(" -> ")),v(o,null,{default:_(()=>[L('"'+I(t.to)+'"',1)]),_:1})],64)):C("",!0),v(At,{position:"system",reaction:t.reaction},null,8,["reaction"])])}}}),cn=(s,t,r)=>({rows:Lr(s,()=>{const n=s.value.length<r.value;return s.value.reduce((i,a,l)=>{var p,g,u,k,f,y,d;return(p=a.preferences)!=null&&p.delivery_message?i.push({type:"delivery",content:a.bodyWithUrls,key:a.internalId.toString()}):((g=a.sender)==null?void 0:g.name)==="System"&&((u=a.type)==null?void 0:u.name)!=="note"?i.push({type:"system",subject:a.subject,to:((k=a.to)==null?void 0:k.raw)||"",reaction:(d=(y=(f=a.preferences)==null?void 0:f.whatsapp)==null?void 0:y.reaction)==null?void 0:d.emoji,key:a.internalId.toString()}):i.push({type:"article-bubble",article:a,key:a.internalId.toString()}),l===t.value-1&&n&&i.push({type:"more",key:"more",count:r.value-s.value.length}),i},[])})}),un={key:0,role:"feed",class:"mx-auto w-full max-w-6xl space-y-10 px-12 py-4"},dn=["id","aria-setsize","aria-posinset"],mn=z({__name:"ArticleList",setup(s,{expose:t}){const r=ut(),{context:o}=fr(),n=b(()=>{var m;return((m=o.articles.value)==null?void 0:m.articles.totalCount)||0}),i=b(()=>{var m;return Ie((m=o.articles.value)==null?void 0:m.firstArticles).length}),a=b(()=>{if(!o.articles.value)return[];const m=Ie(o.articles.value.firstArticles),h=Ie(o.articles.value.articles);return ca(m,h,A=>A.id)}),{rows:l}=cn(a,i,n),p=async()=>{var m;await o.articlesQuery.fetchMore({variables:{pageSize:100,loadFirstArticles:!1,beforeCursor:(m=o.articles.value)==null?void 0:m.articles.pageInfo.startCursor}})},g=b(()=>o.articlesQuery.loading().value),u=async m=>{const h=l.value.find(A=>"article"in A&&A.article.internalId===parseInt(m,10));return h?Ye(`#article-${h.key}`):Promise.resolve(null)},k=b(()=>!!l.value.find(m=>m.type==="more")),f=async m=>{const h=await u(m);return h||!k.value?h:(await p(),f(m))},y=async()=>{var h;let m;if(r.hash){const A=(h=r.hash)==null?void 0:h.replace("#article-","");m=await f(A)}if(!m){const A=l.value[l.value.length-1];m=await Ye(`#article-${A==null?void 0:A.key}`)}if(!m)return!1;m==null||m.scrollIntoView({behavior:"instant",block:"start"})},d=N(!1);return t({scrollToArticle:y,rows:l,didScrollInitially:d,setDidInitialScroll:m=>{d.value=m}}),(m,h)=>{var A;return(A=e(o).articles.value)!=null&&A.articles.edges&&e(l)?(c(),E("section",un,[(c(!0),E(X,null,ne(e(l),(T,R)=>(c(),E("article",{id:`article-${T.key}`,key:T.key,"aria-setsize":n.value,"aria-posinset":R+1},[T.type==="article-bubble"?(c(),w(tn,{key:0,article:T.article},null,8,["article"])):T.type==="more"?(c(),w(on,{key:1,disabled:g.value,onClick:h[0]||(h[0]=V=>p())},null,8,["disabled"])):T.type==="delivery"&&T.content?(c(),w(nn,{key:2,role:"article",content:T.content},null,8,["content"])):T.type==="system"&&T.subject?(c(),w(ln,{key:3,role:"article",subject:T.subject,to:T.to,reaction:T.reaction},null,8,["subject","to","reaction"])):C("",!0)],8,dn))),128))])):C("",!0)}}}),pn=["aria-expanded"],it=290,st=150,fn=z({__name:"ArticleReply",props:Ee({ticket:{},newArticlePresent:{type:Boolean},createArticleType:{},ticketArticleTypes:{},isTicketCustomer:{type:Boolean},hasInternalArticle:{type:Boolean},parentReachedBottomScroll:{type:Boolean}},{pinned:{type:Boolean},pinnedModifiers:{}}),emits:Ee(["show-article-form","discard-form"],["update:pinned"]),setup(s,{expose:t}){var V;const r=s,o=b(()=>r.isTicketCustomer?"web":r.createArticleType==="phone"?"email":r.createArticleType),n=b(()=>["note","phone",o.value]),i=b(()=>{const B=r.ticketArticleTypes.filter(x=>n.value.includes(x.value)),j=B.some(x=>x.value==="email");let H=o.value;return B.length===2&&(H=r.createArticleType),B.map(x=>({articleType:x.value,label:H===x.value&&j?__("Add reply"):x.buttonLabel,icon:x.icon,variant:H===x.value||x.value==="phone"&&!j&&B.length===2?"primary":"secondary",performReply:()=>{var O;return(O=x.performReply)==null?void 0:O.call(x,r.ticket)}}))}),a=Le(s,"pinned"),l=()=>{a.value=!a.value},p=N();Z(()=>[r.newArticlePresent,a.value],([B,j])=>{!B||j||te(()=>{setTimeout(()=>{var H,x;(x=(H=p.value)==null?void 0:H.scrollIntoView)==null||x.call(H,!0)},300)})}),Z(()=>r.newArticlePresent,B=>{B||(a.value=!1)});const{userId:g}=he(),u=Mr(`${g}-article-reply-height`,it),{height:k}=zr(),f=b(()=>k.value/2),y=N(),d=B=>{B>=f.value||B<st||(u.value=B)},D=Fr(),m=(B,j)=>{var x;if(!u.value||D.value!==((x=y.value)==null?void 0:x.resizeLine))return;B.preventDefault();const H=u.value+j;H>=f.value||d(H)},{startResizing:h}=Ua(d,(V=y.value)==null?void 0:V.resizeLine,m,{orientation:"horizontal",offsetThreshold:56}),A=()=>{u.value=it},T=N(),{reachedTop:R}=Ra(T);return t({articlePanel:p}),(B,j)=>{const H=U("CommonLabel"),x=me("tooltip");return B.newArticlePresent?(c(),E("div",Be({key:0,ref_key:"articlePanel",ref:p,class:["relative mx-auto flex w-full flex-col",{"max-w-6xl px-12 py-4":!a.value,"sticky bottom-0 z-20 overflow-hidden border-t border-t-neutral-300 bg-neutral-50 dark:border-t-gray-900 dark:bg-gray-500":a.value}],style:{height:a.value?`${e(u)}px`:"auto"},"aria-labelledby":"article-reply-form-title",role:"complementary","aria-expanded":!a.value},B.$attrs),[a.value?(c(),w(Pa,{key:0,ref_key:"resizeLine",ref:y,class:"group absolute top-0 z-10 h-3 w-full",label:B.$t("Resize article panel"),orientation:"horizontal",values:{max:f.value,min:st,current:e(u)},onMousedownEvent:e(h),onTouchstartEvent:e(h),onDblclick:A},null,8,["label","values","onMousedownEvent","onTouchstartEvent"])):C("",!0),F("div",{class:M(["flex h-full grow flex-col",{"bg-stripes relative z-0 rounded-xl outline-1 outline-blue-700 before:rounded-2xl":B.hasInternalArticle&&!a.value,"border-stripes":B.hasInternalArticle&&a.value}])},[F("div",{class:M(["isolate flex h-full grow flex-col",{"rounded-xl border border-neutral-300 bg-neutral-50 dark:border-gray-900 dark:bg-gray-500":!a.value}])},[F("div",{class:M(["flex h-10 items-center p-3",{"bg-neutral-50 dark:bg-gray-500":a.value,"border-b border-b-transparent":a.value&&e(R),"border-b border-b-neutral-300 dark:border-b-gray-900":a.value&&!e(R)}])},[v(H,{id:"article-reply-form-title",class:"text-stone-200 ltr:mr-auto rtl:ml-auto dark:text-neutral-500",tag:"h2",size:"small"},{default:_(()=>[L(I(B.$t("Reply")),1)]),_:1}),re(v(J,{class:"text-red-500 ltr:mr-2 rtl:ml-2",variant:"none",icon:"trash",onClick:j[0]||(j[0]=O=>B.$emit("discard-form"))},null,512),[[x,B.$t("Discard unsaved reply")]]),re(v(J,{icon:a.value?"pin":"pin-angle",variant:"neutral",size:"small",onClick:l},null,8,["icon"]),[[x,a.value?B.$t("Unpin this panel"):B.$t("Pin this panel")]])],2),F("div",{id:"ticketArticleReplyForm",ref_key:"articleForm",ref:T,class:M(["grow px-3 pb-3",{"overflow-y-auto":a.value,"my-[5px] px-4 pt-2":B.hasInternalArticle&&a.value}])},null,2)],2)],2)],16,pn)):B.newArticlePresent!==void 0?(c(),E("div",{key:1,class:M(["sticky bottom-0 z-20 flex w-full justify-center gap-2.5 border-t border-t-transparent py-1.5",{"border-t-neutral-100 bg-neutral-50 dark:border-t-gray-900 dark:bg-gray-500":B.parentReachedBottomScroll}])},[(c(!0),E(X,null,ne(i.value,O=>(c(),w(J,{key:O.articleType,"prefix-icon":O.icon,variant:O.variant,size:"large",onClick:ie=>B.$emit("show-article-form",O.articleType,O.performReply)},{default:_(()=>[L(I(B.$t(O.label)),1)]),_:2},1032,["prefix-icon","variant","onClick"]))),128))],2)):C("",!0)}}}),vn=ce(fn,[["__scopeId","data-v-8b859bdc"]]),bn={class:"sticky top-0 z-10"},hn={id:"wrapper-form-ticket-edit",class:"hidden","aria-hidden":"true"},kn=z({__name:"TicketDetailViewContent",props:{internalId:{}},setup(s){const r=ee(s,"internalId"),o=N(!1),{ticket:n,ticketId:i,...a}=vr(r),l=({articlesQuery:S})=>S.refetch(),{articleResult:p,articlesQuery:g,isLoadingArticles:u}=ha(i,{pageSize:20,onAddArticleCallback:l});Ur(br,{articles:b(()=>p.value),articlesQuery:g});const{form:k,values:f,flags:y,isDisabled:d,isDirty:D,isInitialSettled:m,formReset:h,formSubmit:A,triggerFormUpdater:T}=qr(),R=b(S=>{if(!m.value)return{};const $={formIsDirty:D.value};return S&&ua($,S)?S:$}),{currentTaskbarTabId:V,currentTaskbarTabFormId:B,currentTaskbarTabNewArticlePresent:j}=hr(R),{ticketNumberWithTicketHook:H}=kt(n);kr({metaTitle:b(()=>{var S;return`${H.value} - ${(S=n.value)==null?void 0:S.title}`})});const x=$e("content-container");Da(x);const O=()=>{te(()=>{var $,P;const S=($=x.value)==null?void 0:$.scrollHeight;S&&((P=x.value)==null||P.scrollTo({top:S}))})},ie=b(()=>m.value&&f.value.group_id?et("Group",f.value.group_id):void 0),{setSkipNextStateUpdate:ge}=gr(V,k,T),{ticketSchema:$t,articleSchema:It,currentArticleType:ye,ticketArticleTypes:St,securityIntegration:Dt,isTicketAgent:Pe,isTicketCustomer:Et,isTicketEditable:le,articleTypeHandler:Bt,articleTypeSelectHandler:xt}=ga(n,k),Re=b(()=>{var S,$,P;return{ticket:n,isTicketEditable:le,screenType:Cr.TicketDetailView,form:k.value,formValues:{customer_id:(S=n.value)==null?void 0:S.customer.internalId,organization_id:(P=($=n.value)==null?void 0:$.organization)==null?void 0:P.internalId},currentTaskbarTabId:V}});yr(Re);const{hasSidebar:Lt,activeSidebar:_e,switchSidebar:He}=ct(),Mt=b(()=>{var S;return(S=f.value.article)==null?void 0:S.internal}),zt=b(()=>_e.value==="information"?"#ticketEditAttributeForm":"#wrapper-form-ticket-edit"),{isArticleFormGroupValid:Ne,newTicketArticlePresent:W,showTicketArticleReplyForm:Ve}=xo(k,j),{liveUserList:Ft}=ya(r,Pe,ia.Desktop);_r({ticket:n,ticketId:i,isTicketEditable:le,form:k,newTicketArticlePresent:W,showTicketArticleReplyForm:Ve,...a});const Ut=Pr({formEditAttributeLocation:zt,securityIntegration:Dt,newTicketArticlePresent:W,currentArticleType:ye}),Pt=[{isLayout:!0,component:"Teleport",props:{to:"$formEditAttributeLocation"},children:[{isLayout:!0,component:"FormGroup",props:{class:"@container/form-group",showDirtyMark:!0},children:[$t]}]},{if:"$newTicketArticlePresent",isLayout:!0,component:"Teleport",props:{to:"#ticketArticleReplyForm"},children:[{isLayout:!0,component:"FormGroup",props:{class:"@container/form-group"},children:[It]}]}],{waitForConfirmation:Rt,waitForVariantConfirmation:Oe}=aa(),{handleScreenBehavior:Ht}=mo(V),je=b(()=>y.value.hasSharedDraft),Nt=b(()=>{var $;return(($=n.value)==null?void 0:$.sharedDraftZoomId)?je.value:!1}),Vt=async()=>{await Oe("unsaved")&&(W.value=!1,await te(),ge(!0),h())},Ot=S=>S.type!==Xe.Forbidden&&S.type!==Xe.RecordNotFound,{isTicketFormGroupValid:Ge,initialTicketValue:Te,editTicket:jt}=_a(n,k,Ot),{openReplyForm:Gt}=vt(k,Ve),Wt=b(()=>W.value?Ge.value&&Ne.value:Ge.value),Qt=b(()=>({taskbarId:V.value})),{notify:Kt}=ve(),Zt=()=>{Wt.value||(_e.value!=="information"&&He("information"),W.value&&!Ne.value&&!o.value&&O()),A()},se=N([]),qt=async S=>{var P;const $=await Rt(__("You have unchecked items in the checklist. Do you want to handle them before closing this ticket?"),{headerTitle:__("Incomplete Ticket Checklist"),headerIcon:"checklist",buttonLabel:__("Yes, open the checklist"),cancelLabel:__("No, just close the ticket")});if($)return _e.value!=="checklist"&&He("checklist"),!1;if($===!1){const q=S.getFirstErrorException();return q&&((P=se.value)==null||P.push(q)),A(),!0}return!1},Y=N(),Jt=Ta({name:"ticket-time-accounting",component:()=>xe(()=>import("./TimeAccountingFlyout-CxNs2q4Y.js"),__vite__mapDeps([61,15,2,3,4,13,1,5,12,7,8,14,16,17,18,62,11,19,20,21,22,23,24,25,26,27,28,29,30,52,43,41]))}),Xt=S=>(Jt.open({onAccountTime:$=>{Y.value=$,A()},onSkip:()=>{var P;const $=S.getFirstErrorException();$&&((P=se.value)==null||P.push($)),A()}}),!1),Yt=S=>S.getFirstErrorException()===tt.ServiceTicketUpdateValidatorChecklistCompletedError?qt(S):S.getFirstErrorException()===tt.ServiceTicketUpdateValidatorTimeAccountingError?Xt(S):!0,{activeMacro:Ce,executeMacro:er,disposeActiveMacro:tr}=Ja(A),rr=async S=>{var P,q;let $=da(S);return(P=ye.value)!=null&&P.updateForm&&($=ye.value.updateForm($)),$.article&&Y.value&&($.article={...$.article,timeUnit:Y.value.time_unit!==void 0?parseFloat(Y.value.time_unit):void 0,accountedTimeTypeId:Y.value.accounted_time_type_id?et("Ticket::TimeAccounting::Type",Y.value.accounted_time_type_id):void 0}),jt($,{macroId:(q=Ce.value)==null?void 0:q.id,skipValidators:se.value}).then(Q=>{var G,Qe;if((G=Q==null?void 0:Q.ticketUpdate)!=null&&G.ticket){Kt({id:"ticket-update",type:fe.Success,message:__("Ticket updated successfully.")});const cr=Ce.value?Za[(Qe=Ce.value)==null?void 0:Qe.uxFlowNextUp]:void 0;return Ht({screenBehaviour:cr,ticket:Q.ticketUpdate.ticket}),se.value.length=0,Y.value=void 0,Z(p,O,{once:!0}),W.value=!1,{reset:(gn,Ke)=>{te(()=>{Ke&&h({values:{ticket:Ke.ticket}})})}}}return!1}).catch(Q=>{var G;if(Q instanceof Kr){if(Q.getFirstErrorException())return Yt(Q);if(se.value.length=0,Y.value=void 0,(G=k.value)!=null&&G.formNode){ra(k.value.formNode,Q);return}}se.value.length=0,Y.value=void 0}).finally(()=>{tr()})},ar=async()=>{if(await Oe("unsaved"))return W.value=!1,await te(),ge(!0),T()},or=(S,$)=>{Gt({articleType:S,...$==null?void 0:$(n.value)})},nr=()=>{Z(()=>y.value.newArticlePresent,S=>{W.value=S})};Z(i,()=>{Te.value=void 0,W.value=void 0});const ir=$e("article-list"),sr=$e("top-bar"),{handleScroll:We,isHoveringOnTopBar:we,isHidingTicketDetails:Ae,isReachingBottom:lr}=Bo(n,x,ir,sr);return(S,$)=>(c(),w(Sa,{name:"ticket-detail","no-padding":"","background-variant":"primary","show-sidebar":e(Lt),"content-alignment":"center","no-scrollable":""},{sideBar:_(({isCollapsed:P,toggleCollapse:q})=>[v(Tr,{"is-collapsed":P,"toggle-collapse":q,context:Re.value},null,8,["is-collapsed","toggle-collapse","context"])]),bottomBar:_(()=>{var P;return[v(uo,{"can-use-draft":je.value,dirty:e(D),disabled:e(d),form:e(k),"group-id":ie.value,"is-ticket-agent":e(Pe),"is-ticket-editable":e(le),"has-available-draft":Nt.value,"live-user-list":e(Ft),"shared-draft-id":(P=e(n))==null?void 0:P.sharedDraftZoomId,"ticket-id":e(i),onSubmit:Zt,onDiscard:Vt,onExecuteMacro:e(er)},null,8,["can-use-draft","dirty","disabled","form","group-id","is-ticket-agent","is-ticket-editable","has-available-draft","live-user-list","shared-draft-id","ticket-id","onExecuteMacro"])]}),default:_(()=>[v($a,{class:"mt-8",loading:!e(n)},{default:_(()=>{var P,q,Q;return[F("div",{ref:"content-container",class:M(["relative grid h-full w-full overflow-y-auto",{"grid-rows-[max-content_max-content_max-content]":!e(W)||!o.value,"grid-rows-[max-content_1fr_max-content]":e(W)&&o.value}]),onScrollPassive:$[4]||($[4]=(...G)=>e(We)&&e(We)(...G))},[F("div",bn,[(c(),w(nt,{key:`${e(Ae)}-ticket-detail-top-bar`,ref:"top-bar",class:"invisible","aria-hidden":"true","hide-details":!1})),v(ze,{name:"slide-down"},{default:_(()=>[(c(),w(nt,{key:`${e(Ae)}-top-bar`,hover:e(we),"onUpdate:hover":$[0]||($[0]=G=>Rr(we)?we.value=G:null),class:"absolute! top-0 right-0 left-0 w-full","hide-details":e(Ae)},null,8,["hover","hide-details"]))]),_:1})]),v(mn,{ref:"article-list","aria-busy":e(u)},null,8,["aria-busy"]),(P=e(n))!=null&&P.id&&e(le)?re((c(),w(vn,{key:0,pinned:o.value,"onUpdate:pinned":$[1]||($[1]=G=>o.value=G),ticket:e(n),"new-article-present":e(W),"create-article-type":(q=e(n).createArticleType)==null?void 0:q.name,"ticket-article-types":e(St),"is-ticket-customer":e(Et),"has-internal-article":Mt.value,"parent-reached-bottom-scroll":e(lr),onShowArticleForm:or,onDiscardForm:ar},null,8,["pinned","ticket","new-article-present","create-article-type","ticket-article-types","is-ticket-customer","has-internal-article","parent-reached-bottom-scroll"])),[[Hr,!e(u)]]):C("",!0),F("div",hn,[(Q=e(n))!=null&&Q.id&&e(Te)?(c(),w(Zr,{key:0,id:`form-ticket-edit-${r.value}`,ref_key:"form",ref:k,"form-id":e(B),schema:Pt,disabled:!e(le),"flatten-form-groups":["ticket"],handlers:[e(Bt)()],"form-kit-plugins":[e(xt)],"schema-data":Ut,"initial-values":e(Te),"initial-entity-object":e(n),"form-updater-id":e(sa).FormUpdaterUpdaterTicketEdit,"form-updater-additional-params":Qt.value,"use-object-attributes":"","schema-component-library":{Teleport:Nr(Vr)},onSubmit:$[2]||($[2]=G=>rr(G)),onSettled:nr,onChanged:$[3]||($[3]=G=>e(ge)(!0))},null,8,["id","form-id","disabled","handlers","form-kit-plugins","schema-data","initial-values","initial-entity-object","form-updater-id","form-updater-additional-params","schema-component-library"])):C("",!0)])],34)]}),_:1},8,["loading"])]),_:1},8,["show-sidebar"]))}}),Di=z({__name:"TicketDetailView",props:{internalId:{}},setup(s){return(t,r)=>(c(),w(wr,null,{default:_(()=>[v(kn,{"internal-id":t.internalId},null,8,["internal-id"])]),_:1}))}});export{Di as default};
//# sourceMappingURL=TicketDetailView-r4CkZnPg.js.map
