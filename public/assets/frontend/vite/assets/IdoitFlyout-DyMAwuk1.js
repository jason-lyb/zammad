import{_ as x}from"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import{u as C}from"./useForm-CUKec4n5.js";import{u as D}from"./useDebouncedLoading-D3djd3bz.js";import{u as N,Q,U as R}from"./apollo-Cj5TVUDk.js";import{_ as A}from"./CommonFlyout.vue_vue_type_script_setup_true_lang-Cr1ukr3s.js";import{c as B}from"./useFlyout-KZXqW5RR.js";import{k as U,d as V}from"./desktop-l0eJ1dZN.js";import{f as j,a1 as H,m as u,D as d,y as b,Q as M,M as P,Y,c as l,ai as z,q as m,u as h}from"./vue-oicRkvo0.js";import{n as k}from"./vendor-C11O1Xx8.js";import{I as G}from"./CommonDropdown.vue_vue_type_script_setup_true_lang-DOCvnZ_a.js";import"./formkit-5nol1GBe.js";import"./overviewAttributes.api-C09LSZ8O.js";import"./routes-CgLO9M4y.js";import"./vite-FJshFMF2.js";import"./lodash-pFOI14f-.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./CommonOverlayContainer.vue_vue_type_script_setup_true_lang-CxyKmNUC.js";import"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";import"./useCopyToClipboard-CjkPg__g.js";import"./theme-Bv2ClBzZ.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./commonjsHelpers-BosuxZz1.js";import"./CommonError.vue_vue_type_script_setup_true_lang-B76hdJ4v.js";import"./LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js";import"./index-DwuY2HL4.js";import"./CommonInlineEdit.vue_vue_type_script_setup_true_lang-Blo3VlqB.js";import"./useHtmlLinks-53b5zJaG.js";import"./pwa-THoW_3xc.js";import"./useBaseUrl-BsZiEKQE.js";import"./useUserDetail-C29_PwWz.js";import"./user.api-BwewaCks.js";import"./ObjectAttributes.vue_vue_type_script_setup_true_lang-B0DrxGTz.js";import"./useDisplayObjectAttributes-sspS-pHp.js";import"./useTicketView-CMOCBKg-.js";import"./CommonSectionCollapse.vue_vue_type_script_setup_true_lang-B-hHJAEI.js";import"./NavigationMenuList.vue_vue_type_script_setup_true_lang-CYOBePFr.js";import"./useTicketAccountedTime-CSL2Xls9.js";import"./useTicketSubscribe-CmWzZx1x.js";import"./useOrganizationDetail-CenI9U-0.js";import"./dom-0wVl69Vp.js";import"./useAttachments-0IU6Vvzp.js";import"./getAttachmentLinks-Dz1qdLDp.js";const J=j({__name:"IdoitObjectList",props:{items:{}},setup(s){const o=[{key:"idoitObjectId",label:"ID",truncate:!0},{key:"title",label:__("Name"),type:"link",truncate:!0},{key:"status",label:__("Status"),truncate:!0}];return(i,r)=>{const n=H("CommonLabel");return i.items.length?(u(),d(U,{key:0,caption:i.$t("Idoit objects"),items:i.items,headers:o,"has-checkbox-column":""},null,8,["caption","items"])):(u(),d(n,{key:1},{default:b(()=>[M(P(i.$t("No results found")),1)]),_:1}))}}}),K=k`
    query autocompleteSearchIdoitObjectTypes($input: AutocompleteSearchInput!) {
  autocompleteSearchIdoitObjectTypes(input: $input) {
    value
    label
  }
}
    `,W=k`
    query ticketExternalReferencesIdoitObjectSearch($idoitTypeId: String, $limit: Int!, $query: String) {
  ticketExternalReferencesIdoitObjectSearch(
    idoitTypeId: $idoitTypeId
    limit: $limit
    query: $query
  ) {
    ...IdoitObjectAttributes
  }
}
    ${G}`;function X(s,o={}){return N(W,s,o)}const p=10,Z=300,_="idoit",Ke=j({__name:"IdoitFlyout",props:{objectIds:{},onSubmit:{type:Function},icon:{}},setup(s){var y,I;const o=s,{form:i,values:r,updateFieldValues:n,onChangedField:f,formSetErrors:O}=C(),a=new Q(X({limit:p,idoitTypeId:(y=r.value)==null?void 0:y.type,query:(I=r.value)==null?void 0:I.filter},{fetchPolicy:"no-cache"}),{errorShowNotification:!1}),S=a.result(),g=a.loading();a.onError(()=>{O(new R([{field:"type",message:__("Error fetching i-doit information. Please contact your administrator.")}]))});const{debouncedLoading:T,loading:$}=D();Y(()=>{$.value=g.value});const v=l(()=>{var t;return((t=S.value)==null?void 0:t.ticketExternalReferencesIdoitObjectSearch.map(e=>({id:e.idoitObjectId,idoitObjectId:e.idoitObjectId,title:{link:e.link,label:e.title,openInNewTab:!0,external:!0},status:e.status,disabled:o.objectIds.includes(e.idoitObjectId),checked:o.objectIds.includes(e.idoitObjectId)})))||[]});f("filter",z(t=>{var e;return a.refetch({limit:p,idoitTypeId:(e=r.value)==null?void 0:e.type,query:t})},Z)),f("type",async t=>{var e;return a.refetch({limit:p,idoitTypeId:t,query:(e=r.value)==null?void 0:e.filter})});const E=[{type:"autocomplete",name:"type",label:__("Type"),props:{gqlQuery:K,clearable:!0,defaultFilter:"*",classes:{outer:"mb-3"}}},{type:"text",name:"filter",label:__("Filter"),placeholder:__("Searchâ€¦"),props:{prefixIcon:"search",classes:{input:"rtl:pr-2 ltr:pl-1 ltr:pl-2 rtl:pr-1",outer:"mb-4"}}},{type:"hidden",name:"objectIds"}],F=t=>n({objectIds:t.filter(e=>!e.disabled).map(({idoitObjectId:e})=>e)}),q=l(()=>o.objectIds.map(t=>t.toString())),L=l(()=>{var t,e;return(((e=(t=r.value)==null?void 0:t.objectIds)==null?void 0:e.filter(c=>!o.objectIds.includes(c)))||[]).length>0}),w=async t=>(await o.onSubmit(t),()=>B(_));return(t,e)=>(u(),d(A,{"header-icon":t.icon,"header-title":t.__("i-doit: Link objects"),name:_,"no-close-on-action":"","footer-action-options":{actionLabel:t.$t("Link Objects"),actionButton:{type:"submit",disabled:!L.value},form:h(i)}},{default:b(()=>[m(x,{ref_key:"form",ref:i,"should-autofocus":"",schema:E,onSubmit:e[0]||(e[0]=c=>w(c))},null,512),m(V,{loading:h(T)},{default:b(()=>[m(J,{class:"w-full",items:v.value,"disabled-checkbox-ids":q.value,"onUpdate:checkedRows":F},null,8,["items","disabled-checkbox-ids"])]),_:1},8,["loading"])]),_:1},8,["header-icon","header-title","footer-action-options"]))}});export{Ke as default};
//# sourceMappingURL=IdoitFlyout-DyMAwuk1.js.map
