const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PersonalSettingAvatarCameraFlyout-BUKcwoOD.js","assets/vue-oicRkvo0.js","assets/vendor-C11O1Xx8.js","assets/commonjsHelpers-BosuxZz1.js","assets/desktop-l0eJ1dZN.js","assets/overviewAttributes.api-C09LSZ8O.js","assets/routes-CgLO9M4y.js","assets/vite-FJshFMF2.js","assets/apollo-Cj5TVUDk.js","assets/lodash-pFOI14f-.js","assets/formkit-5nol1GBe.js","assets/overviewAttributes-r_4zXopK.css","assets/Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js","assets/FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js","assets/Form-BSACsGR2.css","assets/useForm-CUKec4n5.js","assets/useCopyToClipboard-CjkPg__g.js","assets/theme-Bv2ClBzZ.js","assets/datepicker-BBNcWeHz.js","assets/date-B2UyDZN7.js","assets/autocompleteTags.api-CG5-cm_A.js","assets/autocompleteSearchTicket.api-DfOQWGlO.js","assets/ticketUpdates.api-BhGIG_Ti.js","assets/ticketAttributes.api-rqx5ITab.js","assets/useTicketCreateArticleType-D7iVcJ_6.js","assets/types-Cu-Nkl7K.js","assets/useTicketCreateView-HCH46SPv.js","assets/desktop-BAkSnNV9.css","assets/CommonFlyout.vue_vue_type_script_setup_true_lang-Cr1ukr3s.js","assets/CommonOverlayContainer.vue_vue_type_script_setup_true_lang-CxyKmNUC.js","assets/LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js","assets/useFlyout-KZXqW5RR.js","assets/PersonalSettingAvatarCameraFlyout-B1NvYBbf.css","assets/PersonalSettingAvatarCropImageFlyout-EITg1h1N.js","assets/style-CXWFjTBn.js","assets/style-Bakm0czn.css","assets/PersonalSettingAvatarCropImageFlyout-q1ZYC6dY.css"])))=>i.map(i=>d[i]);
import{_ as N}from"./vite-FJshFMF2.js";import{f as te,c as x,a7 as ae,a1 as re,m as l,D as B,y as d,q as n,I as c,Q as b,M as y,p as _,x as se,J as z,u as o,H as m,L as C,E}from"./vue-oicRkvo0.js";import{n as L,u as oe}from"./vendor-C11O1Xx8.js";import{X as ne,ap as ie,_ as ue,b7 as le,b8 as ce,aZ as de,a2 as me}from"./overviewAttributes.api-C09LSZ8O.js";import{e as pe,u as fe,Q as ve,M as h,N as k,c as _e,f as ge}from"./apollo-Cj5TVUDk.js";import{u as Ae,a as be}from"./userCurrentAvatarDelete.api-BdjimpWn.js";import{a as ye,e as Ce}from"./routes-CgLO9M4y.js";import{c as $,r as he,d as ke}from"./desktop-l0eJ1dZN.js";import{u as H}from"./useFlyout-KZXqW5RR.js";import{a as $e}from"./LayoutContent.vue_vue_type_script_setup_true_lang-SafgfcNL.js";import{u as we}from"./useBreadcrumb-DUhE6wbZ.js";import"./commonjsHelpers-BosuxZz1.js";import"./lodash-pFOI14f-.js";import"./formkit-5nol1GBe.js";import"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./useForm-CUKec4n5.js";import"./useCopyToClipboard-CjkPg__g.js";import"./theme-Bv2ClBzZ.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./LayoutMain.vue_vue_type_script_setup_true_lang-DIWzj6-0.js";import"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";import"./useResizeGridColumns-CieKHty_.js";const Le=L`
    mutation userCurrentAvatarSelect($id: ID!) {
  userCurrentAvatarSelect(id: $id) {
    success
    errors {
      ...errors
    }
  }
}
    ${ne}`;function De(p={}){return pe(Le,p)}const w=L`
    query userCurrentAvatarList {
  userCurrentAvatarList {
    id
    default
    deletable
    initial
    imageHash
    createdAt
    updatedAt
  }
}
    `;function Me(p={}){return fe(w,{},p)}const Se=L`
    subscription userCurrentAvatarUpdates {
  userCurrentAvatarUpdates {
    avatars {
      id
      default
      deletable
      initial
      imageHash
      createdAt
      updatedAt
    }
  }
}
    `,Ue={class:"mb-4"},Te={class:"rounded-lg bg-blue-200 dark:bg-gray-700"},Qe={class:"flex flex-row flex-wrap gap-2.5 p-2.5"},Ie=["aria-label","onClick"],Ne={key:1,class:"group/avatar relative flex"},xe=["aria-label","onClick"],Be={class:"w-full p-1 text-center"},ze=["accept"],_t=te({__name:"PersonalSettingAvatar",setup(p){const{user:f}=oe(ye()),{breadcrumbItems:F}=we(__("Avatar")),{notify:g}=_e(),V=Ce(),P=String(V.config.api_path),{isTouchDevice:q}=ie(),A=new ve(Me()),R=A.result(),Y=A.loading();A.subscribeToMore({document:Se,updateQuery:(e,{subscriptionData:r})=>{var t;return(t=r.data)!=null&&t.userCurrentAvatarUpdates.avatars?{userCurrentAvatarList:r.data.userCurrentAvatarUpdates.avatars}:null}});const v=x(()=>{var e;return((e=R.value)==null?void 0:e.userCurrentAvatarList)||[]}),D=x(()=>v.value.find(e=>e.default)),M=ae("file-upload"),O=H({name:"avatar-camera-capture",component:()=>N(()=>import("./PersonalSettingAvatarCameraFlyout-BUKcwoOD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]))}),J=H({name:"avatar-file-upload",component:()=>N(()=>import("./PersonalSettingAvatarCropImageFlyout-EITg1h1N.js"),__vite__mapDeps([33,34,1,2,3,35,5,6,7,8,9,10,11,28,4,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,29,30,31,36]))}),i=(e,r,t)=>{r&&e.modify({id:e.identify(r),fields:{default(){return t}}})},S=e=>{if(!e)return;new h(Ae({variables:{images:{original:e,resized:{name:"resized_avatar.png",type:"image/png",content:e.content}}},update:(t,{data:a})=>{if(!a)return;const{userCurrentAvatarAdd:s}=a;if(!(s!=null&&s.avatar)||v.value.find(ee=>{var I;return ee.id===((I=s.avatar)==null?void 0:I.id)}))return;i(t,D.value,!1);let u=t.readQuery({query:w});u={...u,userCurrentAvatarList:[...(u==null?void 0:u.userCurrentAvatarList)||[],s.avatar]},t.writeQuery({query:w,data:u})}}),{errorNotificationMessage:__("The avatar could not be uploaded.")}).send().then(t=>{var a;(a=t==null?void 0:t.userCurrentAvatarAdd)!=null&&a.avatar&&(f.value&&(f.value.image=t.userCurrentAvatarAdd.avatar.imageHash),g({id:"avatar-upload-success",type:k.Success,message:__("Your avatar has been uploaded.")}))})},X=()=>{var e;(e=M.value)==null||e.click()},Z=()=>{O.open({onAvatarCaptured:e=>{S(e)}})},j=async e=>{const r=e==null?void 0:e.files;if(!r)return;const[t]=await de(r);J.open({image:t,onImageCropped:a=>S(a)}),e.value=""},U=e=>{const{cache:r}=ge(),t=D.value;i(r,t,!1),i(r,e,!0),new h(De(()=>({variables:{id:e.id}})),{errorNotificationMessage:__("The avatar could not be selected.")}).send().then(()=>{g({id:"avatar-select-success",type:k.Success,message:__("Your avatar has been changed.")})}).catch(()=>{i(r,t,!0),i(r,e,!1)})},G=e=>{new h(be(()=>({variables:{id:e.id},update(t){e.default&&i(t,v.value[0],!0),t.evict({id:t.identify(e)}),t.gc()}})),{errorNotificationMessage:__("The avatar could not be deleted.")}).send().then(()=>{g({id:"avatar-delete-success",type:k.Success,message:__("Your avatar has been deleted.")})})},{waitForVariantConfirmation:K}=me(),W=async e=>{await K("delete")&&G(e)},T=["cursor-pointer","outline-transparent","hover:outline-blue-900","rounded-full","outline","outline-3","focus:outline-blue-800","hover:focus:outline-blue-800"],Q=e=>({"outline-blue-800 hover:outline-blue-800":e});return(e,r)=>{const t=re("CommonLabel");return l(),B($e,{"breadcrumb-items":o(F),width:"narrow"},{default:d(()=>[n(ke,{loading:o(Y)},{default:d(()=>[c("div",Ue,[n(t,{class:"!mt-0.5 mb-1 !block"},{default:d(()=>[b(y(e.$t("Your avatar")),1)]),_:1}),c("div",Te,[c("div",Qe,[(l(!0),_(z,null,se(v.value,a=>(l(),_(z,{key:a.id},[a.initial&&o(f)?(l(),_("button",{key:0,"aria-label":e.$t("Select this avatar"),class:m([...T,Q(a.default)]),onClick:C(s=>a.default?void 0:U(a),["stop"])},[n(ue,{class:m([{"avatar-selected":a.default},"!flex border-neutral-100 dark:border-gray-900"]),entity:o(f),size:"large","initials-only":"",personal:"","no-indicator":"","no-muted":""},null,8,["class","entity"])],10,Ie)):a.imageHash?(l(),_("div",Ne,[c("button",{"aria-label":e.$t("Select this avatar"),class:m([...T,Q(a.default)]),onClick:C(s=>a.default?void 0:U(a),["stop"])},[n(le,{class:m([{"avatar-selected":a.default},"!flex border-neutral-100 dark:border-gray-900"]),image:`${o(P)}/users/image/${a.imageHash}`,size:"large"},null,8,["class","image"])],10,xe),a.deletable?(l(),B($,{key:0,"aria-label":e.$t("Delete this avatar"),class:m([{"opacity-0 transition-opacity":!o(q)},"absolute -end-2 -top-1 text-white group-hover/avatar:opacity-100 focus:opacity-100"]),icon:"x-lg",size:"small",variant:"remove",onClick:C(s=>W(a),["stop"])},null,8,["aria-label","class","onClick"])):E("",!0)])):E("",!0)],64))),128))]),n(he,{padding:""}),c("div",Be,[c("input",{ref:"file-upload",accept:o(ce)(),"aria-hidden":"true",class:"hidden",type:"file",onChange:r[0]||(r[0]=a=>j(o(M)))},null,40,ze),n($,{class:"m-1",size:"medium","prefix-icon":"image",onClick:X},{default:d(()=>[b(y(e.$t("Upload")),1)]),_:1}),n($,{class:"m-1",size:"medium","prefix-icon":"camera",onClick:Z},{default:d(()=>[b(y(e.$t("Camera")),1)]),_:1})])])])]),_:1},8,["loading"])]),_:1},8,["breadcrumb-items"])}}});export{_t as default};
//# sourceMappingURL=PersonalSettingAvatar-nNuPqfa2.js.map
