{"version":3,"file":"PersonalSettingAvatarCameraFlyout-BUKcwoOD.js","sources":["../../../../../app/frontend/apps/desktop/pages/personal-setting/components/PersonalSettingAvatarCameraFlyout.vue"],"sourcesContent":["<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { useUserMedia, usePermission } from '@vueuse/core'\nimport { computed, ref, watch } from 'vue'\n\nimport type { ImageFileData } from '#shared/utils/files.ts'\n\nimport CommonButton from '#desktop/components/CommonButton/CommonButton.vue'\nimport CommonFlyout from '#desktop/components/CommonFlyout/CommonFlyout.vue'\n\ndefineEmits<{\n  'avatar-captured': [ImageFileData | undefined]\n}>()\n\nconst image = ref<ImageFileData>()\n\nconst canvasHeight = 256\nconst canvasWidth = 256\n\nconst cameraAccess = usePermission('camera')\nconst cameraIsDisabled = computed(\n  () => !cameraAccess.value || cameraAccess.value === 'denied',\n)\n\nconst cameraIcon = computed(() =>\n  cameraIsDisabled.value ? 'camera-video-off' : 'camera-video',\n)\n\nconst { stream, start, stop } = useUserMedia({\n  constraints: {\n    video: {\n      width: 256,\n      height: 256,\n    },\n  },\n})\n\nif (!cameraIsDisabled.value) start()\n\nconst getCanvasObject = () => {\n  const canvas = document.querySelector('canvas')\n  if (!canvas) return\n\n  return canvas\n}\n\nconst getCanvas2dContext = (canvas: HTMLCanvasElement) => {\n  if (!canvas) return\n\n  const context = canvas.getContext('2d')\n  if (!context) return\n\n  return context\n}\n\nconst discardImage = () => {\n  if (image.value) {\n    image.value = undefined\n  }\n\n  const canvas = getCanvasObject()\n  if (!canvas) return\n\n  getCanvas2dContext(canvas)?.clearRect(0, 0, canvas.width, canvas.height)\n}\n\nwatch(cameraIsDisabled, (isDisabled) => {\n  if (isDisabled) {\n    discardImage()\n    stop()\n\n    return\n  }\n\n  start()\n})\n\nconst captureImage = () => {\n  if (!stream.value) return\n\n  const canvas = getCanvasObject()\n  if (!canvas) return\n\n  const context = getCanvas2dContext(canvas)\n  if (!context) return\n\n  canvas.width = canvasWidth\n  canvas.height = canvasHeight\n\n  const video = document.querySelector('video')\n\n  if (!video) return\n\n  context.translate(canvasWidth, 0)\n  context.scale(-1, 1)\n  context.drawImage(\n    video,\n    (video.videoWidth - video.videoHeight) / 2,\n    0,\n    video.videoHeight,\n    video.videoHeight,\n    0,\n    0,\n    canvasWidth,\n    canvasHeight,\n  )\n\n  image.value = {\n    content: canvas.toDataURL('image/png'),\n    name: 'avatar.png',\n    type: 'image/png',\n  }\n}\n</script>\n\n<template>\n  <CommonFlyout\n    :header-title=\"__('Camera')\"\n    :footer-action-options=\"{\n      actionLabel: __('Save'),\n      actionButton: { variant: 'submit', disabled: !image },\n    }\"\n    header-icon=\"camera\"\n    name=\"avatar-camera-capture\"\n    @action=\"$emit('avatar-captured', image)\"\n    @close=\"stop\"\n  >\n    <div class=\"flex flex-col items-center gap-6 pt-12 pb-10\">\n      <canvas\n        v-show=\"image\"\n        class=\"h-64 min-h-64 w-64 min-w-64 rounded-full border border-black dark:border-white\"\n      >\n      </canvas>\n\n      <div\n        v-if=\"!image\"\n        class=\"relative h-64 min-h-64 w-64 min-w-64 overflow-hidden rounded-full border border-black bg-blue-200 text-stone-200 dark:border-white dark:bg-gray-700 dark:text-neutral-500\"\n      >\n        <CommonIcon\n          :name=\"cameraIcon\"\n          size=\"xl\"\n          class=\"absolute top-1/2 -translate-y-1/2 ltr:left-1/2 ltr:-translate-x-1/2 rtl:right-1/2 rtl:translate-x-1/2\"\n        />\n        <!-- eslint-disable vuejs-accessibility/media-has-caption -->\n        <video\n          v-show=\"!cameraIsDisabled\"\n          class=\"h-full w-full object-cover\"\n          :aria-label=\"$t('Use the camera to take a photo for the avatar.')\"\n          :srcObject=\"stream\"\n          autoplay\n        />\n      </div>\n\n      <CommonAlert v-if=\"cameraIsDisabled\" variant=\"danger\">\n        {{\n          $t('Accessing your camera is forbidden. Please check your settings.')\n        }}\n      </CommonAlert>\n\n      <div v-else class=\"flex flex-row gap-2\">\n        <CommonButton\n          v-if=\"!image\"\n          variant=\"primary\"\n          size=\"medium\"\n          @click=\"captureImage\"\n        >\n          {{ $t('Capture From Camera') }}\n        </CommonButton>\n        <CommonButton\n          v-else\n          variant=\"remove\"\n          size=\"medium\"\n          @click=\"discardImage\"\n        >\n          {{ $t('Discard Snapshot') }}\n        </CommonButton>\n      </div>\n    </div>\n  </CommonFlyout>\n</template>\n\n<style scoped>\nvideo {\n  transform: rotateY(180deg);\n}\n</style>\n"],"names":["canvasHeight","canvasWidth","image","ref","cameraAccess","usePermission","cameraIsDisabled","computed","cameraIcon","stream","start","stop","useUserMedia","getCanvasObject","canvas","getCanvas2dContext","context","discardImage","_a","watch","isDisabled","captureImage","video"],"mappings":"4sDAiBMA,EAAe,IACfC,EAAc,uFAHpB,MAAMC,EAAQC,IAKRC,EAAeC,EAAc,QAAQ,EACrCC,EAAmBC,EACvB,IAAM,CAACH,EAAa,OAASA,EAAa,QAAU,QAAA,EAGhDI,EAAaD,EAAS,IAC1BD,EAAiB,MAAQ,mBAAqB,cAAA,EAG1C,CAAE,OAAAG,EAAQ,MAAAC,EAAO,KAAAC,CAAA,EAASC,EAAa,CAC3C,YAAa,CACX,MAAO,CACL,MAAO,IACP,OAAQ,GACV,CACF,CAAA,CACD,EAEIN,EAAiB,OAAaI,IAEnC,MAAMG,EAAkB,IAAM,CACtB,MAAAC,EAAS,SAAS,cAAc,QAAQ,EAC9C,GAAKA,EAEE,OAAAA,CAAA,EAGHC,EAAsBD,GAA8B,CACxD,GAAI,CAACA,EAAQ,OAEP,MAAAE,EAAUF,EAAO,WAAW,IAAI,EACtC,GAAKE,EAEE,OAAAA,CAAA,EAGHC,EAAe,IAAM,OACrBf,EAAM,QACRA,EAAM,MAAQ,QAGhB,MAAMY,EAASD,IACVC,KAEcI,EAAAH,EAAAD,CAAM,IAAN,MAAAI,EAAS,UAAU,EAAG,EAAGJ,EAAO,MAAOA,EAAO,QAAM,EAGnEK,EAAAb,EAAmBc,GAAe,CACtC,GAAIA,EAAY,CACDH,IACRN,IAEL,MACF,CAEMD,GAAA,CACP,EAED,MAAMW,EAAe,IAAM,CACrB,GAAA,CAACZ,EAAO,MAAO,OAEnB,MAAMK,EAASD,IACf,GAAI,CAACC,EAAQ,OAEP,MAAAE,EAAUD,EAAmBD,CAAM,EACzC,GAAI,CAACE,EAAS,OAEdF,EAAO,MAAQb,EACfa,EAAO,OAASd,EAEV,MAAAsB,EAAQ,SAAS,cAAc,OAAO,EAEvCA,IAEGN,EAAA,UAAUf,EAAa,CAAC,EACxBe,EAAA,MAAM,GAAI,CAAC,EACXA,EAAA,UACNM,GACCA,EAAM,WAAaA,EAAM,aAAe,EACzC,EACAA,EAAM,YACNA,EAAM,YACN,EACA,EACArB,EACAD,CAAA,EAGFE,EAAM,MAAQ,CACZ,QAASY,EAAO,UAAU,WAAW,EACrC,KAAM,aACN,KAAM,WAAA,EACR"}