import{Q as G,M as O,N as P,c as R}from"./apollo-Cj5TVUDk.js";import{_ as q,Z as S,a2 as U}from"./overviewAttributes.api-C09LSZ8O.js";import{u as J}from"./useForm-CUKec4n5.js";import{c as p,E as c,F as _}from"./desktop-l0eJ1dZN.js";import{_ as K}from"./CommonFlyout.vue_vue_type_script_setup_true_lang-Cr1ukr3s.js";import{c as W}from"./useFlyout-KZXqW5RR.js";import{f as X,c as y,t as Y,a1 as k,m as d,D as h,y as a,I as l,q as r,Q as m,M as f,p as ee,E as v,u as te}from"./vue-oicRkvo0.js";import"./vendor-C11O1Xx8.js";import"./commonjsHelpers-BosuxZz1.js";import"./lodash-pFOI14f-.js";import"./routes-CgLO9M4y.js";import"./vite-FJshFMF2.js";import"./formkit-5nol1GBe.js";import"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./useCopyToClipboard-CjkPg__g.js";import"./theme-Bv2ClBzZ.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./CommonOverlayContainer.vue_vue_type_script_setup_true_lang-CxyKmNUC.js";import"./LayoutSidebar.vue_vue_type_script_setup_true_lang-BO1pkKrb.js";const ae={key:0,class:"flex flex-col gap-3"},re={class:"flex items-start gap-y-3"},oe={class:"flex items-center gap-1.5"},ne=["innerHTML"],ie={class:"flex items-center justify-end gap-4"},A="shared-draft",Ie=X({__name:"TicketSharedDraftFlyout",props:{sharedDraftId:{},form:{},draftType:{},metaInformationQuery:{},deleteMutation:{}},emits:["shared-draft-applied","shared-draft-deleted"],setup(N,{emit:$}){const o=N,T=$,{metaInformationQuery:B,deleteMutation:F}=o,D=new G(B({sharedDraftId:o.sharedDraftId})),b=D.result(),n=y(()=>{var e,t;return o.draftType==="start"?(e=b.value)==null?void 0:e.ticketSharedDraftStartSingle:(t=b.value)==null?void 0:t.ticketSharedDraftZoomShow}),C=y(()=>o.draftType==="start"?n.value.content.body:n.value.newArticle.body),u=()=>{W(A)},{waitForConfirmation:L,waitForVariantConfirmation:M}=U(),{notify:Q}=R(),I=new O(F({})),{isDirty:V,triggerFormUpdater:H,updateFieldValues:z,values:g}=J(Y(o,"form")),x=async e=>{await M("delete")&&I.send({sharedDraftId:e}).then(()=>{(o.draftType==="start"&&S("Ticket::SharedDraftStart",Number(g.value.shared_draft_id))===e||o.draftType==="detail-view"&&S("Ticket::SharedDraftZoom",Number(g.value.shared_draft_id))===e)&&z({shared_draft_id:null}),Q({id:"shared-draft-deleted",type:P.Success,message:__("Shared draft has been deleted.")}),T("shared-draft-deleted",e),u()})},E=async e=>{if(V.value&&!await L(__("There is existing content. Do you want to overwrite it?"),{headerTitle:__("Apply Draft"),buttonLabel:__("Overwrite Content"),buttonVariant:"danger"}))return;const t={sharedDraftId:e,draftType:o.draftType};H({additionalParams:t}),T("shared-draft-applied",e),u()},Z=y(()=>o.draftType==="start"?__("Preview Shared Draft"):__("Apply Shared Draft"));return(e,t)=>{const w=k("CommonLabel"),j=k("CommonDateTime");return d(),h(K,{"header-title":Z.value,"footer-action-options":{actionLabel:e.__("Apply"),actionButton:{variant:"primary"}},"header-icon":"file-text",name:A,onActivated:t[2]||(t[2]=i=>te(D).refetch())},{footer:a(()=>[l("div",ie,[r(p,{size:"large",variant:"secondary",onClick:u},{default:a(()=>[m(f(e.$t("Cancel & Go Back")),1)]),_:1}),r(p,{size:"large",variant:"danger",onClick:t[0]||(t[0]=i=>x(e.sharedDraftId))},{default:a(()=>[m(f(e.$t("Delete")),1)]),_:1}),r(p,{size:"large",variant:"primary",onClick:t[1]||(t[1]=i=>E(e.sharedDraftId))},{default:a(()=>[m(f(e.$t("Apply")),1)]),_:1})])]),default:a(()=>{var i;return[n.value?(d(),ee("div",ae,[l("div",re,[(i=n.value)!=null&&i.updatedBy?(d(),h(c,{key:0,class:"grow"},{default:a(()=>[r(_,{label:e.__("Author")},{default:a(()=>{var s;return[l("div",oe,[r(q,{entity:(s=n.value)==null?void 0:s.updatedBy,size:"small"},null,8,["entity"]),r(w,null,{default:a(()=>[m(f(n.value.updatedBy.fullname),1)]),_:1})])]}),_:1},8,["label"])]),_:1})):v("",!0),r(c,{class:"grow"},{default:a(()=>[r(_,{label:e.__("Last changed")},{default:a(()=>{var s;return[r(j,{"date-time":(s=n.value)==null?void 0:s.updatedAt},null,8,["date-time"])]}),_:1},8,["label"])]),_:1})]),C.value?(d(),h(c,{key:0},{default:a(()=>[r(_,{label:e.__("Text")},{default:a(()=>[l("span",{innerHTML:C.value},null,8,ne)]),_:1},8,["label"])]),_:1})):v("",!0)])):v("",!0)]}),_:1},8,["header-title","footer-action-options"])}}});export{Ie as default};
//# sourceMappingURL=TicketSharedDraftFlyout-D8RqO8NH.js.map
