{"version":3,"file":"UserDetailView-JJwUU-gz.js","sources":["../../../../../app/frontend/apps/mobile/pages/user/views/UserDetailView.vue"],"sourcesContent":["<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { computed, ref, toRef } from 'vue'\n\nimport CommonUserAvatar from '#shared/components/CommonUserAvatar/CommonUserAvatar.vue'\nimport ObjectAttributes from '#shared/components/ObjectAttributes/ObjectAttributes.vue'\nimport { useOnlineNotificationSeen } from '#shared/composables/useOnlineNotification/useOnlineNotificationSeen.ts'\nimport { useUserDetail } from '#shared/entities/user/composables/useUserDetail.ts'\nimport { useErrorHandler } from '#shared/errors/useErrorHandler.ts'\n\nimport CommonButtonGroup from '#mobile/components/CommonButtonGroup/CommonButtonGroup.vue'\nimport type { CommonButtonOption } from '#mobile/components/CommonButtonGroup/types.ts'\nimport CommonLoader from '#mobile/components/CommonLoader/CommonLoader.vue'\nimport CommonOrganizationsList from '#mobile/components/CommonOrganizationsList/CommonOrganizationsList.vue'\nimport CommonTicketStateList from '#mobile/components/CommonTicketStateList/CommonTicketStateList.vue'\nimport { useHeader } from '#mobile/composables/useHeader.ts'\nimport { useOrganizationTicketsCount } from '#mobile/entities/organization/composables/useOrganizationTicketsCount.ts'\nimport { useUserEdit } from '#mobile/entities/user/composables/useUserEdit.ts'\nimport { useUsersTicketsCount } from '#mobile/entities/user/composables/useUserTicketsCount.ts'\n\ninterface Props {\n  internalId: number\n}\n\nconst props = defineProps<Props>()\n\nconst { createQueryErrorHandler } = useErrorHandler()\n\nconst errorCallback = createQueryErrorHandler({\n  notFound: __(\n    'User with specified ID was not found. Try checking the URL for errors.',\n  ),\n  forbidden: __('You have insufficient rights to view this user.'),\n})\n\nconst {\n  user,\n  userQuery,\n  loading,\n  objectAttributes,\n  secondaryOrganizations,\n  loadAllSecondaryOrganizations,\n} = useUserDetail(toRef(props, 'internalId'), errorCallback)\n\nuseOnlineNotificationSeen(user)\n\nconst { openEditUserDialog } = useUserEdit()\n\nuseHeader({\n  title: __('User'),\n  backUrl: '/',\n  actionTitle: __('Edit'),\n  actionHidden: computed(() => user.value == null || !user.value.policy.update),\n  refetch: computed(() => user.value != null && userQuery.loading().value),\n  onAction() {\n    if (!user.value || !user.value.policy.update) return\n    openEditUserDialog(user.value)\n  },\n})\n\nenum TicketLinksState {\n  User = 'user',\n  Organization = 'organization',\n}\n\nconst ticketView = ref(TicketLinksState.User)\n\nconst ticketButtons = computed<CommonButtonOption[]>(() => {\n  if (!user.value?.organization) return []\n  return [\n    {\n      label: __('Their tickets'),\n      value: TicketLinksState.User,\n      controls: `tab-${TicketLinksState.User}`,\n    },\n    {\n      label: __('Organization tickets'),\n      value: TicketLinksState.Organization,\n      controls: `tab-${TicketLinksState.Organization}`,\n    },\n  ]\n})\n\nconst { getTicketData: getOrganizationTicketsData } =\n  useOrganizationTicketsCount()\nconst { getTicketData: getUserTicketsData } = useUsersTicketsCount()\n\nconst ticketsData = computed(() => {\n  if (!user.value) return null\n\n  if (ticketView.value === TicketLinksState.User) {\n    return getUserTicketsData(user.value)\n  }\n\n  const { organization } = user.value\n\n  if (!organization) return null\n\n  return getOrganizationTicketsData(organization)\n})\n</script>\n\n<template>\n  <div v-if=\"user\" class=\"px-4\">\n    <div class=\"flex flex-col items-center justify-center py-6\">\n      <div>\n        <CommonUserAvatar :entity=\"user\" size=\"xl\" />\n      </div>\n      <div class=\"mt-2 line-clamp-3 text-center text-xl font-bold\">\n        {{ user.fullname }}\n      </div>\n      <CommonLink\n        v-if=\"user.organization\"\n        data-test-id=\"organization-link\"\n        :link=\"`/organizations/${user.organization.internalId}`\"\n        class=\"text-blue text-center text-base\"\n      >\n        {{ user.organization.name }}\n      </CommonLink>\n    </div>\n\n    <ObjectAttributes\n      :attributes=\"objectAttributes\"\n      :object=\"user\"\n      :skip-attributes=\"['firstname', 'lastname']\"\n    />\n\n    <CommonOrganizationsList\n      :organizations=\"secondaryOrganizations.array\"\n      :total-count=\"secondaryOrganizations.totalCount\"\n      :disable-show-more=\"loading\"\n      :label=\"__('Secondary organizations')\"\n      @show-more=\"loadAllSecondaryOrganizations()\"\n    />\n\n    <CommonTicketStateList\n      v-if=\"ticketsData\"\n      :id=\"`tab-${ticketView}`\"\n      :create-link=\"ticketsData.createLink\"\n      :create-label=\"ticketsData.createLabel\"\n      :counts=\"ticketsData.count\"\n      :tickets-link-query=\"ticketsData.query\"\n      role=\"tabpanel\"\n      aria-live=\"polite\"\n    >\n      <template #before-fields>\n        <CommonButtonGroup\n          v-if=\"ticketButtons.length\"\n          v-model=\"ticketView\"\n          as=\"tabs\"\n          class=\"py-2\"\n          :options=\"ticketButtons\"\n        />\n      </template>\n    </CommonTicketStateList>\n  </div>\n  <CommonLoader v-else :loading=\"loading\" />\n</template>\n"],"names":["props","__props","createQueryErrorHandler","useErrorHandler","errorCallback","user","userQuery","loading","objectAttributes","secondaryOrganizations","loadAllSecondaryOrganizations","useUserDetail","toRef","useOnlineNotificationSeen","openEditUserDialog","useUserEdit","useHeader","computed","ticketView","ref","ticketButtons","_a","getOrganizationTicketsData","useOrganizationTicketsCount","getUserTicketsData","useUsersTicketsCount","ticketsData","organization"],"mappings":"2nDAyBA,MAAMA,EAAQC,EAER,CAAE,wBAAAC,GAA4BC,IAE9BC,EAAgBF,EAAwB,CAC5C,SAAU,GACR,wEACF,EACA,UAAW,GAAG,iDAAiD,CAAA,CAChE,EAEK,CACJ,KAAAG,EACA,UAAAC,EACA,QAAAC,EACA,iBAAAC,EACA,uBAAAC,EACA,8BAAAC,CAAA,EACEC,EAAcC,EAAMZ,EAAO,YAAY,EAAGI,CAAa,EAE3DS,EAA0BR,CAAI,EAExB,KAAA,CAAE,mBAAAS,GAAuBC,IAErBC,EAAA,CACR,MAAO,GAAG,MAAM,EAChB,QAAS,IACT,YAAa,GAAG,MAAM,EACtB,aAAcC,EAAS,IAAMZ,EAAK,OAAS,MAAQ,CAACA,EAAK,MAAM,OAAO,MAAM,EAC5E,QAASY,EAAS,IAAMZ,EAAK,OAAS,MAAQC,EAAU,QAAQ,EAAE,KAAK,EACvE,UAAW,CACL,CAACD,EAAK,OAAS,CAACA,EAAK,MAAM,OAAO,QACtCS,EAAmBT,EAAK,KAAK,CAC/B,CAAA,CACD,EAOK,MAAAa,EAAaC,EAAI,QAEjBC,EAAgBH,EAA+B,IAAM,OACzD,OAAKI,EAAAhB,EAAK,QAAL,MAAAgB,EAAY,aACV,CACL,CACE,MAAO,GAAG,eAAe,EACzB,MAAO,OACP,SAAU,UACZ,EACA,CACE,MAAO,GAAG,sBAAsB,EAChC,MAAO,eACP,SAAU,kBACZ,CAAA,EAXoC,CAAA,CAYtC,CACD,EAEK,CAAE,cAAeC,CAA2B,EAChDC,EAA4B,EACxB,CAAE,cAAeC,CAAmB,EAAIC,EAAqB,EAE7DC,EAAcT,EAAS,IAAM,CAC7B,GAAA,CAACZ,EAAK,MAAc,OAAA,KAEpB,GAAAa,EAAW,QAAU,OAChB,OAAAM,EAAmBnB,EAAK,KAAK,EAGhC,KAAA,CAAE,aAAAsB,CAAa,EAAItB,EAAK,MAE1B,OAACsB,EAEEL,EAA2BK,CAAY,EAFpB,IAEoB,CAC/C"}