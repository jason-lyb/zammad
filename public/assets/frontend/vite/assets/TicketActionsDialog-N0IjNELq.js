const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FieldAutoCompleteInputDialog-C-a_8s03.js","assets/vue-oicRkvo0.js","assets/vendor-C11O1Xx8.js","assets/commonjsHelpers-BosuxZz1.js","assets/apollo-Cj5TVUDk.js","assets/lodash-pFOI14f-.js","assets/overviewAttributes.api-C09LSZ8O.js","assets/routes-CgLO9M4y.js","assets/vite-FJshFMF2.js","assets/formkit-5nol1GBe.js","assets/overviewAttributes-r_4zXopK.css","assets/mobile-Bk4bKGxF.js","assets/pwa-THoW_3xc.js","assets/add.api-CxwFhgGn.js","assets/datepicker-BBNcWeHz.js","assets/date-B2UyDZN7.js","assets/mobile-Crnk7LCD.css","assets/CommonDialog.vue_vue_type_script_setup_true_lang-CID2Z6MI.js","assets/FieldAutoCompleteInputDialog-n1TW5Bar.css","assets/TicketActionChangeCustomerDialog-BneenKXj.js","assets/Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js","assets/FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js","assets/Form-BSACsGR2.css","assets/useForm-CUKec4n5.js","assets/useTicketChangeCustomer-gjGu9BEY.js","assets/ticketAttributes.api-rqx5ITab.js","assets/useTicketFormOrganizationHandler-DLoRMaF_.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./vite-FJshFMF2.js";import{f as I,m as h,p as q,q as u,r as $,ap as w,X as O,ar as S,t as B,c as N,a1 as V,D as C,y as b,I as P,u as y,E as F}from"./vue-oicRkvo0.js";import{a2 as U,_ as L,bp as j}from"./overviewAttributes.api-C09LSZ8O.js";import{u as H}from"./useTicketSubscribe-CmWzZx1x.js";import{u as K}from"./useTicketView-CMOCBKg-.js";import{_ as Q}from"./CommonButtonGroup.vue_vue_type_script_setup_true_lang-BTHDtl8G.js";import{_ as x}from"./CommonDialog.vue_vue_type_script_setup_true_lang-CID2Z6MI.js";import{l as z,j as E,b as X,a as G,p as M}from"./mobile-Bk4bKGxF.js";import{M as J,N as A,U as W,c as Y}from"./apollo-Cj5TVUDk.js";import{u as Z}from"./merge.api-B2JVH7J2.js";import{A as ee}from"./autocompleteSearchTicket.api-DfOQWGlO.js";import{k as te}from"./lodash-pFOI14f-.js";import"./vendor-C11O1Xx8.js";import"./commonjsHelpers-BosuxZz1.js";import"./routes-CgLO9M4y.js";import"./formkit-5nol1GBe.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";const oe={class:"ltr:pr-3 rtl:pl-3"},ie=I({__name:"TicketMergeStatus",props:{option:{}},setup(c){return(t,n)=>(h(),q("div",oe,[u(z,{"color-code":t.option.ticket.stateColorCode,label:t.option.ticket.state.name},null,8,["color-code","label"])]))}}),ae=(c,t)=>{const n=$(),p=E({name:"tickets-search",prefetch:!0,component:()=>D(()=>import("./FieldAutoCompleteInputDialog-C-a_8s03.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))}),a=new J(Z({})),{notify:l}=Y(),f=w();let d={};const{waitForConfirmation:k}=U(),g=async()=>{var e;const o=(e=n.value)==null?void 0:e.node.context;if(!o||a.loading().value)return!1;const i=o._value,s=d[i];if(!i||!s)return l({id:"merge-ticket-error",type:A.Error,message:__("Please select a ticket to merge into.")}),!1;const m=s.ticket;if(!await k(__("Are you sure you want to merge this ticket (#%s) into #%s?"),{textPlaceholder:[c.value.number,m.number]}))return!1;try{return await a.send({sourceTicketId:c.value.id,targetTicketId:i})?(o.node.input(void 0),f.push(`/tickets/${m.internalId}`),!0):!1}catch(_){_ instanceof W&&l({id:"merge-ticket-error",message:_.generalErrors[0],type:A.Error})}return!1},r=async()=>{await g()&&(p.close(),t==null||t())};return{gqlQuery:ee,autocompleteRef:n,openMergeTicketsDialog:()=>{var i;const o=(i=n.value)==null?void 0:i.node.context;o&&(Object.assign(o,{onActionClick:r}),p.open({context:o,name:"tickets-search",options:[],optionIconComponent:O(ie),noCloseOnSelect:!0,onUpdateOptions(s){d=te(s,"value")},onAction(){r()}}))}}},ne={class:"w-full px-3"},De=I({__name:"TicketActionsDialog",props:{name:{},ticket:{}},setup(c){const t=c,n=S(),p=w(),a=B(t,"ticket"),{isTicketAgent:l,isTicketEditable:f}=K(a),{autocompleteRef:d,gqlQuery:k,openMergeTicketsDialog:g}=ae(a,()=>M(t.name)),{isSubscribed:r,isSubscriptionLoading:v,canManageSubscription:o,toggleSubscribe:i}=H(a),s=N(()=>[{label:__("Merge tickets"),icon:"merge",hidden:!f.value||!l.value,onAction:g},{label:r.value?__("Unsubscribe"):__("Subscribe"),icon:r.value?"notification-unsubscribed":"notification-subscribed",value:"subscribe",hidden:!o.value,selected:r.value,disabled:v.value,onAction:i},{label:__("Ticket info"),icon:"info",onAction(){const e={name:"TicketInformationDetails",params:{internalId:t.ticket.internalId}};M(t.name),n.name!==e.name&&p.push(e)}}].filter(j)),m=E({name:"ticket-change-customer",component:()=>D(()=>import("./TicketActionChangeCustomerDialog-BneenKXj.js"),__vite__mapDeps([19,20,1,2,3,9,4,5,6,7,8,10,21,22,23,24,25,26,11,12,13,14,15,16,17]))}),T=()=>{t.ticket&&m.open({name:m.name,ticket:a})};return(e,_)=>{const R=V("FormKit");return h(),C(x,{name:e.name,label:e.__("Ticket actions")},{default:b(()=>[P("div",ne,[u(Q,{class:"py-6",mode:"full",options:s.value},null,8,["options"]),u(R,{ref_key:"autocompleteRef",ref:d,type:"autocomplete","outer-class":"hidden",label:e.__("Find a ticket"),"gql-query":y(k),"action-label":e.__("Confirm merge"),"additional-query-params":{exceptTicketInternalId:e.ticket.internalId},"label-empty":e.__("Start typing to find the ticket to merge into."),"action-icon":"merge"},null,8,["label","gql-query","action-label","additional-query-params","label-empty"]),y(f)&&y(l)?(h(),C(X,{key:0},{default:b(()=>[u(G,{label:e.__("Change customer"),onClick:T},{icon:b(()=>[u(L,{entity:e.ticket.customer,size:"small"},null,8,["entity"])]),_:1},8,["label"])]),_:1})):F("",!0)])]),_:1},8,["name","label"])}}});export{De as default};
//# sourceMappingURL=TicketActionsDialog-N0IjNELq.js.map
