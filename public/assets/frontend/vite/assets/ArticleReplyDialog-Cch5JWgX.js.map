{"version":3,"file":"ArticleReplyDialog-Cch5JWgX.js","sources":["../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleReplyDialog.vue"],"sourcesContent":["<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { cloneDeep, isEqual } from 'lodash-es'\nimport { computed, onMounted, onUnmounted } from 'vue'\n\nimport type { FormRef } from '#shared/components/Form/types.ts'\nimport { useConfirmation } from '#shared/composables/useConfirmation.ts'\nimport type { TicketById } from '#shared/entities/ticket/types.ts'\n\nimport CommonButton from '#mobile/components/CommonButton/CommonButton.vue'\nimport CommonDialog from '#mobile/components/CommonDialog/CommonDialog.vue'\nimport { closeDialog } from '#mobile/composables/useDialog.ts'\n\nimport type { FormKitNode } from '@formkit/core'\nimport type { ShallowRef } from 'vue'\n\ninterface Props {\n  name: string\n  ticket: TicketById\n  articleFormGroupNode?: FormKitNode\n  newTicketArticlePresent: boolean\n  needSpaceForSaveBanner: boolean\n  form: ShallowRef<FormRef | undefined>\n}\n\nconst props = defineProps<Props>()\n\nconst emit = defineEmits<{\n  'show-article-form': []\n  'hide-article-form': []\n  discard: []\n  done: []\n}>()\n\nconst label = computed(() =>\n  props.newTicketArticlePresent ? __('Edit reply') : __('Add reply'),\n)\n\nconst articleFormGroupNodeContext = computed(\n  () => props.articleFormGroupNode?.context,\n)\n\nconst rememberArticleFormData = cloneDeep({\n  ...articleFormGroupNodeContext.value?._value,\n  __init: true,\n})\n\nconst dialogFormIsDirty = computed(() => {\n  if (!props.newTicketArticlePresent)\n    return !!articleFormGroupNodeContext.value?.state.dirty\n\n  return !isEqual(\n    rememberArticleFormData,\n    articleFormGroupNodeContext.value?._value,\n  )\n})\n\nconst { waitForConfirmation } = useConfirmation()\n\nconst cancelDialog = async () => {\n  if (dialogFormIsDirty.value) {\n    const confirmed = await waitForConfirmation(\n      __('Are you sure? You have changes that will get lost.'),\n      {\n        buttonLabel: __('Discard changes'),\n        buttonVariant: 'danger',\n      },\n    )\n\n    if (!confirmed) return\n  }\n\n  // Set article form data back to the remembered state.\n  // For the first time we need to do nothing, because the article\n  // group will be removed again from the form.\n  if (props.newTicketArticlePresent) {\n    props.articleFormGroupNode?.input(rememberArticleFormData)\n  }\n\n  closeDialog(props.name)\n}\n\nconst discardDialog = async () => {\n  const confirmed = await waitForConfirmation(\n    __('Are you sure? The prepared article will be removed.'),\n    {\n      buttonLabel: __('Discard article'),\n      buttonVariant: 'danger',\n    },\n  )\n\n  if (!confirmed) return\n\n  // Reset only the article group.\n  props.articleFormGroupNode?.reset()\n\n  emit('discard')\n  closeDialog(props.name)\n}\n\nonMounted(() => {\n  emit('show-article-form')\n})\n\nonUnmounted(() => {\n  emit('hide-article-form')\n})\n\nconst close = () => {\n  emit('done')\n  closeDialog(props.name)\n}\n</script>\n\n<template>\n  <CommonDialog class=\"w-full\" :name=\"name\" :label=\"label\">\n    <template #before-label>\n      <CommonButton transparent-background @click=\"cancelDialog\">\n        {{ $t('Cancel') }}\n      </CommonButton>\n    </template>\n    <template #after-label>\n      <CommonButton\n        variant=\"primary\"\n        :disabled=\"!dialogFormIsDirty\"\n        transparent-background\n        @pointerdown.stop\n        @click=\"close()\"\n        @keypress.space.prevent=\"close()\"\n      >\n        {{ $t('Done') }}\n      </CommonButton>\n    </template>\n    <div class=\"w-full p-4\">\n      <div data-ticket-article-reply-form />\n      <FormKit\n        v-if=\"newTicketArticlePresent\"\n        variant=\"danger\"\n        wrapper-class=\"mt-4 flex grow justify-center items-center\"\n        input-class=\"py-2 px-4 w-full h-14 rounded-xl select-none\"\n        name=\"discardArticle\"\n        type=\"button\"\n        @click=\"discardDialog\"\n      >\n        {{ $t('Discard your unsaved changes') }}\n      </FormKit>\n      <div\n        class=\"transition-all\"\n        :class=\"{ 'pb-16': needSpaceForSaveBanner }\"\n      ></div>\n    </div>\n  </CommonDialog>\n</template>\n"],"names":["props","__props","emit","__emit","label","computed","articleFormGroupNodeContext","_a","rememberArticleFormData","cloneDeep","dialogFormIsDirty","isEqual","_b","waitForConfirmation","useConfirmation","cancelDialog","closeDialog","discardDialog","onMounted","onUnmounted","close"],"mappings":"s8BA0BA,MAAMA,EAAQC,EAERC,EAAOC,EAOPC,EAAQC,EAAS,IACrBL,EAAM,wBAA0B,GAAG,YAAY,EAAI,GAAG,WAAW,CAAA,EAG7DM,EAA8BD,EAClC,IAAM,OAAA,OAAAE,EAAAP,EAAM,uBAAN,YAAAO,EAA4B,QAAA,EAG9BC,EAA0BC,EAAU,CACxC,IAAGF,EAAAD,EAA4B,QAA5B,YAAAC,EAAmC,OACtC,OAAQ,EAAA,CACT,EAEKG,EAAoBL,EAAS,IAAM,SACvC,OAAKL,EAAM,wBAGJ,CAACW,EACNH,GACAI,EAAAN,EAA4B,QAA5B,YAAAM,EAAmC,MAAA,EAJ5B,CAAC,GAACL,EAAAD,EAA4B,QAA5B,MAAAC,EAAmC,MAAM,MAKpD,CACD,EAEK,CAAE,oBAAAM,GAAwBC,IAE1BC,EAAe,SAAY,OAC3BL,EAAkB,OAShB,CARc,MAAMG,EACtB,GAAG,oDAAoD,EACvD,CACE,YAAa,GAAG,iBAAiB,EACjC,cAAe,QACjB,CAAA,IASAb,EAAM,2BACFO,EAAAP,EAAA,uBAAA,MAAAO,EAAsB,MAAMC,IAGpCQ,EAAYhB,EAAM,IAAI,EAAA,EAGlBiB,EAAgB,SAAY,OACd,MAAMJ,EACtB,GAAG,qDAAqD,EACxD,CACE,YAAa,GAAG,iBAAiB,EACjC,cAAe,QACjB,CAAA,KAMFN,EAAAP,EAAM,uBAAN,MAAAO,EAA4B,QAE5BL,EAAK,SAAS,EACdc,EAAYhB,EAAM,IAAI,EAAA,EAGxBkB,EAAU,IAAM,CACdhB,EAAK,mBAAmB,CAAA,CACzB,EAEDiB,EAAY,IAAM,CAChBjB,EAAK,mBAAmB,CAAA,CACzB,EAED,MAAMkB,EAAQ,IAAM,CAClBlB,EAAK,MAAM,EACXc,EAAYhB,EAAM,IAAI,CAAA"}