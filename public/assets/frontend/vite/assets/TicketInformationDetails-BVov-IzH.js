import{bo as st,X as it,at as ot,_ as nt,a2 as lt}from"./overviewAttributes.api-C09LSZ8O.js";import{_ as rt}from"./ObjectAttributes.vue_vue_type_script_setup_true_lang-B0DrxGTz.js";import{u as ut}from"./useTicketSubscribe-CmWzZx1x.js";import{u as ct}from"./useTicketView-CMOCBKg-.js";import{q as mt,a as dt}from"./routes-CgLO9M4y.js";import{_ as pt}from"./CommonLoader.vue_vue_type_script_setup_true_lang-BtrvaoyW.js";import{c as E,b as w}from"./mobile-Bk4bKGxF.js";import{_ as P}from"./CommonShowMoreButton.vue_vue_type_script_setup_true_lang-0Icksle5.js";import{_ as ft}from"./CommonUsersList.vue_vue_type_script_setup_true_lang-CKM-Z0cj.js";import{u as gt,E as D}from"./useEscalationState-Dv4jDro1.js";import{f as M,t as U,u as t,m as i,D as l,y as u,Q as h,M as f,H as W,E as r,r as z,c as S,I as A,p as F,x as bt,J as V,q as p,w as G,a1 as Q,k as _t,l as kt,n as vt}from"./vue-oicRkvo0.js";import{u as yt}from"./useTicketAccountedTime-CSL2Xls9.js";import{e as Tt,M as ht,N as At,c as $t}from"./apollo-Cj5TVUDk.js";import{_ as wt}from"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import{n as Et}from"./vendor-C11O1Xx8.js";import{b as Ut}from"./lodash-pFOI14f-.js";import{u as St}from"./useTicketInformation-DhcXzEKN.js";import"./formkit-5nol1GBe.js";import"./vite-FJshFMF2.js";import"./useDisplayObjectAttributes-sspS-pHp.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./commonjsHelpers-BosuxZz1.js";const I=M({__name:"TicketEscalationTimeMenuItem",props:{label:{},escalationAt:{}},setup(g){const c=g,a=gt(U(()=>c.escalationAt));return(s,e)=>s.escalationAt&&t(a)!==t(D).None?(i(),l(E,{key:0,class:W({"text-red-bright bg-red-highlight":t(a)===t(D).Escalated,"text-yellow bg-yellow-highlight":t(a)===t(D).Warning}),label:s.label},{default:u(()=>[h(f(s.i18n.relativeDateTime(s.escalationAt)),1)]),_:1},8,["class","label"])):r("",!0)}}),Mt={class:"grid grid-cols-[1fr_auto_auto] py-2",role:"list"},Nt={class:"col-[1] truncate text-white/80 ltr:mr-2 rtl:ml-2"},jt=3,Ct=M({__name:"TicketObjectAttributes",props:{ticket:{}},setup(g){const c=g,a=U(c,"ticket"),{timeAccountingDisplayUnit:s,timeAccountingConfig:e}=yt(),k=U(()=>!!a.value.timeUnit),_=z(!1),o=S(()=>e.value.time_accounting_types?c.ticket.timeUnitsPerType&&c.ticket.timeUnitsPerType.length===1&&c.ticket.timeUnitsPerType[0].name==="None"?[]:c.ticket.timeUnitsPerType||[]:[]),m=S(()=>_.value?o.value:o.value.slice(0,jt));return(b,v)=>k.value?(i(),l(w,{key:0},{default:u(()=>[a.value.timeUnit?(i(),l(E,{key:0,label:b.__("Total Accounted Time")},{default:u(()=>[h(f(a.value.timeUnit)+" "+f(b.$t(t(s))),1)]),_:1},8,["label"])):r("",!0),o.value.length?(i(),l(E,{key:1},{default:u(()=>[A("div",Mt,[(i(!0),F(V,null,bt(m.value,({name:y,timeUnit:N},T)=>(i(),F(V,{key:T},[A("div",Nt,f(t(st)(b.$t(y))),1),A("div",null,f(N)+" "+f(b.$t(t(s))),1)],64))),128))])]),_:1})):r("",!0),p(P,{entities:m.value,"total-count":o.value.length,onClick:v[0]||(v[0]=y=>_.value=!0)},null,8,["entities","total-count"])]),_:1})):r("",!0)}}),Dt=Et`
    mutation tagAssignmentUpdate($objectId: ID!, $tags: [String!]!) {
  tagAssignmentUpdate(objectId: $objectId, tags: $tags) {
    success
    errors {
      ...errors
    }
  }
}
    ${it}`;function It(g={}){return Tt(Dt,g)}const Ft=M({__name:"TicketTags",props:{ticket:{}},setup(g){const a=U(g,"ticket"),s=z(a.value.tags||[]);G(()=>a.value.tags,()=>{s.value=a.value.tags||[]});const e=new ht(It({}),{errorNotificationMessage:__("Ticket tags could not be updated.")}),{notify:k}=$t(),_=o=>{o.on("dialog:afterClose",async()=>{const m=a.value.id;await o.settled,!(!m||Ut(s.value,a.value.tags))&&e.send({objectId:m,tags:s.value}).then(()=>{k({id:"ticket-tags-updated",type:At.Success,message:__("Ticket tags updated successfully.")})}).catch(()=>{s.value=a.value.tags||[]})})};return(o,m)=>{const b=Q("FormKit");return i(),l(wt,null,{default:u(()=>[p(b,{modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=v=>s.value=v),type:"tags",name:"tags",label:o.__("Tags"),plugins:[_],"can-create":!!o.$c.tag_new},null,8,["modelValue","label","plugins","can-create"])]),_:1})}}}),Vt=["for"],re=M({__name:"TicketInformationDetails",setup(g){const{attributes:c}=ot(mt.Ticket),{form:a,initialFormTicketValue:s,ticket:e,updateFormLocation:k,ticketQuery:_}=St(),o=S(()=>{var n,d;return(d=(n=a.value)==null?void 0:n.formNode)==null?void 0:d.at("ticket")}),{waitForConfirmation:m}=lt(),b=async()=>{var d;!o.value||!await m(__("Are you sure? You have unsaved changes that will get lost."),{buttonLabel:__("Discard changes"),buttonVariant:"danger"})||(d=a.value)==null||d.resetForm({values:s.value,object:e.value},{resetDirty:!0,groupNode:o.value})};_t(()=>{k("[data-ticket-edit-form]")}),kt(()=>{k("body")});const{canManageSubscription:v,isSubscribed:y,isSubscriptionLoading:N,subscribersWithoutMe:T,subscribersAccessLookup:J,totalSubscribersWithoutMe:X,toggleSubscribe:Y}=ut(e),x={true:__("yes"),false:__("no")};let j=!1;G(()=>y.value,()=>{j=!0,vt(()=>{j=!1})});const Z=async()=>j?!1:Y(),B=dt(),tt=_.loading(),et=()=>{_.refetch({mentionsCount:null})},{isTicketAgent:O,isTicketEditable:L}=ct(e),at=S(()=>{if(!e.value)return!1;const{closeEscalationAt:n,updateEscalationAt:d,firstResponseEscalationAt:$}=e.value;return!!(n||d||$)});return(n,d)=>{var R,q,H,K;const $=Q("FormKit");return i(),F(V,null,[p(pt,{loading:!t(e)},null,8,["loading"]),d[0]||(d[0]=A("div",{"data-ticket-edit-form":""},null,-1)),(q=(R=o.value)==null?void 0:R.context)!=null&&q.state.dirty?(i(),l($,{key:0,"wrapper-class":"mt-4 mb-4 flex grow justify-center items-center","input-class":"py-2 px-4 w-full h-14 text-base text-red-bright! formkit-variant-primary:bg-red-dark rounded-xl select-none",type:"button",name:"discardTicketInformation",onClick:b},{default:u(()=>[h(f(n.$t("Discard your unsaved changes")),1)]),_:1})):r("",!0),!t(L)&&t(e)?(i(),l(rt,{key:1,object:t(e),attributes:t(c),"skip-attributes":["title","customer_id","organization_id"]},null,8,["object","attributes"])):r("",!0),t(O)&&t(e)?(i(),l(Ct,{key:2,ticket:t(e)},null,8,["ticket"])):r("",!0),t(e)&&at.value?(i(),l(w,{key:3,"header-label":n.__("Escalation Times")},{default:u(()=>[p(I,{"escalation-at":t(e).firstResponseEscalationAt,label:n.__("First Response Time")},null,8,["escalation-at","label"]),p(I,{"escalation-at":t(e).updateEscalationAt,label:n.__("Update Time")},null,8,["escalation-at","label"]),p(I,{"escalation-at":t(e).closeEscalationAt,label:n.__("Solution Time")},null,8,["escalation-at","label"])]),_:1},8,["header-label"])):r("",!0),t(O)&&t(L)&&t(e)?(i(),l(Ft,{key:4,ticket:t(e)},null,8,["ticket"])):(K=(H=t(e))==null?void 0:H.tags)!=null&&K.length?(i(),l(w,{key:5},{default:u(()=>[p(E,{label:n.__("Tags")},{default:u(()=>[h(f(t(e).tags.join(", ")),1)]),_:1},8,["label"])]),_:1})):r("",!0),t(v)?(i(),l(w,{key:6,class:"py-1","header-label":n.__("Subscribers")},{default:u(()=>[p($,{type:"toggle",modelValue:t(y),label:n.__("Get notified"),variants:x,disabled:t(N),"outer-class":{"px-3!":!0,"border-b border-white/10":t(T).length},"wrapper-class":"px-0!",onInputRaw:Z},{label:u(C=>[A("label",{for:C.id,class:W(C.classes.label)},[t(B).user?(i(),l(nt,{key:0,class:"ltr:mr-3 rtl:ml-3",entity:t(B).user},null,8,["entity"])):r("",!0),h(" "+f(C.label),1)],10,Vt)]),_:1},8,["modelValue","label","disabled","outer-class"]),p(ft,{users:t(T),"access-lookup":t(J)},null,8,["users","access-lookup"]),p(P,{entities:t(T),"total-count":t(X),disabled:t(tt),onClick:et},null,8,["entities","total-count","disabled"])]),_:1},8,["header-label"])):r("",!0)],64)}}});export{re as default};
//# sourceMappingURL=TicketInformationDetails-BVov-IzH.js.map
