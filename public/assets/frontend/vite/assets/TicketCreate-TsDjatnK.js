const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TicketDuplicateDetectionDialog-9AZNGfMe.js","assets/CommonDialog.vue_vue_type_script_setup_true_lang-CID2Z6MI.js","assets/vue-oicRkvo0.js","assets/vendor-C11O1Xx8.js","assets/commonjsHelpers-BosuxZz1.js","assets/overviewAttributes.api-C09LSZ8O.js","assets/routes-CgLO9M4y.js","assets/vite-FJshFMF2.js","assets/apollo-Cj5TVUDk.js","assets/lodash-pFOI14f-.js","assets/formkit-5nol1GBe.js","assets/overviewAttributes-r_4zXopK.css","assets/mobile-Bk4bKGxF.js","assets/pwa-THoW_3xc.js","assets/add.api-CxwFhgGn.js","assets/datepicker-BBNcWeHz.js","assets/date-B2UyDZN7.js","assets/mobile-Crnk7LCD.css"])))=>i.map(i=>d[i]);
import{_ as le}from"./vite-FJshFMF2.js";import{f as ce,ap as ue,r as x,c as T,d as U,w as me,av as z,aN as pe,a1 as de,m as fe,p as _e,q as _,y as w,K as B,u as r,I as M,b as ye,H as ge,J as be,Q as P,M as G,n as he}from"./vue-oicRkvo0.js";import{_ as ke}from"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import{u as ve}from"./useForm-CUKec4n5.js";import{u as Ce}from"./useMultiStepForm-CbTGEQR9.js";import{az as $,Y as Se,as as xe,a2 as Te}from"./overviewAttributes.api-C09LSZ8O.js";import{u as we}from"./useStickyHeader-XWZvtRy7.js";import{u as $e}from"./useTicketSignature-LslYi6X7.js";import{u as Fe}from"./useTicketCreate-DQOD5AnJ.js";import{u as Ne}from"./useTicketCreateArticleType-D7iVcJ_6.js";import{u as Ae}from"./useTicketCreateView-HCH46SPv.js";import{u as De}from"./useTicketFormOrganizationHandler-DLoRMaF_.js";import{u as Ee}from"./user.api-BwewaCks.js";import{e as je,q as m,i as R,r as Le}from"./routes-CgLO9M4y.js";import{E as Ie}from"./apollo-Cj5TVUDk.js";import{j as He,_ as Oe}from"./mobile-Bk4bKGxF.js";import{_ as Ve}from"./CommonStepper.vue_vue_type_script_setup_true_lang-vksyK0-9.js";import{_ as Ue}from"./LayoutHeader.vue_vue_type_script_setup_true_lang-BeSNC-UK.js";import"./vendor-C11O1Xx8.js";import"./commonjsHelpers-BosuxZz1.js";import"./formkit-5nol1GBe.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./lodash-pFOI14f-.js";import"./utils-C-eON4SW.js";import"./dom-0wVl69Vp.js";import"./useObjectAttributeFormData-BTXeBYyl.js";import"./ticketAttributes.api-rqx5ITab.js";import"./types-Cu-Nkl7K.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./CommonBackButton.vue_vue_type_script_setup_true_lang-DhwyOyd1.js";const ze=y=>{const p=(i,d,l)=>!(!d.fields.ticket_duplicate_detection||i===$.FieldChange&&(!l||l.name!=="ticket_duplicate_detection")),n=async(i,d,l)=>{const{changedField:c}=l,{schemaData:h}=d;if(!p(i,h,c))return;const s=c==null?void 0:c.newValue;s!=null&&s.count&&y(s)};return{execution:[$.Initial,$.FieldChange],callback:n}},Be={beforeRouteEnter(y,p,n){const{ticketCreateEnabled:i}=Ae();if(!i.value){xe.value={title:__("Forbidden"),message:__("Creating new tickets via web is disabled."),statusCode:Ie.Forbidden,route:y.fullPath},n({name:"Error",query:{redirect:"1"},replace:!0});return}n()}},St=ce({...Be,__name:"TicketCreate",setup(y){const p=ue(),{canSubmit:n,form:i,node:d,isDirty:l,formSubmit:c}=ve(),{multiStepPlugin:h,setMultiStep:s,allSteps:k,activeStep:o,visitedSteps:F,stepNames:q,lastStepName:f}=Ce(d),v=je(),N=()=>{s()},{ticketArticleSenderTypeField:K}=Ne({onSubmit:N,buttons:!0}),Q=e=>{e?p.replace(`/tickets/${e}`):p.replace({name:"Home"})},{createTicket:Y,isTicketCustomer:J}=Fe(i,Q),g=(e,t,u,a=!1)=>({isLayout:!0,element:"section",attrs:{style:{if:`$activeStep !== "${e}"`,then:"display: none;"},class:{"flex flex-col h-full min-h-[calc(100vh_-_15rem)]":!0,"items-center":a}},children:[{type:"group",name:e,isGroupOrList:!0,plugins:[h],children:[{isLayout:!0,element:"h4",attrs:{class:"my-10 text-base text-center"},children:R.t(t)},...u]}]}),A=g("ticketTitle",__("Set a title for your ticket"),[{name:"title",required:!0,object:m.Ticket,screen:"create_top",outerClass:"$reset formkit-outer w-full grow justify-center flex items-center flex-col",wrapperClass:"$reset formkit-disabled:opacity-30 flex w-full",labelClass:"$reset sr-only",blockClass:"$reset flex w-full",innerClass:"$reset flex justify-center items-center px-8 w-full",messagesClass:"pt-2",inputClass:"$reset formkit-input block bg-transparent grow border-b-[0.5px] border-white outline-hidden text-center text-xl placeholder:text-white placeholder:text-opacity-50",props:{placeholder:__("Title"),onSubmit:N}}],!0),W=g("ticketArticleType",__("Select the type of ticket your are creating"),[{...K,outerClass:"w-full flex grow items-center",fieldsetClass:"grow px-4"},{if:"$existingAdditionalCreateNotes() && $getAdditionalCreateNote($values.articleSenderType) !== undefined",isLayout:!0,element:"p",attrs:{class:"my-10 text-base text-center text-yellow"},children:"$getAdditionalCreateNote($values.articleSenderType)"}],!0),b=new URL(window.location.href).searchParams.get("customer_id")||void 0,C=x([]);Ee(()=>({userInternalId:Number(b),secondaryOrganizationsCount:3}),{fetchPolicy:"cache-first",enabled:!!b}).onResult(e=>{var u,a;if(e.loading)return;const t=(u=e.data)==null?void 0:u.user;if(!t){C.value=[];return}C.value=[{value:t.internalId,label:t.fullname||t.phone,heading:(a=t.organization)==null?void 0:a.name,user:t}]});const D=g("ticketMetaInformation",__("Additional information"),[{isLayout:!0,component:"FormGroup",children:[{name:"ticket_duplicate_detection",type:"hidden",value:{count:0,items:[]}},{screen:"create_top",object:m.Ticket,name:"customer_id",value:b?Number(b):void 0,props:{options:C}},{screen:"create_top",object:m.Ticket},{if:'$values.articleSenderType === "email-out"',name:"cc",label:__("CC"),type:"recipient",props:{multiple:!0}}]},{isLayout:!0,component:"FormGroup",children:[{screen:"create_middle",object:m.Ticket}]},{isLayout:!0,component:"FormGroup",children:[{screen:"create_bottom",object:m.Ticket}]}]),E=g("ticketArticleMessage",__("Add a message"),[{isLayout:!0,component:"FormGroup",children:[{if:'$securityIntegration === true && $values.articleSenderType === "email-out"',name:"security",label:__("Security"),type:"security"},{name:"body",screen:"create_top",object:m.TicketArticle,props:{meta:{mentionText:{customerNodeName:"customer_id",groupNodeName:"group_id"},mentionUser:{groupNodeName:"group_id"},mentionKnowledgeBase:{attachmentsNodeName:"attachments"}}},triggerFormUpdater:!1}]},{isLayout:!0,component:"FormGroup",children:[{type:"file",name:"attachments",label:__("Attachment"),labelSrOnly:!0,props:{multiple:!0}}]}]),X=[A,D,E],Z=[A,W,D,E],ee=Se(J.value?X:Z),te=T(()=>(v.config.smime_integration||v.config.pgp_integration)??!1),j=T(()=>v.config.ui_ticket_create_notes||{}),re=U({activeStep:o,visitedSteps:F,allSteps:k,securityIntegration:te,existingAdditionalCreateNotes:()=>Object.keys(j).length>0,getAdditionalCreateNote:e=>R.t(j.value[e])}),L=T(()=>!n.value||o.value!==f.value&&F.value.length<q.value.length),oe=()=>{if(o.value===f.value){c();return}s()},{stickyStyles:I,headerElement:H}=we(),O=x(),V=x(!0),S=()=>{var e,t;V.value=window.innerHeight+document.documentElement.scrollTop-(((e=H.value)==null?void 0:e.clientHeight)||0)>=(((t=O.value)==null?void 0:t.scrollHeight)||0)};me(()=>o.value,()=>{he(()=>{S()})}),z("scroll",S),z("resize",S),pe(async()=>{if(!l.value)return!0;const{waitForConfirmation:e}=Te();return await e(__("Are you sure? You have unsaved changes that will get lost."),{buttonLabel:__("Discard changes"),buttonVariant:"danger"})});const{signatureHandling:ae}=$e(),ie=He({name:"duplicate-ticket-detection",component:()=>le(()=>import("./TicketDuplicateDetectionDialog-9AZNGfMe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))}),se=e=>{ie.open({name:"duplicate-ticket-detection",tickets:e.items})},ne=U({body:{required:!0}});return(e,t)=>{const u=de("FormKit");return fe(),_e(be,null,[_(Ue,{ref_key:"headerElement",ref:H,class:"h-16!",style:B(r(I).header),"back-url":"/",title:e.__("Create Ticket")},{after:w(()=>[_(Oe,{variant:"submit",form:"ticket-create",type:"submit",disabled:L.value,"transparent-background":""},{default:w(()=>[P(G(e.$t("Create")),1)]),_:1},8,["disabled"])]),_:1},8,["style","title"]),M("div",{ref_key:"bodyElement",ref:O,style:B(r(I).body),class:"flex h-full flex-col px-4"},[_(ke,{id:"ticket-create",ref_key:"form",ref:i,class:"pb-32 text-left",schema:r(ee),handlers:[r(De)(),r(ae)("body"),r(ze)(se)],"flatten-form-groups":Object.keys(r(k)),"schema-data":re,"change-fields":ne,"form-updater-id":r(Le).FormUpdaterUpdaterTicketCreate,"should-autofocus":"","use-object-attributes":"",onSubmit:t[0]||(t[0]=a=>r(Y)(a))},null,8,["schema","handlers","flatten-form-groups","schema-data","change-fields","form-updater-id"])],4),M("footer",{class:ge([{"bg-gray-light backdrop-blur-lg":!V.value},"pb-safe fixed bottom-0 z-10 w-full px-4 transition"])},[_(u,{variant:r(f)===r(o)?"submit":"primary",type:"button","outer-class":"mt-4 mb-2",disabled:r(f)===r(o)&&L.value,"wrapper-class":"flex grow justify-center items-center","input-class":"py-2 px-4 w-full h-14 text-lg rounded-xl select-none",onClick:t[1]||(t[1]=a=>oe())},{default:w(()=>[P(G(r(f)===r(o)?e.$t("Create ticket"):e.$t("Continue")),1)]),_:1},8,["variant","disabled"]),_(Ve,{modelValue:r(o),"onUpdate:modelValue":t[2]||(t[2]=a=>ye(o)?o.value=a:null),steps:r(k),class:"mt-4 mb-8 px-8"},null,8,["modelValue","steps"])],2)],64)}}});export{St as default};
//# sourceMappingURL=TicketCreate-TsDjatnK.js.map
