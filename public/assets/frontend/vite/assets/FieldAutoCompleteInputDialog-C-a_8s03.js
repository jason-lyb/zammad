import{f as U,a1 as L,m as o,D as b,H as u,E as v,t as _,r as w,k as ae,n as oe,c as A,ag as ne,ah as se,ap as ie,v as re,y as h,q as I,Q as M,M as d,W as F,p as i,I as O,J as ce,x as ue,u as s}from"./vue-oicRkvo0.js";import{Q as pe,d as de}from"./apollo-Cj5TVUDk.js";import{n as me}from"./vendor-C11O1Xx8.js";import{c as fe,d as T,a as ve}from"./overviewAttributes.api-C09LSZ8O.js";import{_ as H,p as ye}from"./mobile-Bk4bKGxF.js";import{_ as xe}from"./CommonDialog.vue_vue_type_script_setup_true_lang-CID2Z6MI.js";import{a as j}from"./lodash-pFOI14f-.js";import"./commonjsHelpers-BosuxZz1.js";import"./routes-CgLO9M4y.js";import"./vite-FJshFMF2.js";import"./formkit-5nol1GBe.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";const he=U({__name:"FieldAutoCompleteOptionIcon",props:{option:{}},setup(z){return(y,l)=>{const g=L("CommonIcon");return y.option.icon?(o(),b(g,{key:0,name:y.option.icon,class:u([{"opacity-30":y.option.disabled},"ltr:mr-4 rtl:ml-4"])},null,8,["name","class"])):v("",!0)}}}),be=["aria-label"],ge={class:"w-full p-4"},ke=["aria-label","aria-multiselectable"],Ce=["aria-posinset","aria-selected","onClick","onKeyup"],we={key:2,class:"flex grow flex-col overflow-hidden"},Ie={key:1,class:"relative flex h-[58px] items-center justify-center self-stretch px-4 py-5 text-base leading-[19px] text-white/50",role:"alert"},Fe={key:2,class:"relative flex h-[58px] items-center justify-center self-stretch px-4 py-5 text-base leading-[19px] text-white/50",role:"alert"},Ee=U({__name:"FieldAutoCompleteInputDialog",props:{context:{},name:{},options:{},optionIconComponent:{},noCloseOnSelect:{type:Boolean}},emits:["update-options","action"],setup(z,{emit:y}){const l=z,g=_(l,"context"),{isCurrentValue:r}=fe(g),$=y,{sortedOptions:k,selectOption:J,appendedOptions:Q}=T(_(l,"options"),g);let B=!1;const c=w(j(l.options)),m=w(""),K=w(null),W=()=>{var n;const e=K.value;if(!e)return;const a=document.getElementById((n=e.node.context)==null?void 0:n.id);a&&a.focus()},G=()=>{m.value=""};ae(()=>{B&&(c.value=[...l.options]),oe(()=>W())});const f=()=>{l.context.multiple&&($("update-options",[...c.value]),c.value=[],B=!0),ye(l.name),G()},C=A(()=>m.value.trim()),x=ne(C,l.context.debounceInterval??500),N=me`
  ${l.context.gqlQuery}
`,X=()=>typeof l.context.additionalQueryParams=="function"?l.context.additionalQueryParams():l.context.additionalQueryParams||{},V=new pe(de(N,()=>({input:{query:x.value||l.context.defaultFilter||"",limit:l.context.limit,...X()||{}}}),()=>({enabled:!!(x.value||l.context.defaultFilter),cachePolicy:"no-cache"})));l.context.defaultFilter?V.load():se(()=>x.value,e=>{e.length&&V.load()});const Y=N.definitions[0].selectionSet.selections[0].name.value,P=A(()=>{var e;return(e=V.result().value)==null?void 0:e[Y]}),S=A(()=>{var n;const e=j(P.value)||[],a=K.value;return l.context.allowUnknownValues&&a&&((n=a.node.context)!=null&&n.state.complete)&&!e.some(p=>p.value===C.value)&&e.unshift({value:C.value,label:C.value}),e}),{sortedOptions:Z}=T(S,_(l,"context")),R=e=>{if(J(e),l.context.multiple){r(e.value)&&!c.value.some(a=>a.value===e.value)&&c.value.push(e),c.value=c.value.filter(a=>r(a.value)),k.value.some(a=>a.value===e.value)||Q.value.push(e),Q.value=Q.value.filter(a=>r(a.value)),c.value.sort((a,n)=>k.value.findIndex(p=>p.value===a.value)-k.value.findIndex(p=>p.value===n.value));return}$("update-options",[e]),l.noCloseOnSelect||f()},ee=l.optionIconComponent??he,te=ie(),E=()=>{$("action"),l.context.action&&te.push(l.context.action)},q=w();return ve(q),(e,a)=>{const n=L("CommonIcon"),p=L("FormKit");return o(),b(xe,{name:e.name,label:e.context.label,class:"field-autocomplete-dialog",onClose:f},re({"after-label":h(()=>[e.context.action||e.context.onActionClick?(o(),i("button",{key:0,tabindex:"0","aria-label":e.context.actionLabel,onClick:E,onKeypress:F(E,["space"])},[I(n,{name:e.context.actionIcon?e.context.actionIcon:"external-link",class:"cursor-pointer text-white",size:"base"},null,8,["name"])],40,be)):(o(),b(H,{key:1,class:"grow",variant:"primary","transparent-background":"",onClick:a[0]||(a[0]=t=>f()),onKeypress:a[1]||(a[1]=F(t=>f(),["space"]))},{default:h(()=>[M(d(e.$t("Done")),1)]),_:1}))]),default:h(()=>[O("div",ge,[I(p,{ref_key:"filterInput",ref:K,modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=t=>m.value=t),delay:e.context.node.props.delay,placeholder:e.context.filterInputPlaceholder,validation:e.context.filterInputValidation,type:"search","validation-visibility":"live",role:"searchbox"},null,8,["modelValue","delay","placeholder","validation"])]),(m.value?S.value.length:e.options.length)?(o(),i("div",{key:0,ref_key:"autocompleteList",ref:q,"aria-label":e.$t("Select…"),class:"flex grow flex-col items-start self-stretch overflow-y-auto",role:"listbox","aria-multiselectable":e.context.multiple},[(o(!0),i(ce,null,ue(m.value||e.context.defaultFilter?s(Z):s(k),(t,le)=>(o(),i("div",{key:String(t.value),class:u([{"pointer-events-none":t.disabled},"focus:bg-blue-highlight relative flex h-[58px] cursor-pointer items-center self-stretch px-6 py-5 text-base leading-[19px] text-white focus:outline-hidden"]),"aria-setsize":"-1","aria-posinset":e.options.findIndex(D=>D.value===t.value)+1,tabindex:"0","aria-selected":s(r)(t.value),role:"option",onClick:D=>R(t),onKeyup:F(D=>R(t),["space"])},[le!==0?(o(),i("div",{key:0,class:u([{"ltr:left-4 rtl:right-4":!e.context.multiple&&!t.icon,"ltr:left-[60px] rtl:right-[60px]":e.context.multiple&&!t.icon,"ltr:left-[72px] rtl:right-[72px]":!e.context.multiple&&t.icon,"ltr:left-[108px] rtl:right-[108px]":e.context.multiple&&t.icon},"absolute top-0 h-0 border-t border-white/10 ltr:right-4 rtl:left-4"])},null,2)):v("",!0),e.context.multiple?(o(),b(n,{key:1,class:u([{"!text-white":s(r)(t.value),"opacity-30":t.disabled},"text-white/50 ltr:mr-3 rtl:ml-3"]),name:s(r)(t.value)?"check-box-yes":"check-box-no",size:"base",decorative:""},null,8,["class","name"])):v("",!0),I(s(ee),{option:t},null,8,["option"]),t.heading?(o(),i("div",we,[O("span",{class:u([{"opacity-30":t.disabled},"flex-1 truncate text-sm text-gray-100"])},[O("span",null,d(t.heading),1)],2),O("span",{class:u([{"opacity-30":t.disabled},"grow truncate text-lg leading-[22px] font-semibold"])},d(t.label||t.value),3)])):(o(),i("span",{key:3,class:u([{"font-semibold !text-white":s(r)(t.value),"opacity-30":t.disabled},"grow truncate text-white/80"])},d(t.label||t.value),3)),!e.context.multiple&&s(r)(t.value)?(o(),b(n,{key:4,class:u({"opacity-30":t.disabled}),size:"tiny",name:"check",decorative:""},null,8,["class"])):v("",!0)],42,Ce))),128))],8,ke)):v("",!0),s(x)&&P.value&&!S.value.length?(o(),i("div",Ie,d(e.$t(e.context.dialogNotFoundMessage||e.__("No results found"))),1)):!s(x)&&!e.options.length?(o(),i("div",Fe,d(e.$t(e.context.dialogEmptyMessage||e.__("Start typing to search…"))),1)):v("",!0)]),_:2},[e.context.action||e.context.onActionClick?{name:"before-label",fn:h(()=>[I(H,{class:"grow","transparent-background":"",onClick:f,onKeypress:F(f,["space"])},{default:h(()=>[M(d(e.$t("Cancel")),1)]),_:1})]),key:"0"}:void 0]),1032,["name","label"])}}});export{Ee as default};
//# sourceMappingURL=FieldAutoCompleteInputDialog-C-a_8s03.js.map
