import{f as T,c as n,r as F,aO as V,w as h,Y as j,ap as q,a1 as k,m as s,p as v,D as c,y as S,Q as y,M as g,E as u,J,x as G,I as N,q as C,H as z}from"./vue-oicRkvo0.js";import{e as P,i as H}from"./routes-CgLO9M4y.js";import{u as M,Q as O}from"./apollo-Cj5TVUDk.js";import{C as U}from"./CommonProgressBar-B-HvRpIP.js";import{_ as Y}from"./GuidedSetupActionFooter.vue_vue_type_script_setup_true_lang-Cze7-cY3.js";import{a as K}from"./index-IyuspdAl.js";import{_ as W}from"./GuidedSetupStatusMessage.vue_vue_type_script_setup_true_lang-CK-LgkYz.js";import{u as X}from"./useSystemSetup-CBS5N4Hd.js";import{n as Z}from"./vendor-C11O1Xx8.js";import"./vite-FJshFMF2.js";import"./lodash-pFOI14f-.js";import"./overviewAttributes.api-C09LSZ8O.js";import"./formkit-5nol1GBe.js";import"./useForm-CUKec4n5.js";import"./desktop-l0eJ1dZN.js";import"./Form.vue_vue_type_script_setup_true_lang-B6L-6HzY.js";import"./FormGroup.vue_vue_type_script_setup_true_lang-DIx-HUKU.js";import"./useCopyToClipboard-CjkPg__g.js";import"./theme-Bv2ClBzZ.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";import"./autocompleteTags.api-CG5-cm_A.js";import"./autocompleteSearchTicket.api-DfOQWGlO.js";import"./ticketUpdates.api-BhGIG_Ti.js";import"./ticketAttributes.api-rqx5ITab.js";import"./useTicketCreateArticleType-D7iVcJ_6.js";import"./types-Cu-Nkl7K.js";import"./useTicketCreateView-HCH46SPv.js";import"./commonjsHelpers-BosuxZz1.js";import"./LayoutPublicPageBoxActions-BFjF_v1c.js";import"./useImportSource-DpIhNL7i.js";import"./useSSLVerificationWarningHandler-CuWTKKwG.js";import"./openExternalLink-B2ZtqYBi.js";import"./CommonButtonGroup.vue_vue_type_script_setup_true_lang-C3MnS4Ly.js";const tt=Z`
    query systemImportState {
  systemImportState {
    name
    result
    startedAt
    finishedAt
  }
}
    `;function et(i={}){return M(tt,{},i)}const ot={key:2,class:"mb-5 flex flex-col gap-3"},rt={class:"mb-1 flex grow flex-col gap-1"},st={class:"flex justify-between gap-2"},Tt=T({beforeRouteEnter(i,b){const _=P();if(b.name==="GuidedSetupImportSourceStart")return!0;if(!_.config.import_mode)return{path:`/guided-setup/import/${i.params.source}`,replace:!0}},__name:"GuidedSetupImportSourceStatus",props:{source:{}},setup(i){const b=i,{setTitle:_}=X(),x=K[b.source];_(H.t("%s Import Status",x.label));const I=new O(et({pollInterval:5e3})),d=I.result(),l=n(()=>{var t,o;return!!((o=(t=d.value)==null?void 0:t.systemImportState)!=null&&o.startedAt)}),E=n(()=>{var t,o;return!!((o=(t=d.value)==null?void 0:t.systemImportState)!=null&&o.finishedAt)}),p=n(()=>{var o,a;const t=(a=(o=d.value)==null?void 0:o.systemImportState)==null?void 0:a.result;if(!(!t||!t.error))return t.error}),B=n(()=>{var a,m;if(!l.value)return[];const t=(m=(a=d.value)==null?void 0:a.systemImportState)==null?void 0:m.result;if(!t)return[];const o=[];return Object.entries(x.importEntities).forEach(([e,r])=>{o.push({entity:e,entityLabel:r,processed:t[e]&&t[e].sum?String(t[e].sum):void 0,total:t[e]&&t[e].total?String(t[e].total):void 0,isFinished:!1})}),o.forEach(e=>{e.processed&&e.total&&Number(e.processed)>Number(e.total)&&(e.processed=e.total),e.processed!==void 0&&e.total!==void 0&&e.processed===e.total&&(e.isFinished=!0)}),o}),$=F(!1),L=n(()=>!!($.value||p.value)),f=V(()=>{$.value=!0,I.stop()},9e4,{immediate:!1});h(l,t=>{t===!0&&f.stop()}),h(p,t=>{t?f.start():f.stop()}),h(E,t=>{t===!0&&I.stop()});const w=F(!1),A=P();j(()=>{A.config.system_init_done&&A.config.import_mode===!1&&(w.value=!0)}),l.value||f.start();const Q=n(()=>w.value&&E.value&&!p.value),D=q(),R=()=>{D.push("/login")};return(t,o)=>{const a=k("CommonAlert"),m=k("CommonLabel"),e=k("CommonIcon");return s(),v(J,null,[L.value?(s(),c(a,{key:0,variant:"danger"},{default:S(()=>[y(g(t.$t(p.value?p.value:"Background process did not start or has not finished! Please contact your support.")),1)]),_:1})):u("",!0),!L.value&&(!l.value||B.value.length===0)?(s(),c(W,{key:1,message:t.__("Starting importâ€¦")},null,8,["message"])):u("",!0),l.value?(s(),v("div",ot,[Q.value?(s(),c(a,{key:0,variant:"success"},{default:S(()=>[y(g(t.$t("Import finished successfully!")),1)]),_:1})):u("",!0),(s(!0),v(J,null,G(B.value,r=>(s(),v("div",{key:r.entity,class:"flex items-end gap-2"},[N("div",rt,[N("div",st,[C(m,{id:`progress-${r.entity}`},{default:S(()=>[y(g(t.$t(r.entityLabel)),1)]),_:2},1032,["id"]),r.processed!==void 0&&r.total!==void 0?(s(),c(m,{key:0,class:"text-stone-200 dark:text-neutral-500"},{default:S(()=>[y(g(t.$t("%s of %s",r.processed,r.total)),1)]),_:2},1024)):u("",!0)]),C(U,{"aria-labelledby":`progress-${r.entity}`,value:r.processed,max:r.total},null,8,["aria-labelledby","value","max"])]),C(e,{class:z(["shrink-0 fill-green-500",r.isFinished?void 0:"invisible"]),name:"check2",size:"tiny",decorative:""},null,8,["class"])]))),128))])):u("",!0),Q.value?(s(),c(Y,{key:3,"submit-button-variant":"primary","submit-button-type":"button","submit-button-text":t.__("Go to Login"),onSubmit:R},null,8,["submit-button-text"])):u("",!0)],64)}}});export{Tt as default};
//# sourceMappingURL=GuidedSetupImportSourceStatus-CD60cO8G.js.map
