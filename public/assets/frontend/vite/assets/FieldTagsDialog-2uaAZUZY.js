import{f as B,t as O,c,r as u,b5 as Q,a1 as D,m,D as q,y as C,I as b,q as g,v as A,p as h,H as T,E as F,x as H,W as M,L as U,M as W,J as j}from"./vue-oicRkvo0.js";import{c as J,a as P,bj as R,s as k}from"./overviewAttributes.api-C09LSZ8O.js";import{Q as G,N as X,c as Y}from"./apollo-Cj5TVUDk.js";import{u as Z}from"./autocompleteTags.api-CG5-cm_A.js";import{_ as ee}from"./CommonDialog.vue_vue_type_script_setup_true_lang-CID2Z6MI.js";import"./vendor-C11O1Xx8.js";import"./commonjsHelpers-BosuxZz1.js";import"./routes-CgLO9M4y.js";import"./vite-FJshFMF2.js";import"./lodash-pFOI14f-.js";import"./formkit-5nol1GBe.js";import"./mobile-Bk4bKGxF.js";import"./pwa-THoW_3xc.js";import"./add.api-CxwFhgGn.js";import"./datepicker-BBNcWeHz.js";import"./date-B2UyDZN7.js";const te={class:"w-full border-b border-white/10 p-4"},ae=["aria-label","disabled"],se=["aria-label"],oe=["id","aria-posinset","aria-selected","onClick","onKeydown"],le={class:"flex-1 py-3 text-left"},_e=B({__name:"FieldTagsDialog",props:{name:{},context:{}},setup(V){const l=V,{localValue:S}=J(O(l,"context")),r=c(()=>S.value||[]),d=e=>r.value.includes(e),s=u(""),p=u([]),$=new G(Z(()=>({input:{query:s.value}}),{debounce:300})),E=c(()=>{var t;return((t=$.result().value)==null?void 0:t.autocompleteSearchTag)||[]}),y=u(),x=u(),n=c(()=>{const{sorting:e="label"}=l.context,t=[...E.value,...p.value].sort((o,a)=>{const v=(o[e]||"").toString(),K=(a[e]||"").toString();return v.localeCompare(K)}).map(o=>o.label);return Array.from(new Set(t))}),i=e=>n.value.some(t=>t===e),{ignoreUpdates:w}=Q(r,e=>{e.forEach(t=>{i(t)||p.value.push({value:t,label:t})})},{immediate:!0}),I=c(()=>s.value?n.value.filter(e=>e.toLowerCase().includes(s.value.toLowerCase())):n.value),L=e=>{const t=r.value.filter(o=>o!==e);w(()=>{l.context.node.input(t)})},f=e=>{const t=[...r.value];if(t.includes(e)){L(e);return}t.push(e),w(()=>{l.context.node.input(t)})},{notify:N}=Y(),_=()=>{var t;const e=s.value;if(e){if(i(e)){N({id:"tag-exists",type:X.Warn,message:__('Tag "%s" already exists.'),messagePlaceholder:[e]});return}f(e),p.value.push({value:e,label:e}),s.value="",(t=y.value)==null||t.focus()}};P(x,{direction:"vertical"});const z=e=>{const{key:t}=e;t===","&&k(e),s.value&&["Enter","Tab",","].includes(t)&&(k(e),l.context.canCreate&&_())};return(e,t)=>{const o=D("CommonIcon");return m(),q(ee,{label:e.__("Tags"),name:e.name},{default:C(()=>[b("div",te,[g(R,{ref_key:"filterInput",ref:y,modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value=a),placeholder:"Tag name…",onKeydown:z},A({_:2},[e.context.canCreate?{name:"controls",fn:C(()=>[s.value.length>0?(m(),h("button",{key:0,"aria-label":e.$t("Create tag"),class:T(["bg-green rounded-3xl text-white",{"bg-green/40 text-white/20":i(s.value)}]),type:"button",disabled:i(s.value),onClick:t[0]||(t[0]=a=>_())},[g(o,{class:"p-1",size:"tiny",name:"add",decorative:""})],10,ae)):F("",!0)]),key:"0"}:void 0]),1032,["modelValue"])]),b("div",{ref_key:"tagsListbox",ref:x,class:"flex w-full flex-col","aria-label":e.$t("Select…"),role:"listbox","aria-multiselectable":"true"},[(m(!0),h(j,null,H(I.value,a=>(m(),h("button",{id:`${e.name}-${a}`,key:a,class:"focus:bg-blue-highlight flex w-full items-center px-4 focus:outline-hidden",role:"option","aria-setsize":"-1","aria-posinset":n.value.indexOf(a)+1,"aria-selected":d(a),onClick:v=>f(a),onKeydown:M(U(v=>f(a),["prevent"]),["space"])},[g(o,{class:T([{"!text-white":d(a)},"text-white/50 ltr:mr-3 rtl:ml-3"]),name:d(a)?"check-box-yes":"check-box-no",size:"base",decorative:""},null,8,["class","name"]),b("span",le,W(a),1)],40,oe))),128))],8,se)]),_:1},8,["label","name"])}}});export{_e as default};
//# sourceMappingURL=FieldTagsDialog-2uaAZUZY.js.map
