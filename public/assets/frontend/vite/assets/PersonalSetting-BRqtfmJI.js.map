{"version":3,"file":"PersonalSetting-BRqtfmJI.js","sources":["../../../../../app/frontend/apps/desktop/components/NavigationMenu/NavigationMenuFilter.vue","../../../../../app/frontend/apps/desktop/components/NavigationMenu/NavigationMenu.vue"],"sourcesContent":["<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { useActiveElement, useMagicKeys, onClickOutside } from '@vueuse/core'\nimport { nextTick, ref, watchEffect, useTemplateRef } from 'vue'\n\nimport CommonIcon from '#shared/components/CommonIcon/CommonIcon.vue'\nimport { useTransitionConfig } from '#shared/composables/useTransitionConfig.ts'\nimport { i18n } from '#shared/i18n.ts'\n\nimport CommonButton from '#desktop/components/CommonButton/CommonButton.vue'\n\nconst filterFieldOpen = ref(false)\nconst containerElement = useTemplateRef('container')\nconst searchText = defineModel<string>({ required: true, default: '' })\nconst searchTextElement = useTemplateRef('search-text')\n\nonClickOutside(containerElement, () => {\n  if (searchText.value !== '') return\n\n  filterFieldOpen.value = false\n})\n\nconst activeElement = useActiveElement()\nconst { escape } = useMagicKeys()\n\nconst openFilterField = () => {\n  filterFieldOpen.value = true\n\n  nextTick(() => searchTextElement.value?.focus())\n}\n\nconst closeFilterField = () => {\n  filterFieldOpen.value = false\n  searchText.value = ''\n}\n\nwatchEffect(() => {\n  if (!escape.value) return\n  if (activeElement.value !== searchTextElement.value) return\n\n  closeFilterField()\n})\n\nconst { durations } = useTransitionConfig()\n</script>\n\n<template>\n  <div\n    ref=\"container\"\n    class=\"mb-2 flex h-10 shrink-0 items-center gap-2 rounded-lg transition-colors\"\n    :class=\"{\n      'bg-blue-200 px-2 has-[input:focus]:outline has-[input:focus]:outline-1 has-[input:focus]:outline-offset-1 has-[input:focus]:outline-blue-800 has-[input:hover]:outline has-[input:hover]:outline-1 has-[input:hover]:outline-offset-1 has-[input:hover]:outline-blue-600 has-[input:hover]:has-[input:focus]:outline-blue-800 dark:bg-gray-700 dark:has-[input:hover]:outline-blue-900 dark:has-[input:hover]:has-[input:focus]:outline-blue-800':\n        filterFieldOpen,\n    }\"\n  >\n    <CommonIcon\n      v-if=\"filterFieldOpen\"\n      class=\"fill-stone-200 dark:fill-neutral-500\"\n      size=\"small\"\n      name=\"filter\"\n      decorative\n    />\n    <CommonButton\n      v-else\n      class=\"ltr:ml-auto rtl:mr-auto\"\n      prefix-icon=\"filter\"\n      @click=\"openFilterField\"\n    >\n      {{ $t('apply filter') }}\n    </CommonButton>\n\n    <input\n      ref=\"search-text\"\n      v-model.trim=\"searchText\"\n      :placeholder=\"$t('Apply filterâ€¦')\"\n      :aria-label=\"$t('Navigation filter')\"\n      class=\"w-0 bg-transparent text-sm text-black transition-[width] duration-200 focus:outline-hidden dark:text-white\"\n      :class=\"{ 'w-full': filterFieldOpen }\"\n      type=\"text\"\n      role=\"searchbox\"\n    />\n    <Transition name=\"fade-move\" :duration=\"durations.normal\">\n      <CommonButton\n        v-if=\"filterFieldOpen\"\n        icon=\"x-lg\"\n        variant=\"neutral\"\n        class=\"hover:text-black hover:outline-hidden hover:outline-transparent hover:dark:text-white\"\n        :aria-label=\"i18n.t('Clear filter')\"\n        @click=\"closeFilterField\"\n      />\n    </Transition>\n  </div>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { transform, deburr } from 'lodash-es'\nimport { computed, ref } from 'vue'\n\nimport { i18n } from '#shared/i18n.ts'\nimport { useSessionStore } from '#shared/stores/session.ts'\n\nimport CommonSectionCollapse from '#desktop/components/CommonSectionCollapse/CommonSectionCollapse.vue'\nimport NavigationMenuFilter from '#desktop/components/NavigationMenu/NavigationMenuFilter.vue'\nimport NavigationMenuList from '#desktop/components/NavigationMenu/NavigationMenuList.vue'\n\nimport type { NavigationMenuCategory, NavigationMenuEntry } from './types'\n\ninterface Props {\n  categories: NavigationMenuCategory[]\n  entries: Record<string, NavigationMenuEntry[]>\n  hasNoFiltering?: boolean\n}\n\nconst props = defineProps<Props>()\n\nconst session = useSessionStore()\n\nconst permittedEntries = computed(() => {\n  return transform(\n    props.entries,\n    (memo, entries, category) => {\n      memo[category] = entries.filter((entry) => {\n        if (\n          typeof entry.route === 'object' &&\n          entry.route.meta?.requiredPermission &&\n          !session.hasPermission(entry.route.meta.requiredPermission)\n        )\n          return false\n\n        if (typeof entry.show === 'function') return entry.show()\n\n        return true\n      })\n    },\n    {} as Record<string, NavigationMenuEntry[]>,\n  )\n})\n\nconst searchText = ref('')\n\nconst normalizeString = (input: string) => deburr(input).toLocaleLowerCase()\n\nconst searchTextMatcher = computed(() => {\n  if (!searchText.value) return ''\n\n  return normalizeString(searchText.value)\n})\n\nconst isMatchingFilterLabel = (entry: NavigationMenuEntry) => {\n  return normalizeString(i18n.t(entry.label)).includes(searchTextMatcher.value)\n}\n\nconst isMatchingFilterKeywords = (entry: NavigationMenuEntry) => {\n  if (!entry.keywords) return false\n\n  return i18n\n    .t(entry.keywords)\n    .split(',')\n    .some((elem) => normalizeString(elem).includes(searchTextMatcher.value))\n}\n\nconst isMatchingFilter = (entry: NavigationMenuEntry) => {\n  return isMatchingFilterLabel(entry) || isMatchingFilterKeywords(entry)\n}\n\nconst allFilteredEntries = computed<NavigationMenuEntry[]>(() => {\n  return Object.values(permittedEntries.value)\n    .flat()\n    .filter((entry) => isMatchingFilter(entry))\n})\n</script>\n\n<template>\n  <NavigationMenuFilter v-model.trim=\"searchText\" />\n  <NavigationMenuList\n    v-if=\"searchText && allFilteredEntries.length > 0\"\n    :items=\"allFilteredEntries\"\n  />\n  <CommonLabel\n    v-else-if=\"allFilteredEntries.length == 0\"\n    class=\"px-2 py-1 text-stone-200 dark:text-neutral-500\"\n    >{{ __('No results found') }}\n  </CommonLabel>\n  <ul v-else>\n    <li\n      v-for=\"category in categories\"\n      :key=\"category.label\"\n      class=\"bg-neutral-00 relative z-0 mb-1\"\n    >\n      <CommonSectionCollapse\n        v-if=\"permittedEntries[category.label].length > 0\"\n        :id=\"category.id\"\n        :title=\"category.label\"\n        size=\"large\"\n        no-negative-margin\n      >\n        <template #default=\"{ headerId }\">\n          <NavigationMenuList\n            :aria-labelledby=\"headerId\"\n            :items=\"permittedEntries[category.label]\"\n          />\n        </template>\n      </CommonSectionCollapse>\n    </li>\n  </ul>\n</template>\n"],"names":["filterFieldOpen","ref","containerElement","useTemplateRef","searchText","_useModel","__props","searchTextElement","onClickOutside","activeElement","useActiveElement","escape","useMagicKeys","openFilterField","nextTick","_a","closeFilterField","watchEffect","durations","useTransitionConfig","props","session","useSessionStore","permittedEntries","computed","transform","memo","entries","category","entry","normalizeString","input","deburr","searchTextMatcher","isMatchingFilterLabel","i18n","isMatchingFilterKeywords","elem","isMatchingFilter","allFilteredEntries"],"mappings":"snDAYM,MAAAA,EAAkBC,EAAI,EAAK,EAC3BC,EAAmBC,EAAe,WAAW,EAC7CC,EAAaC,EAAmDC,EAAA,YAAA,EAChEC,EAAoBJ,EAAe,aAAa,EAEtDK,EAAeN,EAAkB,IAAM,CACjCE,EAAW,QAAU,KAEzBJ,EAAgB,MAAQ,GAAA,CACzB,EAED,MAAMS,EAAgBC,IAChB,CAAE,OAAAC,GAAWC,IAEbC,EAAkB,IAAM,CAC5Bb,EAAgB,MAAQ,GAExBc,EAAS,IAAA,OAAM,OAAAC,EAAAR,EAAkB,QAAlB,YAAAQ,EAAyB,QAAO,CAAA,EAG3CC,EAAmB,IAAM,CAC7BhB,EAAgB,MAAQ,GACxBI,EAAW,MAAQ,EAAA,EAGrBa,EAAY,IAAM,CACXN,EAAO,OACRF,EAAc,QAAUF,EAAkB,OAE7BS,GAAA,CAClB,EAEK,KAAA,CAAE,UAAAE,GAAcC,2lDCvBtB,MAAMC,EAAQd,EAERe,EAAUC,IAEVC,EAAmBC,EAAS,IACzBC,GACLL,EAAM,QACN,CAACM,EAAMC,EAASC,IAAa,CAC3BF,EAAKE,CAAQ,EAAID,EAAQ,OAAQE,GAAU,OACzC,OACE,OAAOA,EAAM,OAAU,YACvBd,EAAAc,EAAM,MAAM,OAAZ,MAAAd,EAAkB,qBAClB,CAACM,EAAQ,cAAcQ,EAAM,MAAM,KAAK,kBAAkB,EAEnD,GAEL,OAAOA,EAAM,MAAS,WAAmBA,EAAM,OAE5C,EAAA,CACR,CACH,EACA,CAAC,CAAA,CAEJ,EAEKzB,EAAaH,EAAI,EAAE,EAEnB6B,EAAmBC,GAAkBC,GAAOD,CAAK,EAAE,oBAEnDE,EAAoBT,EAAS,IAC5BpB,EAAW,MAET0B,EAAgB1B,EAAW,KAAK,EAFT,EAG/B,EAEK8B,EAAyBL,GACtBC,EAAgBK,EAAK,EAAEN,EAAM,KAAK,CAAC,EAAE,SAASI,EAAkB,KAAK,EAGxEG,EAA4BP,GAC3BA,EAAM,SAEJM,EACJ,EAAEN,EAAM,QAAQ,EAChB,MAAM,GAAG,EACT,KAAMQ,GAASP,EAAgBO,CAAI,EAAE,SAASJ,EAAkB,KAAK,CAAC,EAL7C,GAQxBK,EAAoBT,GACjBK,EAAsBL,CAAK,GAAKO,EAAyBP,CAAK,EAGjEU,EAAqBf,EAAgC,IAClD,OAAO,OAAOD,EAAiB,KAAK,EACxC,OACA,OAAQM,GAAUS,EAAiBT,CAAK,CAAC,CAC7C"}