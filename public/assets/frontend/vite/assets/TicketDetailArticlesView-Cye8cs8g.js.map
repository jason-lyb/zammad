{"version":3,"mappings":"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","names":["useTicketArticleContext","articleForContext","shallowRef","ticketForContext","selectionData","ref","metadataDialog","useDialog","__vitePreload","showArticleReplyDialog","form","useTicketInformation","openReplyForm","getNewArticleBody","useTicketArticleReplyAction","triggerId","recalculate","disposeCallbacks","onDispose","callback","contextOptions","computed","ticket","article","createArticleActions","action","perform","link","label","_a","articleContextShown","value","getArticleSelection","err","log","useTicketArticleRows","articles","totalCount","newArticlesIds","session","useSessionStore","controlledComputed","rows","dates","needMoreButton","hasNew","index","date","i18n","_b","EnumTicketArticleSenderName","_c","_d","_g","_f","_e","next","useArticleSeen","element","emit","observer","useIntersectionObserver","isIntersecting","props","__props","showPopup","popupItems","securityIcon","signingSuccess","hasError","signingMessage","encryptionMessage","encryptionSuccess","canView","retryMutation","MutationHandler","useTicketArticleRetrySecurityProcessMutation","notify","useNotifications","tryAgain","result","security","NotificationTypes","hidePopup","loading","useTicketArticleRetryMediaDownload","toRef","__emit","colorClasses","internal","position","bubbleClasses","username","user","body","textToHtml","colorsClasses","shownMore","bubbleElement","hasShowMore","toggleShowMore","useArticleToggleMore","articleInternalId","getIdFromGraphQLId","articleAttachments","useAttachments","inlineImages","showImage","useImageViewer","previewImage","event","attachment","stopEvent","setupLinksHandlers","useHtmlLinks","populateInlineImages","useHtmlInlineImages","watch","nextTick","onMounted","onContextClick","articleElement","_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","showArticleContext","articlesElement","filterAttachments","file","remoteContentWarning","originalFormattingUrl","attachmentInternalId","markSeen","id","viewersDialog","actionsDialog","showViewers","showActions","escalationState","useEscalationState","ticketReactive","isTicketAgent","isTicketEditable","useTicketView","hasChannelAlert","channelAlert","useTicketChannel","locale","useLocaleStore","customer","fullname","ticketArticlesLoaded","useTicketArticlesQueryVariables","application","useApplicationStore","ticketArticlesMin","ticketId","convertToGraphQLId","liveUserList","ticketQuery","scrolledToBottom","scrollDownState","scrollElement","scheduleMyArticleScroll","originalTime","r","isAtTheBottom","scrollHeight","scrolledHeight","hasScroll","onAddArticleCallback","updates","previousArticlesEdges","previousArticlesEdgesCount","articlesQuery","allArticleLoaded","refetchArticlesQuery","needRefetch","markTicketArticlesLoaded","getTicketArticlesQueryVariables","articleResult","useArticleDataHandler","loadPreviousArticles","isLoadingTicket","isRefetchingTicket","toMs","nodes","edgesToArray","description","a","b","useHeader","number","title","route","useRoute","ignoreQuery","initialScroll","articleNode","node","internalId","lastArticle","waitForElement","stopScrollWatch","stickyStyles","headerElement","useStickyHeader","useEventListener"],"ignoreList":[],"sources":["../../../../../app/frontend/apps/mobile/pages/ticket/composable/useTicketArticleContext.ts","../../../../../app/frontend/apps/mobile/pages/ticket/composable/useTicketArticlesRows.ts","../../../../../app/frontend/apps/mobile/pages/ticket/composable/useArticleSeen.ts","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleRemoteContentBadge.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleSecurityBadge.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleWhatsappMediaBadge.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleBubble.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleDeliveryMessage.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleSeparatorNew.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticleSystem.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/ArticlesList.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/TicketDetailViewHeader.vue","../../../../../app/frontend/apps/mobile/components/CommonTicketEscalationIndicator/CommonTicketEscalationIndicator.vue","../../../../../app/frontend/apps/mobile/pages/ticket/components/TicketDetailView/TicketDetailViewTitle.vue","../../../../../app/frontend/apps/mobile/pages/ticket/composable/useTicketArticlesVariables.ts","../../../../../app/frontend/apps/mobile/pages/ticket/views/TicketDetailArticlesView.vue"],"sourcesContent":["// Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/\n\nimport { computed, ref, shallowRef } from 'vue'\n\nimport { useTicketArticleReplyAction } from '#shared/entities/ticket/composables/useTicketArticleReplyAction.ts'\nimport type {\n  TicketArticle,\n  TicketById,\n} from '#shared/entities/ticket/types.ts'\nimport { createArticleActions } from '#shared/entities/ticket-article/action/plugins/index.ts'\nimport { getArticleSelection } from '#shared/entities/ticket-article/composables/getArticleSelection.ts'\nimport log from '#shared/utils/log.ts'\nimport type { SelectionData } from '#shared/utils/selection.ts'\n\nimport type { PopupItemDescriptor } from '#mobile/components/CommonSectionPopup/types.ts'\nimport { useDialog } from '#mobile/composables/useDialog.ts'\n\nimport { useTicketInformation } from './useTicketInformation.ts'\n\nexport const useTicketArticleContext = () => {\n  const articleForContext = shallowRef<TicketArticle>()\n  const ticketForContext = shallowRef<TicketById>()\n  const selectionData = ref<SelectionData>()\n  const metadataDialog = useDialog({\n    name: 'article-metadata',\n    component: () =>\n      import('../components/TicketDetailView/ArticleMetadataDialog.vue'),\n  })\n\n  const { showArticleReplyDialog, form } = useTicketInformation()\n\n  const { openReplyForm, getNewArticleBody } = useTicketArticleReplyAction(\n    form,\n    showArticleReplyDialog,\n  )\n\n  const triggerId = ref(0)\n\n  const recalculate = () => {\n    triggerId.value += 1\n  }\n\n  const disposeCallbacks: (() => unknown)[] = []\n  const onDispose = (callback: () => unknown) => {\n    disposeCallbacks.push(callback)\n  }\n\n  const contextOptions = computed<PopupItemDescriptor[]>(() => {\n    const ticket = ticketForContext.value\n    const article = articleForContext.value\n\n    // trigger ID cannot be less than 0, so it's just a hint for vue to recalculate computed\n    if (!article || !ticket || triggerId.value < 0) return []\n\n    // clear all side effects before recalculating\n    disposeCallbacks.forEach((callback) => callback())\n    disposeCallbacks.length = 0\n\n    const actions = createArticleActions(ticket, article, 'mobile', {\n      recalculate,\n      onDispose,\n    }).map<PopupItemDescriptor>((action) => {\n      const { perform, link, label } = action\n      if (!perform) return { ...action, type: 'link' }\n      return {\n        type: link ? 'link' : 'button',\n        label,\n        link,\n        onAction: () =>\n          perform(ticket, article, {\n            formId: form.value?.formId || '',\n            selection: selectionData.value,\n            openReplyForm,\n            getNewArticleBody,\n          }),\n      }\n    })\n\n    return [\n      ...actions,\n      {\n        type: 'button',\n        label: __('Show meta data'),\n        onAction() {\n          metadataDialog.open({\n            name: metadataDialog.name,\n            article,\n            ticketInternalId: ticket.internalId,\n          })\n        },\n      },\n    ]\n  })\n\n  const articleContextShown = computed({\n    get: () => articleForContext.value != null,\n    set: (value) => {\n      // we don't care for \"true\", because to make it truthy we\n      // call showArticleContext\n      // setting it to \"false\" is done via \"update:modelValue\"\n      if (!value) {\n        articleForContext.value = undefined\n        disposeCallbacks.forEach((callback) => callback())\n        disposeCallbacks.length = 0\n      }\n    },\n  })\n\n  const showArticleContext = (article: TicketArticle, ticket: TicketById) => {\n    metadataDialog.prefetch()\n    articleForContext.value = article\n    ticketForContext.value = ticket\n    try {\n      // can throw RangeError\n      selectionData.value = getArticleSelection(article.internalId)\n    } catch (err) {\n      log.error('[Article Quote] Failed to parse article selection', err)\n      selectionData.value = undefined\n    }\n  }\n\n  return {\n    contextOptions,\n    articleContextShown,\n    showArticleContext,\n  }\n}\n","// Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/\n\nimport { controlledComputed } from '@vueuse/shared'\n\nimport type { TicketArticle } from '#shared/entities/ticket/types.ts'\nimport { EnumTicketArticleSenderName } from '#shared/graphql/types.ts'\nimport { i18n } from '#shared/i18n.ts'\nimport { useSessionStore } from '#shared/stores/session.ts'\n\nimport { useTicketInformation } from './useTicketInformation.ts'\n\nimport type { Ref } from 'vue'\n\ninterface ArticleRow {\n  type: 'article-bubble'\n  article: TicketArticle\n}\n\ninterface ArticleDeliveryRow {\n  type: 'delivery'\n  content: string\n}\n\ninterface MoreRow {\n  type: 'more'\n  count: number\n}\n\ninterface NewRow {\n  type: 'new'\n}\n\ninterface DateRow {\n  type: 'date'\n  date: string\n}\n\ninterface SystemRaw {\n  type: 'system'\n  subject?: Maybe<string>\n  to?: Maybe<string>\n  reaction?: Maybe<string>\n}\n\ntype TicketArticleRow = (\n  | ArticleRow\n  | SystemRaw\n  | MoreRow\n  | NewRow\n  | DateRow\n  | ArticleDeliveryRow\n) & {\n  key: string\n}\n\nexport const useTicketArticleRows = (\n  articles: Ref<TicketArticle[]>,\n  totalCount: Ref<number>,\n) => {\n  const { newArticlesIds } = useTicketInformation()\n  const session = useSessionStore()\n\n  const rows = controlledComputed(articles, () => {\n    const rows: TicketArticleRow[] = []\n    const dates = new Set<string>()\n    const needMoreButton = articles.value.length < totalCount.value\n    let hasNew = false\n    // assuming it is sorted by createdAt\n    articles.value.forEach((article, index) => {\n      const date = i18n.date(article.createdAt)\n      if (!dates.has(date)) {\n        dates.add(date)\n        rows.push({\n          type: 'date',\n          date: article.createdAt,\n          key: date,\n        })\n      }\n      if (article.preferences?.delivery_message) {\n        rows.push({\n          type: 'delivery',\n          content: article.bodyWithUrls,\n          key: article.id,\n        })\n      } else if (\n        article.sender?.name === EnumTicketArticleSenderName.System &&\n        article.type?.name !== 'note'\n      ) {\n        rows.push({\n          type: 'system',\n          subject: article.subject,\n          to: article.to?.raw || '',\n          reaction: article.preferences?.whatsapp?.reaction?.emoji,\n          key: article.id,\n        })\n      } else {\n        rows.push({\n          type: 'article-bubble',\n          article,\n          key: article.id,\n        })\n      }\n      // after \"description\" (always first) article is added, add \"more\" button\n      if (index === 0 && needMoreButton) {\n        rows.push({\n          type: 'more',\n          key: 'more',\n          count: totalCount.value - articles.value.length,\n        })\n      }\n      const next = articles.value[index + 1]\n      if (\n        !hasNew &&\n        next &&\n        session.userId !== next.author.id &&\n        newArticlesIds.has(next.id)\n      ) {\n        hasNew = true\n        rows.push({\n          type: 'new',\n          key: 'new',\n        })\n      }\n    })\n    return rows\n  })\n\n  return { rows }\n}\n","// Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/\n\nimport { useIntersectionObserver } from '@vueuse/core'\n\nimport type { Ref } from 'vue'\n\nexport const useArticleSeen = (\n  element: Ref<HTMLElement | undefined>,\n  emit: (...args: any[]) => void,\n) => {\n  const observer = useIntersectionObserver(\n    element,\n    ([{ isIntersecting }]) => {\n      if (isIntersecting) {\n        emit('seen')\n        observer.stop()\n      }\n    },\n    { threshold: 0.4 },\n  )\n}\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport CommonSectionPopup from '#mobile/components/CommonSectionPopup/CommonSectionPopup.vue'\n\nexport interface Props {\n  originalFormattingUrl?: string\n}\n\nconst props = defineProps<Props>()\n\nconst showPopup = ref(false)\n\nconst popupItems = computed(() =>\n  props.originalFormattingUrl\n    ? [\n        {\n          type: 'link' as const,\n          label: __('Original Formatting'),\n          link: props.originalFormattingUrl,\n          attributes: {\n            'rest-api': true,\n            target: '_blank',\n          },\n        },\n      ]\n    : [],\n)\n</script>\n\n<template>\n  <button\n    v-bind=\"$attrs\"\n    type=\"button\"\n    class=\"inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1 text-xs font-bold\"\n    @click.prevent=\"showPopup = !showPopup\"\n    @keydown.space.prevent=\"showPopup = !showPopup\"\n  >\n    <CommonIcon name=\"warning\" decorative size=\"xs\" />\n    {{ $t('Blocked Content') }}\n  </button>\n  <CommonSectionPopup v-model:state=\"showPopup\" :messages=\"popupItems\">\n    <template #header>\n      <div\n        class=\"flex flex-col items-center gap-2 border-b border-b-white/10 p-4\"\n      >\n        <div class=\"flex w-full items-center justify-center gap-1\">\n          <CommonIcon name=\"warning\" size=\"tiny\" />\n          {{ $t('Blocked Content') }}\n        </div>\n        <div>\n          {{\n            $t(\n              'This message contains images or other content hosted by an external source. It was blocked, but you can download the original formatting here.',\n            )\n          }}\n        </div>\n      </div>\n    </template>\n  </CommonSectionPopup>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport {\n  NotificationTypes,\n  useNotifications,\n} from '#shared/components/CommonNotifications/index.ts'\nimport { useTicketArticleRetrySecurityProcessMutation } from '#shared/entities/ticket-article/graphql/mutations/ticketArticleRetrySecurityProcess.api.ts'\nimport type { TicketArticleSecurityState } from '#shared/graphql/types.ts'\nimport { i18n } from '#shared/i18n.ts'\nimport { MutationHandler } from '#shared/server/apollo/handler/index.ts'\n\nimport CommonSectionPopup from '#mobile/components/CommonSectionPopup/CommonSectionPopup.vue'\n\nexport interface Props {\n  articleId: string\n  security: TicketArticleSecurityState\n  successClass?: string\n}\n\nconst props = defineProps<Props>()\n\nconst securityIcon = computed(() => {\n  const { signingSuccess } = props.security\n  if (signingSuccess === false) return 'not-signed'\n  return 'unlock'\n})\n\nconst hasError = computed(() => {\n  const {\n    signingMessage,\n    signingSuccess,\n    encryptionMessage,\n    encryptionSuccess,\n  } = props.security\n  if (signingSuccess === false && signingMessage) return true\n  if (encryptionSuccess === false && encryptionMessage) return true\n  return false\n})\n\nconst canView = computed(() => {\n  const { signingSuccess, encryptionSuccess } = props.security\n  return signingSuccess === true || encryptionSuccess === true\n})\n\nconst showPopup = ref(false)\n\nconst retryMutation = new MutationHandler(\n  useTicketArticleRetrySecurityProcessMutation(() => ({\n    variables: {\n      articleId: props.articleId,\n    },\n  })),\n)\n\nconst { notify } = useNotifications()\n\nconst tryAgain = async () => {\n  const result = await retryMutation.send()\n  const security = result?.ticketArticleRetrySecurityProcess?.retryResult\n  if (!security) {\n    notify({\n      id: 'retry-security-error',\n      type: NotificationTypes.Error,\n      message: __('The retried security process failed!'),\n      timeout: 2000,\n    })\n    return\n  }\n  if (security.type !== props.security.type) {\n    // shouldn't be possible, we only support S/MIME\n    notify({\n      id: 'security-mechanism-error',\n      type: NotificationTypes.Error,\n      message: __('Article uses different security mechanism.'),\n      timeout: 2000,\n    })\n    showPopup.value = false\n    return\n  }\n\n  let hidePopup = true\n\n  if (security.signingSuccess) {\n    notify({\n      id: 'signature-verified',\n      type: NotificationTypes.Success,\n      message: __('The signature was successfully verified.'),\n    })\n  } else if (security.signingMessage) {\n    notify({\n      id: 'signature-verification-failed',\n      type: NotificationTypes.Error,\n      message: __('Signature verification failed! %s'),\n      messagePlaceholder: [i18n.t(security.signingMessage)],\n      timeout: 2000,\n    })\n    hidePopup = false\n  }\n\n  if (security.encryptionSuccess) {\n    notify({\n      id: 'decryption-success',\n      type: NotificationTypes.Success,\n      message: __('Decryption was successful.'),\n    })\n  } else if (security.encryptionMessage) {\n    notify({\n      id: 'decryption-failed',\n      type: NotificationTypes.Error,\n      message: __('Decryption failed! %s'),\n      messagePlaceholder: [i18n.t(security.encryptionMessage)],\n      timeout: 2000,\n    })\n    hidePopup = false\n  }\n\n  if (hidePopup) {\n    showPopup.value = false\n  }\n}\n\nconst popupItems = computed(() =>\n  hasError.value\n    ? [\n        {\n          type: 'button' as const,\n          label: __('Try again'),\n          onAction: tryAgain,\n          noHideOnSelect: true,\n        },\n      ]\n    : [],\n)\n</script>\n\n<template>\n  <button\n    v-if=\"hasError\"\n    v-bind=\"$attrs\"\n    type=\"button\"\n    class=\"bg-yellow inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1 text-xs font-bold text-black\"\n    @click.prevent=\"showPopup = !showPopup\"\n    @keydown.space.prevent=\"showPopup = !showPopup\"\n  >\n    <CommonIcon :name=\"securityIcon\" decorative size=\"xs\" />\n    {{ $t('Security Error') }}\n  </button>\n  <button\n    v-else-if=\"canView\"\n    v-bind=\"$attrs\"\n    :class=\"successClass\"\n    class=\"inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1\"\n    type=\"button\"\n    data-test-id=\"securityBadge\"\n    @click.prevent=\"showPopup = !showPopup\"\n    @keydown.space.prevent=\"showPopup = !showPopup\"\n  >\n    <CommonIcon\n      v-if=\"security.encryptionSuccess\"\n      name=\"lock\"\n      size=\"tiny\"\n      :label=\"$t('Encrypted')\"\n    />\n    <CommonIcon\n      v-if=\"security.signingSuccess\"\n      name=\"signed\"\n      size=\"tiny\"\n      :label=\"$t('Signed')\"\n    />\n  </button>\n  <CommonSectionPopup v-model:state=\"showPopup\" :messages=\"popupItems\">\n    <template #header>\n      <div\n        class=\"flex flex-col items-center gap-2 border-b border-b-white/10 p-4\"\n      >\n        <div\n          v-if=\"hasError\"\n          class=\"text-yellow flex w-full items-center justify-center gap-1\"\n        >\n          <CommonIcon :name=\"securityIcon\" size=\"tiny\" />\n          {{ $t('Security Error') }}\n        </div>\n        <div\n          v-if=\"security.signingMessage\"\n          :class=\"{\n            'text-orange': !hasError && security.signingSuccess === false,\n          }\"\n        >\n          {{ $t('Sign:') }} {{ $t(security.signingMessage) }}\n        </div>\n        <div\n          v-if=\"security.encryptionMessage\"\n          class=\"break-all\"\n          :class=\"{\n            'text-orange': !hasError && security.encryptionSuccess === false,\n          }\"\n        >\n          {{ $t('Encryption:') }} {{ $t(security.encryptionMessage) }}\n        </div>\n        <div v-if=\"!security.encryptionMessage && !security.signingMessage\">\n          {{ $t('No security information available.') }}\n        </div>\n      </div>\n    </template>\n  </CommonSectionPopup>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { computed, ref, toRef } from 'vue'\n\nimport { useTicketArticleRetryMediaDownload } from '#shared/entities/ticket-article/composables/useTicketArticleRetryMediaDownload.ts'\n\nimport CommonSectionPopup from '#mobile/components/CommonSectionPopup/CommonSectionPopup.vue'\n\nexport interface Props {\n  articleId: string\n  mediaError: boolean\n}\n\nconst props = defineProps<Props>()\n\nconst showPopup = ref(false)\n\nconst { loading, tryAgain } = useTicketArticleRetryMediaDownload(\n  toRef(props, 'articleId'),\n)\n\nconst popupItems = computed(() =>\n  props.mediaError && !loading.value\n    ? [\n        {\n          type: 'button' as const,\n          label: __('Try again'),\n          onAction: async () => {\n            try {\n              await tryAgain()\n              showPopup.value = false\n            } catch {\n              // no-op\n            }\n          },\n          noHideOnSelect: true,\n        },\n      ]\n    : [],\n)\n</script>\n\n<template>\n  <button\n    v-if=\"props.mediaError\"\n    type=\"button\"\n    class=\"bg-yellow inline-flex h-7 grow items-center gap-1 rounded-lg px-2 py-1 text-xs font-bold text-black\"\n    @click.prevent=\"showPopup = !showPopup\"\n    @keydown.space.prevent=\"showPopup = !showPopup\"\n  >\n    <CommonIcon name=\"update\" decorative size=\"xs\" />\n    {{ $t('Media Download Error') }}\n  </button>\n  <CommonSectionPopup v-model:state=\"showPopup\" :messages=\"popupItems\">\n    <template #header>\n      <div\n        class=\"flex flex-col items-center gap-2 border-b border-b-white/10 p-4\"\n      >\n        <div\n          v-if=\"props.mediaError\"\n          class=\"text-yellow flex w-full items-center justify-center gap-1\"\n        >\n          <CommonIcon name=\"update\" size=\"tiny\" />\n          {{ $t('Media Download Error') }}\n        </div>\n        <div\n          v-if=\"loading\"\n          class=\"flex w-full items-center justify-center gap-1\"\n        >\n          <CommonIcon name=\"loading\" animation=\"spin\" />\n        </div>\n      </div>\n    </template>\n  </CommonSectionPopup>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\n/* eslint-disable vue/no-v-html */\n\nimport { computed, nextTick, onMounted, ref, watch } from 'vue'\n\nimport CommonFilePreview from '#shared/components/CommonFilePreview/CommonFilePreview.vue'\nimport CommonUserAvatar from '#shared/components/CommonUserAvatar/CommonUserAvatar.vue'\nimport { useArticleToggleMore } from '#shared/composables/useArticleToggleMore.ts'\nimport { useAttachments } from '#shared/composables/useAttachments.ts'\nimport { useHtmlInlineImages } from '#shared/composables/useHtmlInlineImages.ts'\nimport { useHtmlLinks } from '#shared/composables/useHtmlLinks.ts'\nimport type { ImageViewerFile } from '#shared/composables/useImageViewer.ts'\nimport { useImageViewer } from '#shared/composables/useImageViewer.ts'\nimport type { Attachment } from '#shared/entities/attachment/types.ts'\nimport type {\n  TicketArticleSecurityState,\n  TicketArticlesQuery,\n} from '#shared/graphql/types.ts'\nimport { getIdFromGraphQLId } from '#shared/graphql/utils.ts'\nimport { i18n } from '#shared/i18n.ts'\nimport { useSessionStore } from '#shared/stores/session.ts'\nimport type { ConfidentTake } from '#shared/types/utils.ts'\nimport stopEvent from '#shared/utils/events.ts'\nimport { textToHtml } from '#shared/utils/helpers.ts'\n\nimport { useArticleSeen } from '../../composable/useArticleSeen.ts'\n\nimport ArticleReactionBadge from './ArticleReactionBadge.vue'\nimport ArticleRemoteContentBadge from './ArticleRemoteContentBadge.vue'\nimport ArticleSecurityBadge from './ArticleSecurityBadge.vue'\nimport ArticleWhatsappMediaBadge from './ArticleWhatsappMediaBadge.vue'\n\ninterface Props {\n  position: 'left' | 'right'\n  content: string\n  internal: boolean\n  user?: Maybe<ConfidentTake<TicketArticlesQuery, 'articles.edges.node.author'>>\n  security?: Maybe<TicketArticleSecurityState>\n  contentType: string\n  ticketInternalId: number\n  articleId: string\n  attachments: Attachment[]\n  remoteContentWarning?: string\n  mediaError?: boolean | null\n  reaction?: string\n}\n\nconst props = defineProps<Props>()\nconst emit = defineEmits<{\n  'show-context': []\n  seen: []\n}>()\n\nconst session = useSessionStore()\n\nconst colorClasses = computed(() => {\n  const { internal, position } = props\n\n  if (internal) return 'border border-blue bg-black'\n  if (position === 'left') return 'border border-black bg-white text-black'\n  return 'border border-black bg-blue text-black'\n})\n\nconst bubbleClasses = computed(() => {\n  const { internal, position } = props\n\n  if (internal) return undefined\n\n  return {\n    'rounded-bl-sm': position === 'left',\n    'rounded-br-sm': position === 'right',\n  }\n})\n\nconst username = computed(() => {\n  const { user } = props\n  if (!user) return ''\n  if (session.user?.id === user.id) {\n    return i18n.t('Me')\n  }\n  return user.fullname\n})\n\nconst body = computed(() => {\n  if (props.contentType !== 'text/html') {\n    return textToHtml(props.content)\n  }\n  return props.content\n})\n\nconst colorsClasses = computed(() => {\n  if (props.internal) {\n    return {\n      top: body.value.length ? 'border-t-[0.5px] border-t-white/50' : '',\n      amount: 'text-white/60',\n      file: 'border-white/40',\n      icon: 'border-white/40',\n    }\n  }\n  return {\n    top: body.value.length ? 'border-t-[0.5px] border-black' : '',\n    amount: 'text-black/60',\n    file: 'border-black',\n    icon: 'border-black',\n  }\n})\n\nconst { shownMore, bubbleElement, hasShowMore, toggleShowMore } =\n  useArticleToggleMore()\n\nconst articleInternalId = computed(() => getIdFromGraphQLId(props.articleId))\n\nconst { attachments: articleAttachments } = useAttachments({\n  attachments: computed(() => props.attachments),\n})\n\nconst inlineImages = ref<ImageViewerFile[]>([])\n\nconst { showImage } = useImageViewer(\n  computed(() => [...inlineImages.value, ...articleAttachments.value]),\n)\n\nconst previewImage = (event: Event, attachment: Attachment) => {\n  stopEvent(event)\n  showImage(attachment)\n}\n\nconst { setupLinksHandlers } = useHtmlLinks('/mobile')\nconst { populateInlineImages } = useHtmlInlineImages(inlineImages, (index) =>\n  showImage(inlineImages.value[index]),\n)\n\nwatch(\n  () => props.content,\n  async () => {\n    await nextTick()\n    if (bubbleElement.value) {\n      setupLinksHandlers(bubbleElement.value)\n      populateInlineImages(bubbleElement.value)\n    }\n  },\n)\n\nonMounted(() => {\n  if (bubbleElement.value) {\n    setupLinksHandlers(bubbleElement.value)\n    populateInlineImages(bubbleElement.value)\n  }\n})\n\nuseArticleSeen(bubbleElement, emit)\n\nconst onContextClick = () => {\n  emit('show-context')\n  nextTick(() => {\n    // remove selection because pointerdown event will leave it as is,\n    // all actions inside the context should already have accessed it synchronously\n    window.getSelection()?.removeAllRanges()\n  })\n}\n</script>\n\n<template>\n  <!-- It is the correct role comment -->\n  <!-- eslint-disable vuejs-accessibility/aria-role -->\n  <div\n    :id=\"`article-${articleInternalId}`\"\n    role=\"comment\"\n    class=\"Article relative flex pb-4\"\n    :class=\"{\n      Internal: internal,\n      'Right flex-row-reverse': position === 'right',\n      Left: position === 'left',\n    }\"\n    :data-created-by=\"user?.id\"\n  >\n    <div\n      class=\"h-6 w-6 self-end\"\n      :class=\"{\n        'ltr:mr-2 rtl:ml-2': position === 'left',\n        'ltr:ml-2 rtl:mr-2': position === 'right',\n      }\"\n    >\n      <CommonUserAvatar v-if=\"user\" size=\"xs\" :entity=\"user\" />\n    </div>\n    <div class=\"Border\">\n      <div\n        class=\"content flex flex-col overflow-hidden rounded-3xl px-4 pt-2 pb-3\"\n        :class=\"[bubbleClasses, colorClasses]\"\n      >\n        <div\n          class=\"flex items-center text-xs font-bold\"\n          data-test-id=\"article-username\"\n        >\n          <span class=\"truncate break-words\">\n            {{ username }}\n          </span>\n        </div>\n        <div\n          ref=\"bubbleElement\"\n          data-test-id=\"article-content\"\n          class=\"overflow-hidden text-base\"\n        >\n          <div class=\"Content\" v-html=\"body\" />\n        </div>\n        <div\n          v-if=\"hasShowMore\"\n          class=\"relative\"\n          :class=\"{\n            BubbleGradient: hasShowMore && !shownMore,\n          }\"\n        ></div>\n        <div\n          v-if=\"attachments.length\"\n          class=\"mt-1 mb-2\"\n          :class=\"colorsClasses.top\"\n        >\n          <div class=\"py-1 text-xs\" :class=\"colorsClasses.amount\">\n            {{\n              attachments.length === 1\n                ? $t('1 attached file')\n                : $t('%s attached files', attachments.length)\n            }}\n          </div>\n          <CommonFilePreview\n            v-for=\"attachment of articleAttachments\"\n            :key=\"attachment.internalId\"\n            :file=\"attachment\"\n            :download-url=\"attachment.downloadUrl\"\n            :preview-url=\"attachment.preview\"\n            :no-preview=\"!$c.ui_ticket_zoom_attachments_preview\"\n            :wrapper-class=\"colorsClasses.file\"\n            :icon-class=\"colorsClasses.icon\"\n            :size-class=\"colorsClasses.amount\"\n            no-remove\n            @preview=\"previewImage($event, attachment)\"\n          />\n        </div>\n        <div\n          class=\"absolute bottom-0 flex gap-1\"\n          :class=\"[\n            position === 'left'\n              ? 'flex-row-reverse ltr:left-10 rtl:right-10'\n              : 'ltr:right-10 rtl:left-10',\n          ]\"\n        >\n          <ArticleReactionBadge\n            v-if=\"reaction\"\n            :class=\"[colorClasses]\"\n            :reaction=\"reaction\"\n          />\n          <ArticleWhatsappMediaBadge\n            v-if=\"props.mediaError\"\n            :article-id=\"articleId\"\n            :media-error=\"props.mediaError\"\n          />\n          <ArticleSecurityBadge\n            v-if=\"security\"\n            :article-id=\"articleId\"\n            :success-class=\"colorClasses\"\n            :security=\"security\"\n          />\n          <ArticleRemoteContentBadge\n            v-if=\"remoteContentWarning\"\n            :class=\"colorClasses\"\n            :original-formatting-url=\"remoteContentWarning\"\n          />\n          <button\n            v-if=\"hasShowMore\"\n            :class=\"[\n              colorClasses,\n              'flex h-7 items-center justify-center rounded-md px-2 font-semibold',\n            ]\"\n            type=\"button\"\n            @click=\"toggleShowMore()\"\n            @keydown.enter.prevent=\"toggleShowMore()\"\n          >\n            {{ shownMore ? $t('See less') : $t('See more') }}\n          </button>\n          <button\n            :class=\"[\n              colorClasses,\n              'flex h-7 w-7 items-center justify-center rounded-md',\n            ]\"\n            type=\"button\"\n            data-name=\"article-context\"\n            :aria-label=\"$t('Article actions')\"\n            @pointerdown=\"onContextClick()\"\n            @keydown.enter.prevent=\"onContextClick()\"\n          >\n            <CommonIcon\n              name=\"more-vertical\"\n              size=\"small\"\n              decorative\n              data-ignore-click\n            />\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.Content {\n  word-break: break-word;\n}\n\n.Article:not(.Internal) {\n  &.Right .Content,\n  &.Left .Content {\n    :deep(a) {\n      color: var(--color-black);\n      text-decoration: underline;\n    }\n  }\n}\n\n.BubbleGradient::before {\n  content: '';\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  height: 50px;\n  pointer-events: none;\n}\n\n.Right:not(.Internal) .BubbleGradient::before {\n  background: linear-gradient(rgba(255, 255, 255, 0), var(--color-blue));\n}\n\n.Left:not(.Internal) .BubbleGradient::before {\n  background: linear-gradient(rgba(255, 255, 255, 0), var(--color-white));\n}\n\n.Border {\n  overflow: hidden;\n}\n\n.Internal .Border {\n  background: repeating-linear-gradient(\n    45deg,\n    var(--color-blue),\n    var(--color-blue) 5px,\n    var(--color-blue-dark) 5px,\n    var(--color-blue-dark) 10px\n  );\n  background-size: 14px 14px;\n  background-position: -1px;\n  padding: 4px;\n  border-radius: calc(1.5rem + 4px);\n  margin: -4px;\n}\n\n.Internal .BubbleGradient::before {\n  background: linear-gradient(rgba(255, 255, 255, 0), var('--color-black'));\n}\n</style>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\n\nimport { useArticleSeen } from '../../composable/useArticleSeen.ts'\n\ndefineProps<{\n  content: string\n  gap: 'small' | 'big'\n}>()\n\nconst emit = defineEmits<{\n  seen: []\n}>()\n\nconst articleElement = ref<HTMLDivElement>()\n\nuseArticleSeen(articleElement, emit)\n</script>\n\n<template>\n  <div ref=\"articleElement\" class=\"flex justify-center\">\n    <div\n      :class=\"{ 'mt-6': gap === 'big', 'mt-2': gap === 'small' }\"\n      class=\"border-yellow bg-yellow-highlight text-yellow flex flex-col items-center rounded-3xl border p-4\"\n    >\n      <div\n        class=\"bg-yellow absolute flex h-7 w-7 -translate-y-7 items-center justify-center rounded-full text-black\"\n      >\n        <CommonIcon name=\"warning\" size=\"small\" />\n      </div>\n      <div>{{ $t('Delivery failed: \"%s\"', content) }}</div>\n    </div>\n  </div>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<template>\n  <div class=\"line-new text-center select-none\">\n    <span class=\"text-blue bg-black px-2\">{{ $t('new') }}</span>\n  </div>\n</template>\n\n<style scoped>\n.line-new {\n  background: linear-gradient(\n    180deg,\n    rgba(0, 0, 0, 0) calc(50% - 1px),\n    #23a2cd calc(50%),\n    rgba(0, 0, 0, 0) calc(50% + 1px)\n  );\n}\n</style>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\n\nimport { useArticleSeen } from '../../composable/useArticleSeen.ts'\n\nimport ArticleReactionBadge from './ArticleReactionBadge.vue'\n\ninterface Props {\n  subject?: Maybe<string>\n  to?: Maybe<string>\n  reaction?: Maybe<string>\n}\n\ndefineProps<Props>()\n\nconst emit = defineEmits<{\n  seen: []\n}>()\n\nconst articleElement = ref<HTMLDivElement>()\n\nuseArticleSeen(articleElement, emit)\n</script>\n\n<template>\n  <div ref=\"articleElement\" class=\"text-gray flex items-center gap-2\">\n    <div class=\"grow text-center\">\"{{ subject }}\" -&gt; \"{{ to }}\"</div>\n    <ArticleReactionBadge\n      v-if=\"reaction\"\n      class=\"bg-blue w-7 border border-black text-black\"\n      :reaction=\"reaction\"\n    />\n  </div>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { toRef, shallowRef } from 'vue'\n\nimport type {\n  TicketArticle,\n  TicketById,\n} from '#shared/entities/ticket/types.ts'\nimport { EnumTicketArticleSenderName } from '#shared/graphql/types.ts'\n\nimport CommonSectionPopup from '#mobile/components/CommonSectionPopup/CommonSectionPopup.vue'\n\nimport { useTicketArticleContext } from '../../composable/useTicketArticleContext.ts'\nimport { useTicketArticleRows } from '../../composable/useTicketArticlesRows.ts'\nimport { useTicketInformation } from '../../composable/useTicketInformation.ts'\n\nimport ArticleBubble from './ArticleBubble.vue'\nimport ArticleDeliveryMessage from './ArticleDeliveryMessage.vue'\nimport ArticleSeparatorDate from './ArticleSeparatorDate.vue'\nimport ArticleSeparatorMore from './ArticleSeparatorMore.vue'\nimport ArticleSeparatorNew from './ArticleSeparatorNew.vue'\nimport ArticleSystem from './ArticleSystem.vue'\n\ninterface Props {\n  articles: TicketArticle[]\n  ticket: TicketById\n  totalCount: number\n}\n\nconst props = defineProps<Props>()\nconst emit = defineEmits<{\n  'load-previous': []\n}>()\n\nconst { contextOptions, articleContextShown, showArticleContext } =\n  useTicketArticleContext()\n\nconst articlesElement = shallowRef<HTMLElement>()\n\nconst { rows } = useTicketArticleRows(\n  toRef(props, 'articles'),\n  toRef(props, 'totalCount'),\n)\n\nconst filterAttachments = (article: TicketArticle) => {\n  return article.attachmentsWithoutInline.filter(\n    (file) => !file.preferences || !file.preferences['original-format'],\n  )\n}\n\nconst remoteContentWarning = (article: TicketArticle): string | undefined => {\n  if (!article.preferences?.remote_content_removed) return\n\n  let originalFormattingUrl\n\n  article.attachmentsWithoutInline.forEach((file) => {\n    if (file.preferences?.['original-format'] !== true) {\n      return\n    }\n    const articleInternalId = article.internalId\n    const attachmentInternalId = file.internalId\n    const ticketInternalId = props.ticket.internalId\n    originalFormattingUrl = `/ticket_attachment/${ticketInternalId}/${articleInternalId}/${attachmentInternalId}?disposition=attachment`\n  })\n\n  return originalFormattingUrl\n}\n\nconst { newArticlesIds } = useTicketInformation()\n\nconst markSeen = (id: string) => {\n  newArticlesIds.delete(id)\n}\n</script>\n\n<template>\n  <section\n    ref=\"articlesElement\"\n    role=\"group\"\n    aria-label=\"Articles\"\n    class=\"relative flex-1 space-y-4 px-4 pt-4\"\n  >\n    <template v-for=\"(row, idx) in rows\" :key=\"row.key\">\n      <ArticleBubble\n        v-if=\"row.type === 'article-bubble'\"\n        :content=\"row.article.bodyWithUrls\"\n        :user=\"row.article.author\"\n        :internal=\"row.article.internal\"\n        :content-type=\"row.article.contentType\"\n        :position=\"\n          row.article.sender?.name !== EnumTicketArticleSenderName.Customer\n            ? 'left'\n            : 'right'\n        \"\n        :media-error=\"row.article.mediaErrorState?.error\"\n        :security=\"row.article.securityState\"\n        :ticket-internal-id=\"ticket.internalId\"\n        :article-id=\"row.article.id\"\n        :attachments=\"filterAttachments(row.article)\"\n        :remote-content-warning=\"remoteContentWarning(row.article)\"\n        :reaction=\"row.article.preferences?.whatsapp?.reaction?.emoji\"\n        @seen=\"markSeen(row.key)\"\n        @show-context=\"showArticleContext(row.article, ticket)\"\n      />\n      <ArticleDeliveryMessage\n        v-if=\"row.type === 'delivery'\"\n        :content=\"row.content\"\n        :gap=\"rows[idx - 1]?.type === 'article-bubble' ? 'big' : 'small'\"\n        @seen=\"markSeen(row.key)\"\n      />\n      <ArticleSystem\n        v-if=\"row.type === 'system'\"\n        :to=\"row.to\"\n        :subject=\"row.subject\"\n        :reaction=\"row.reaction\"\n        @seen=\"markSeen(row.key)\"\n      />\n      <ArticleSeparatorDate v-if=\"row.type === 'date'\" :date=\"row.date\" />\n      <ArticleSeparatorNew v-if=\"row.type === 'new'\" />\n      <ArticleSeparatorMore\n        v-if=\"row.type === 'more'\"\n        :count=\"row.count\"\n        @click=\"emit('load-previous')\"\n      />\n    </template>\n  </section>\n  <CommonSectionPopup\n    v-model:state=\"articleContextShown\"\n    :messages=\"contextOptions\"\n  />\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { toRef } from 'vue'\n\nimport CommonUserAvatar from '#shared/components/CommonUserAvatar/CommonUserAvatar.vue'\nimport type {\n  TicketById,\n  TicketLiveAppUser,\n} from '#shared/entities/ticket/types.ts'\nimport { useSessionStore } from '#shared/stores/session.ts'\n\nimport CommonLoader from '#mobile/components/CommonLoader/CommonLoader.vue'\nimport LayoutHeader from '#mobile/components/layout/LayoutHeader.vue'\nimport { useDialog } from '#mobile/composables/useDialog.ts'\n\ninterface Props {\n  ticket?: TicketById\n  liveUserList?: TicketLiveAppUser[]\n  loadingTicket?: boolean\n  refetchingTicket: boolean\n}\n\nconst props = defineProps<Props>()\nconst session = useSessionStore()\n\nconst viewersDialog = useDialog({\n  name: 'ticket-viewers-dialog',\n  component: () => import('./TicketViewersDialog.vue'),\n})\n\nconst actionsDialog = useDialog({\n  name: 'ticket-header-actions-dialog',\n  component: () => import('./TicketActionsDialog.vue'),\n})\n\nconst showViewers = () => {\n  return viewersDialog.open({\n    name: viewersDialog.name,\n    liveUsers: toRef(props, 'liveUserList'),\n  })\n}\n\nconst showActions = () => {\n  if (!props.ticket) return\n\n  actionsDialog.open({\n    name: actionsDialog.name,\n    ticket: toRef(props, 'ticket'),\n  })\n}\n</script>\n\n<template>\n  <LayoutHeader\n    class=\"bg-gray-600/90\"\n    :refetch=\"refetchingTicket || loadingTicket\"\n    :back-ignore=\"[`/tickets/${ticket?.internalId}/information`]\"\n    back-url=\"/\"\n  >\n    <div\n      class=\"flex flex-1 flex-col items-center justify-center text-center text-sm leading-4\"\n      data-test-id=\"header-content\"\n    >\n      <div class=\"font-bold\">\n        {{ ticket && `#${ticket.number}` }}\n      </div>\n      <div class=\"text-gray\">\n        {{\n          ticket && $t('created %s', i18n.relativeDateTime(ticket.createdAt))\n        }}\n      </div>\n    </div>\n\n    <template #after>\n      <CommonLoader data-test-id=\"loader-header\" :loading=\"loadingTicket\">\n        <button\n          v-if=\"liveUserList?.length\"\n          class=\"flex ltr:mr-0.5 rtl:ml-0.5\"\n          data-test-id=\"viewers-counter\"\n          type=\"button\"\n          :aria-label=\"$t('Show ticket viewers')\"\n          @click=\"showViewers()\"\n        >\n          <CommonUserAvatar\n            class=\"z-10\"\n            :entity=\"liveUserList[0].user\"\n            personal\n            size=\"xs\"\n          />\n          <div\n            v-if=\"liveUserList.length - 1\"\n            class=\"z-0 flex h-6 w-6 items-center justify-center rounded-full bg-white/80 text-xs text-black select-none ltr:-translate-x-2 rtl:translate-x-2\"\n            role=\"img\"\n            :aria-label=\"$t('Ticket has %s viewers', liveUserList.length)\"\n          >\n            +{{ liveUserList.length - 1 }}\n          </div>\n        </button>\n        <button\n          v-if=\"session.hasPermission('ticket.agent')\"\n          type=\"button\"\n          :aria-label=\"$t('Show ticket actions')\"\n          @click=\"showActions()\"\n        >\n          <CommonIcon name=\"more\" size=\"base\" decorative />\n        </button>\n      </CommonLoader>\n    </template>\n  </LayoutHeader>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { toRef } from 'vue'\n\nimport {\n  useEscalationState,\n  EscalationState,\n} from '#shared/composables/useEscalationState.ts'\nimport type { Scalars } from '#shared/graphql/types.ts'\n\nexport interface Props {\n  escalationAt?: Maybe<Scalars['ISO8601DateTime']['output']>\n}\n\nconst props = defineProps<Props>()\n\nconst escalationState = useEscalationState(toRef(() => props.escalationAt))\n</script>\n\n<template>\n  <div\n    v-if=\"escalationState !== EscalationState.None\"\n    :class=\"{\n      'bg-red-dark text-red-bright':\n        escalationState === EscalationState.Escalated,\n      'bg-yellow-highlight text-yellow':\n        escalationState === EscalationState.Warning,\n    }\"\n    class=\"flex items-center rounded bg-gray-100 py-1 text-black select-none ltr:pr-1.5 ltr:pl-1 rtl:pr-1 rtl:pl-1.5\"\n    role=\"alert\"\n  >\n    <CommonIcon name=\"ticket-escalating\" size=\"tiny\" decorative />\n    <div\n      v-if=\"escalationAt\"\n      class=\"text-xs leading-[14px] uppercase ltr:ml-[2px] rtl:mr-[2px]\"\n    >\n      {{ $t('escalation %s', i18n.relativeDateTime(escalationAt)) }}\n    </div>\n  </div>\n</template>\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { computed, toRef } from 'vue'\n\nimport CommonOrganizationAvatar from '#shared/components/CommonOrganizationAvatar/CommonOrganizationAvatar.vue'\nimport CommonUserAvatar from '#shared/components/CommonUserAvatar/CommonUserAvatar.vue'\nimport { useTicketChannel } from '#shared/entities/ticket/composables/useTicketChannel.ts'\nimport { useTicketView } from '#shared/entities/ticket/composables/useTicketView.ts'\nimport type { TicketById } from '#shared/entities/ticket/types.ts'\nimport { useLocaleStore } from '#shared/stores/locale.ts'\n\nimport CommonTicketEscalationIndicator from '#mobile/components/CommonTicketEscalationIndicator/CommonTicketEscalationIndicator.vue'\nimport CommonTicketPriorityIndicator from '#mobile/components/CommonTicketPriorityIndicator/CommonTicketPriorityIndicator.vue'\nimport CommonTicketStateIndicator from '#mobile/components/CommonTicketStateIndicator/CommonTicketStateIndicator.vue'\n\ninterface Props {\n  ticket: TicketById\n}\n\nconst props = defineProps<Props>()\n\nconst ticketReactive = toRef(props, 'ticket')\n\n// TODO: Maybe in the future we can hide additional information (e.g. the priority) directly with the graphql query for\n//  the ticket details (similar to the ticket list).\nconst { isTicketAgent, isTicketEditable } = useTicketView(ticketReactive)\n\nconst { hasChannelAlert, channelAlert } = useTicketChannel(ticketReactive)\n\nconst locale = useLocaleStore()\n\nconst customer = computed(() => {\n  const { customer } = props.ticket\n  if (!customer) return ''\n  const { fullname } = customer\n  if (fullname === '-') return ''\n  return fullname\n})\n</script>\n\n<template>\n  <div data-test-id=\"ticket-title\" class=\"relative\">\n    <div class=\"border-b-[0.5px] border-white/10 bg-gray-600/90\">\n      <CommonLink\n        class=\"flex px-4 py-5\"\n        data-test-id=\"title-content\"\n        :link=\"`/tickets/${ticket.internalId}/information`\"\n      >\n        <div class=\"flex ltr:mr-3 rtl:ml-3\">\n          <CommonUserAvatar class=\"z-10\" :entity=\"ticket.customer\" />\n          <CommonOrganizationAvatar\n            v-if=\"ticket.organization\"\n            class=\"z-0 ltr:-translate-x-1 rtl:translate-x-1\"\n            :entity=\"ticket.organization\"\n          />\n        </div>\n        <div\n          class=\"overflow-hidden ltr:mr-1 rtl:ml-1\"\n          :class=\"{ 'ltr:-ml-1 rtl:-mr-1': ticket.organization }\"\n        >\n          <div class=\"flex text-sm leading-4 text-gray-100\">\n            <div\n              class=\"truncate\"\n              :class=\"{\n                'max-w-[80vw]': !ticket.organization,\n                'max-w-[40vw]': ticket.organization,\n              }\"\n            >\n              {{ customer }}\n            </div>\n            <template v-if=\"ticket.organization\">\n              <div class=\"px-1\">·</div>\n              <div class=\"max-w-[40vw] truncate\">\n                {{ ticket.organization.name }}\n              </div>\n            </template>\n          </div>\n          <h1 class=\"line-clamp-3 text-xl leading-7 font-bold break-words\">\n            {{ ticket.title }}\n          </h1>\n          <div class=\"mt-2 flex flex-wrap gap-2\">\n            <CommonTicketEscalationIndicator\n              v-if=\"isTicketAgent && ticket.escalationAt\"\n              :escalation-at=\"ticket.escalationAt\"\n            />\n            <CommonTicketStateIndicator\n              :color-code=\"ticket.stateColorCode\"\n              :label=\"ticket.state.name\"\n              pill\n            />\n            <CommonTicketPriorityIndicator\n              v-if=\"isTicketAgent\"\n              :priority=\"ticket.priority\"\n            />\n          </div>\n        </div>\n        <CommonIcon\n          :name=\"`chevron-${locale.localeData?.dir === 'rtl' ? 'left' : 'right'}`\"\n          size=\"base\"\n          class=\"shrink-0 self-center ltr:-mr-2 ltr:ml-auto rtl:mr-auto rtl:-ml-2\"\n          decorative\n        />\n      </CommonLink>\n    </div>\n    <CommonAlert\n      v-if=\"isTicketAgent && isTicketEditable && hasChannelAlert\"\n      class=\"rounded-b-lg\"\n      :variant=\"channelAlert?.variant\"\n    >\n      {{ $t(channelAlert?.text, channelAlert?.textPlaceholder) }}\n    </CommonAlert>\n  </div>\n</template>\n","// Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/\n\nimport { computed } from 'vue'\n\nimport { useApplicationStore } from '#shared/stores/application.ts'\n\nconst ticketArticlesLoaded = new Set<string>()\n\nexport const clearTicketArticlesLoadedState = () => {\n  ticketArticlesLoaded.clear()\n}\n\nexport const useTicketArticlesQueryVariables = () => {\n  const application = useApplicationStore()\n\n  const ticketArticlesMin = computed(() => {\n    return Number(application.config.ticket_articles_min ?? 5)\n  })\n\n  const getTicketArticlesQueryVariables = (ticketId: string) => {\n    if (ticketArticlesLoaded.has(ticketId)) {\n      return {\n        ticketId,\n        loadFirstArticles: false,\n        pageSize: 100,\n      }\n    }\n\n    return {\n      ticketId,\n      pageSize: ticketArticlesMin.value,\n    }\n  }\n\n  const markTicketArticlesLoaded = (ticketId: string) => {\n    ticketArticlesLoaded.add(ticketId)\n  }\n\n  const allTicketArticlesLoaded = (ticketId: string) =>\n    ticketArticlesLoaded.has(ticketId)\n\n  return {\n    ticketArticlesMin,\n    allTicketArticlesLoaded,\n    markTicketArticlesLoaded,\n    getTicketArticlesQueryVariables,\n  }\n}\n","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { computed, watch } from 'vue'\nimport { useRoute } from 'vue-router'\n\nimport { useStickyHeader } from '#shared/composables/useStickyHeader.ts'\nimport {\n  type AddArticleCallbackArgs,\n  useArticleDataHandler,\n} from '#shared/entities/ticket-article/composables/useArticleDataHandler.ts'\nimport {\n  convertToGraphQLId,\n  getIdFromGraphQLId,\n} from '#shared/graphql/utils.ts'\nimport { QueryHandler } from '#shared/server/apollo/handler/index.ts'\nimport { useSessionStore } from '#shared/stores/session.ts'\nimport { edgesToArray, waitForElement } from '#shared/utils/helpers.ts'\n\nimport CommonLoader from '#mobile/components/CommonLoader/CommonLoader.vue'\nimport { useHeader } from '#mobile/composables/useHeader.ts'\n\nimport TicketArticlesList from '../components/TicketDetailView/ArticlesList.vue'\nimport TicketHeader from '../components/TicketDetailView/TicketDetailViewHeader.vue'\nimport TicketTitle from '../components/TicketDetailView/TicketDetailViewTitle.vue'\nimport { useTicketArticlesQueryVariables } from '../composable/useTicketArticlesVariables.ts'\nimport { useTicketInformation } from '../composable/useTicketInformation.ts'\n\ninterface Props {\n  internalId: string\n}\n\nconst props = defineProps<Props>()\n\nconst ticketId = computed(() => convertToGraphQLId('Ticket', props.internalId))\n\n// When the last article is deleted, cursor has to be adjusted\n//  to show newly created articles in the list (if any).\n// Cursor is offset-based, so the old cursor is pointing to an unavailable article,\n//  thus using the cursor for the last article of the already filtered edges.\n\nconst {\n  ticket,\n  liveUserList,\n  ticketQuery,\n  scrolledToBottom,\n  newArticlesIds,\n  scrollDownState,\n} = useTicketInformation()\n\nconst scrollElement = (element: Element) => {\n  scrolledToBottom.value = true\n  element.scrollIntoView({ behavior: 'smooth', block: 'start' })\n  return true\n}\n\nconst session = useSessionStore()\n\nconst scheduleMyArticleScroll = async (\n  articleInternalId: number,\n  originalTime = new Date().getTime(),\n): Promise<void> => {\n  // try to scroll for 5 seconds\n  const difference = new Date().getTime() - originalTime\n  if (difference >= 5000 || typeof document === 'undefined') return\n\n  const element = document.querySelector(\n    `#article-${articleInternalId}`,\n  ) as HTMLDivElement | null\n\n  if (!element) {\n    return new Promise((r) => requestAnimationFrame(r)).then(() =>\n      scheduleMyArticleScroll(articleInternalId, originalTime),\n    )\n  }\n\n  if (element.dataset.createdBy === session.userId) {\n    element.scrollIntoView({ behavior: 'smooth', block: 'start' })\n  }\n}\n\nconst isAtTheBottom = () => {\n  const scrollHeight =\n    document.querySelector('main')?.scrollHeight || window.innerHeight\n  const scrolledHeight = window.scrollY + window.innerHeight\n  const scrollToBottom = scrollHeight - scrolledHeight\n  return scrollToBottom < 20\n}\n\nconst hasScroll = () => {\n  const scrollHeight =\n    document.querySelector('main')?.scrollHeight || window.innerHeight\n  return scrollHeight > window.innerHeight\n}\n\nconst onAddArticleCallback = ({\n  updates,\n  previousArticlesEdges,\n  previousArticlesEdgesCount,\n  articlesQuery,\n  result,\n  allArticleLoaded,\n  refetchArticlesQuery,\n}: AddArticleCallbackArgs) => {\n  scrollDownState.value = hasScroll()\n  newArticlesIds.add(updates?.addArticle?.id as string)\n  scheduleMyArticleScroll(getIdFromGraphQLId(updates?.addArticle?.id as string))\n\n  const needRefetch =\n    !previousArticlesEdges[previousArticlesEdgesCount - 1] ||\n    (updates?.addArticle?.createdAt as string) <=\n      previousArticlesEdges[previousArticlesEdgesCount - 1].node.createdAt\n\n  if (!allArticleLoaded.value || needRefetch) {\n    refetchArticlesQuery(null)\n  } else {\n    ;(articlesQuery as QueryHandler).fetchMore({\n      variables: {\n        pageSize: 100,\n        loadFirstArticles: false,\n        afterCursor: result.value?.articles.pageInfo.endCursor,\n      },\n    })\n  }\n}\n\nconst {\n  ticketArticlesMin,\n  markTicketArticlesLoaded,\n  getTicketArticlesQueryVariables,\n} = useTicketArticlesQueryVariables()\n\nconst { articlesQuery, articleResult } = useArticleDataHandler(ticketId, {\n  firstArticlesCount: ticketArticlesMin,\n  pageSize: getTicketArticlesQueryVariables(ticketId.value).pageSize as number,\n  onAddArticleCallback,\n})\n\nconst loadPreviousArticles = async () => {\n  markTicketArticlesLoaded(ticketId.value)\n  await articlesQuery.fetchMore({\n    variables: {\n      pageSize: 100,\n      loadFirstArticles: false,\n      beforeCursor: articleResult.value?.articles.pageInfo.startCursor,\n    },\n  })\n}\n\nconst isLoadingTicket = computed(() => {\n  return ticketQuery.loading().value && !ticket.value\n})\n\nconst isRefetchingTicket = computed(\n  () => ticketQuery.loading().value && !!ticket.value,\n)\n\nconst totalCount = computed(() => articleResult.value?.articles.totalCount || 0)\n\nconst toMs = (date: string) => new Date(date).getTime()\n\nconst articles = computed(() => {\n  if (!articleResult.value) {\n    return []\n  }\n  const nodes = edgesToArray(articleResult.value.articles)\n  const totalCount = articleResult.value.articles.totalCount || 0\n  // description might've returned with \"articles\"\n  const description = articleResult.value.firstArticles?.edges[0]?.node\n  if (totalCount > nodes.length && description) {\n    nodes.unshift(description)\n  }\n  return nodes.sort((a, b) => toMs(a.createdAt) - toMs(b.createdAt))\n})\n\nuseHeader({\n  title: computed(() => {\n    if (!ticket.value) return ''\n    const { number, title } = ticket.value\n    return `#${number} - ${title}`\n  }),\n})\n\n// don't scroll only if articles are already loaded when you opened the page\n// and there is a saved scroll position\n// otherwise if we only check the scroll position we will never scroll to the bottom\n// because it can be defined when we open the page the first time\nif (articleResult.value && window.history?.state?.scroll) {\n  scrolledToBottom.value = true\n}\n\nconst route = useRoute()\n\nlet ignoreQuery = false\n\n// scroll to the article in the hash or to the last available article\nconst initialScroll = async () => {\n  if (route.hash) {\n    const articleNode = document.querySelector(route.hash)\n\n    if (articleNode) {\n      return scrollElement(articleNode)\n    }\n\n    if (!articleNode && !ignoreQuery) {\n      ignoreQuery = true\n      await loadPreviousArticles()\n      const node = document.querySelector(route.hash)\n      if (node) {\n        return scrollElement(node)\n      }\n    }\n  }\n\n  const internalId = articles.value[articles.value.length - 1]?.internalId\n  if (!internalId) return false\n\n  const lastArticle = await waitForElement(`#article-${internalId}`)\n\n  if (!lastArticle) return false\n\n  return scrollElement(lastArticle)\n}\n\nconst stopScrollWatch = watch(\n  () => articles.value.length,\n  async () => {\n    // Do nothing for initial article computed value, because this is initialy an empty error, when\n    // nothing is used from the cache.\n    if (articles.value.length === 0) return\n\n    if (hasScroll() && !isAtTheBottom()) {\n      scrollDownState.value = true\n    }\n\n    const scrolled = await initialScroll()\n    if (scrolled) stopScrollWatch()\n  },\n  { immediate: true, flush: 'post' },\n)\n\nconst { stickyStyles, headerElement } = useStickyHeader([\n  isLoadingTicket,\n  ticket,\n])\n\nuseEventListener(\n  window.document,\n  'scroll',\n  () => {\n    scrollDownState.value = !isAtTheBottom()\n  },\n  { passive: true },\n)\n</script>\n\n<template>\n  <div\n    id=\"ticket-header\"\n    ref=\"headerElement\"\n    class=\"relative backdrop-blur-lg\"\n    :style=\"stickyStyles.header\"\n  >\n    <TicketHeader\n      :ticket=\"ticket\"\n      :live-user-list=\"liveUserList\"\n      :loading-ticket=\"isLoadingTicket\"\n      :refetching-ticket=\"isRefetchingTicket\"\n    />\n    <CommonLoader\n      :loading=\"isLoadingTicket\"\n      data-test-id=\"loader-title\"\n      class=\"flex border-b-[0.5px] border-white/10 bg-gray-600/90 px-4 py-5\"\n    >\n      <TicketTitle v-if=\"ticket\" :ticket=\"ticket\" />\n    </CommonLoader>\n  </div>\n  <div\n    id=\"ticket-articles-list\"\n    class=\"flex flex-1 flex-col\"\n    :style=\"stickyStyles.body\"\n  >\n    <CommonLoader\n      data-test-id=\"loader-list\"\n      :loading=\"isLoadingTicket\"\n      class=\"mt-2\"\n    >\n      <TicketArticlesList\n        v-if=\"ticket\"\n        :ticket=\"ticket\"\n        :articles=\"articles\"\n        :total-count=\"totalCount\"\n        @load-previous=\"loadPreviousArticles\"\n      />\n    </CommonLoader>\n  </div>\n</template>\n"],"file":"assets/TicketDetailArticlesView-Cye8cs8g.js"}