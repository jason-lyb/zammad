import{e as R,M as L,N as f,G as M,U as j,c as O}from"./apollo-Cj5TVUDk.js";import{p as x}from"./utils-C-eON4SW.js";import{a2 as F,X as I,at as N,Z as C,aX as S,aB as B,aO as V}from"./overviewAttributes.api-C09LSZ8O.js";import{i as Q,q as $}from"./routes-CgLO9M4y.js";import{d as q}from"./dom-0wVl69Vp.js";import{u as G}from"./useObjectAttributeFormData-BTXeBYyl.js";import{t as _}from"./useTicketCreateArticleType-D7iVcJ_6.js";import{n as H}from"./vendor-C11O1Xx8.js";import{T as U}from"./ticketAttributes.api-rqx5ITab.js";import{u as W}from"./useTicketCreateView-HCH46SPv.js";const g=__("attachment,attached,enclosed,enclosure"),X=t=>{const r=q(t);return r.querySelectorAll('blockquote, img, div[data-signature="true"]').forEach(c=>c.remove()),r.innerHTML},Y=t=>{const r=X(t),c=g.split(","),n=Q.t(g).split(",");return c.concat(n).some(i=>new RegExp(`\\b${i}\\b`,"i").test(r))},Z=()=>{const{waitForConfirmation:t}=F();return{missingBodyAttachmentReference:(n,i)=>!n||i&&i.length>0?!1:Y(n),bodyAttachmentReferenceConfirmation:async()=>await t(__("Did you plan to include attachments with this message?"),{buttonLabel:__("Yes, add attachments now"),cancelLabel:__("No, thanks")})}},z=H`
    mutation ticketCreate($input: TicketCreateInput!) {
  ticketCreate(input: $input) {
    ticket {
      ...ticketAttributes
    }
    errors {
      ...errors
    }
  }
}
    ${U}
${I}`;function J(t={}){return R(z,t)}const ae=(t,r)=>{const{isTicketCustomer:c}=W(),{notify:n}=O(),i=()=>{n({id:"ticket-create-success",type:f.Success,message:__("Ticket has been created successfully.")})},h=e=>{var d,l,m,o;if("graphQLErrors"in e){const a=(d=e.graphQLErrors)==null?void 0:d[0];if(((l=a==null?void 0:a.extensions)==null?void 0:l.type)===M.Forbidden)return i(),()=>r();n({id:"ticket-create-error",message:__("Ticket could not be created."),type:f.Error})}else{if(e instanceof j&&((m=t.value)!=null&&m.formNode)){B((o=t.value)==null?void 0:o.formNode,e);return}n({id:"ticket-create-error",message:e.generalErrors[0],type:f.Error})}},A=new L(J({}),{errorShowNotification:!1}),{missingBodyAttachmentReference:w,bodyAttachmentReferenceConfirmation:v}=Z(),E=e=>V(e)?{id:e}:{email:e};return{createTicket:async e=>{var b;if(w(e.body,e.attachments)&&await v())return!1;const{attributesLookup:d}=N($.Ticket),{internalObjectAttributeValues:l,additionalObjectAttributeValues:m}=G(d.value,e),{customerId:o,...a}=l;let k;e.shared_draft_id&&(k=C("Ticket::SharedDraftStart",e.shared_draft_id));const u={...a,sharedDraftId:k,customer:o?E(o):void 0,article:{cc:e.cc,body:x(e.body),sender:c.value?"Customer":_[e.articleSenderType].sender,type:c.value?"web":_[e.articleSenderType].type,contentType:"text/html",security:e.security},objectAttributeValues:m};if(e.attachments&&u.article&&((b=t.value)!=null&&b.formId)&&(u.article.attachments=S(t.value.formId,e.attachments)),e.link_ticket_id){const s=C("Ticket",e.link_ticket_id);u.links=[{linkObjectId:s,linkType:"child"}]}return e.externalReferences&&(u.externalReferences=e.externalReferences),A.send({input:u}).then(s=>{var y;return(y=s==null?void 0:s.ticketCreate)!=null&&y.ticket?(i(),()=>{var T;const p=(T=s.ticketCreate)==null?void 0:T.ticket;r(p!=null&&p.policy.update?p.internalId:void 0)}):null}).catch(h)},isTicketCustomer:c}};export{ae as u};
//# sourceMappingURL=useTicketCreate-DQOD5AnJ.js.map
