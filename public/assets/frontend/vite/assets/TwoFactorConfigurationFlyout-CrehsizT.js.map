{"version":3,"file":"TwoFactorConfigurationFlyout-CrehsizT.js","sources":["../../../../../app/frontend/apps/desktop/components/TwoFactor/TwoFactorConfigurationFlyout.vue"],"sourcesContent":["<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { ref, computed, useTemplateRef } from 'vue'\n\nimport { useTwoFactorPlugins } from '#shared/entities/two-factor/composables/useTwoFactorPlugins.ts'\nimport { i18n } from '#shared/i18n.ts'\nimport type { ObjectLike } from '#shared/types/utils.ts'\n\nimport CommonFlyout from '#desktop/components/CommonFlyout/CommonFlyout.vue'\nimport { closeFlyout } from '#desktop/components/CommonFlyout/useFlyout.ts'\n\nimport TwoFactorConfigurationPasswordCheck from './TwoFactorConfiguration/TwoFactorConfigurationPasswordCheck.vue'\nimport TwoFactorConfigurationRecoveryCodes from './TwoFactorConfiguration/TwoFactorConfigurationRecoveryCodes.vue'\n\nimport type {\n  TwoFactorConfigurationActionPayload,\n  TwoFactorConfigurationComponentInstance,\n  TwoFactorConfigurationProps,\n  TwoFactorConfigurationType,\n} from './types.ts'\n\nconst props = defineProps<TwoFactorConfigurationProps>()\n\nconst activeComponentInstance =\n  useTemplateRef<TwoFactorConfigurationComponentInstance>('active-component')\n\nconst flyoutName = 'two-factor-flyout'\n\nconst headerTitle = computed(() => {\n  switch (props.type) {\n    case 'recovery_codes':\n      return i18n.t(\n        'Generate Recovery Codes: %s',\n        i18n.t(activeComponentInstance.value?.headerSubtitle),\n      )\n    case 'removal_confirmation':\n      return i18n.t(\n        'Remove Two-factor Authentication: %s',\n        i18n.t(activeComponentInstance.value?.headerSubtitle),\n      )\n    default:\n      return i18n.t(\n        'Set Up Two-factor Authentication: %s',\n        i18n.t(activeComponentInstance.value?.headerSubtitle),\n      )\n  }\n})\n\nconst state = ref<TwoFactorConfigurationType>('password_check')\nconst componentOptions = ref<ObjectLike>()\nconst token = ref()\n\nconst { twoFactorMethodLookup } = useTwoFactorPlugins()\n\nconst activeComponent = computed(() => {\n  switch (state.value) {\n    case 'recovery_codes':\n      return TwoFactorConfigurationRecoveryCodes\n    case 'password_check':\n    case 'removal_confirmation':\n      return TwoFactorConfigurationPasswordCheck\n    default:\n      return twoFactorMethodLookup[state.value].configurationOptions?.component\n  }\n})\n\nconst handleActionPayload = (payload: TwoFactorConfigurationActionPayload) => {\n  if (!payload?.nextState) {\n    closeFlyout('two-factor-flyout')\n    return\n  }\n\n  state.value = payload.nextState\n  token.value = payload.token\n  componentOptions.value = payload.options\n}\n\nconst onFooterButtonAction = () => {\n  if (activeComponentInstance.value?.footerActionOptions?.form) return\n  activeComponentInstance.value\n    ?.executeAction?.()\n    .then((payload) => handleActionPayload(payload))\n    .catch(() => {})\n}\n</script>\n\n<template>\n  <CommonFlyout\n    :header-title=\"headerTitle\"\n    :footer-action-options=\"activeComponentInstance?.footerActionOptions\"\n    :header-icon=\"activeComponentInstance?.headerIcon\"\n    :name=\"flyoutName\"\n    no-close-on-action\n    @action=\"onFooterButtonAction\"\n  >\n    <component\n      :is=\"activeComponent\"\n      ref=\"active-component\"\n      :type=\"type\"\n      :token=\"token\"\n      :options=\"componentOptions\"\n      :form-submit-callback=\"handleActionPayload\"\n      :success-callback=\"successCallback\"\n    />\n  </CommonFlyout>\n</template>\n"],"names":["flyoutName","props","__props","activeComponentInstance","useTemplateRef","headerTitle","computed","i18n","_a","_b","_c","state","ref","componentOptions","token","twoFactorMethodLookup","useTwoFactorPlugins","activeComponent","TwoFactorConfigurationRecoveryCodes","TwoFactorConfigurationPasswordCheck","handleActionPayload","payload","closeFlyout","onFooterButtonAction","_d"],"mappings":"qwCA2BA,MAAMA,EAAa,yHALnB,MAAMC,EAAQC,EAERC,EACJC,EAAwD,kBAAkB,EAItEC,EAAcC,EAAS,IAAM,WACjC,OAAQL,EAAM,KAAM,CAClB,IAAK,iBACH,OAAOM,EAAK,EACV,8BACAA,EAAK,GAAEC,EAAAL,EAAwB,QAAxB,YAAAK,EAA+B,cAAc,CAAA,EAExD,IAAK,uBACH,OAAOD,EAAK,EACV,uCACAA,EAAK,GAAEE,EAAAN,EAAwB,QAAxB,YAAAM,EAA+B,cAAc,CAAA,EAExD,QACE,OAAOF,EAAK,EACV,uCACAA,EAAK,GAAEG,EAAAP,EAAwB,QAAxB,YAAAO,EAA+B,cAAc,CAAA,CAE1D,CAAA,CACD,EAEKC,EAAQC,EAAgC,gBAAgB,EACxDC,EAAmBD,IACnBE,EAAQF,IAER,CAAE,sBAAAG,GAA0BC,IAE5BC,EAAkBX,EAAS,IAAM,OACrC,OAAQK,EAAM,MAAO,CACnB,IAAK,iBACI,OAAAO,EACT,IAAK,iBACL,IAAK,uBACI,OAAAC,EACT,QACE,OAAOX,EAAAO,EAAsBJ,EAAM,KAAK,EAAE,uBAAnC,YAAAH,EAAyD,SACpE,CAAA,CACD,EAEKY,EAAuBC,GAAiD,CACxE,GAAA,EAACA,GAAA,MAAAA,EAAS,WAAW,CACvBC,EAAY,mBAAmB,EAC/B,MACF,CAEAX,EAAM,MAAQU,EAAQ,UACtBP,EAAM,MAAQO,EAAQ,MACtBR,EAAiB,MAAQQ,EAAQ,OAAA,EAG7BE,EAAuB,IAAM,cAC7Bd,GAAAD,EAAAL,EAAwB,QAAxB,YAAAK,EAA+B,sBAA/B,MAAAC,EAAoD,OAChCe,GAAAd,EAAAP,EAAA,QAAA,YAAAO,EACpB,gBADoB,MAAAc,EAAA,KAAAd,GAErB,KAAMW,GAAYD,EAAoBC,CAAO,GAC7C,MAAM,IAAM,CAAA,EAAE"}