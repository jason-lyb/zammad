{"version":3,"file":"IdoitFlyout-DyMAwuk1.js","sources":["../../../../../app/frontend/apps/desktop/pages/ticket/components/TicketSidebar/TicketSidebarExternalReferences/TicketSidebarIdoit/IdoitFlyout/IdoitObjectList.vue","../../../../../app/frontend/apps/desktop/pages/ticket/graphql/queries/autocompleteSearchIdoitObjectTypes.api.ts","../../../../../app/frontend/apps/desktop/pages/ticket/graphql/queries/ticketExternalReferencesIdoitObjectSearch.api.ts","../../../../../app/frontend/apps/desktop/pages/ticket/components/TicketSidebar/TicketSidebarExternalReferences/TicketSidebarIdoit/IdoitFlyout.vue"],"sourcesContent":["<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport CommonSimpleTable from '#desktop/components/CommonTable/CommonSimpleTable.vue'\nimport type {\n  TableSimpleHeader,\n  TableItem,\n} from '#desktop/components/CommonTable/types'\n\ninterface Props {\n  items: TableItem[]\n}\n\ndefineProps<Props>()\n\nconst headers: TableSimpleHeader[] = [\n  { key: 'idoitObjectId', label: 'ID', truncate: true },\n  {\n    key: 'title',\n    label: __('Name'),\n    type: 'link',\n    truncate: true,\n  },\n  { key: 'status', label: __('Status'), truncate: true },\n]\n</script>\n\n<template>\n  <!-- TODO: Set needed props to disable infinite scrolling etc. -->\n  <CommonSimpleTable\n    v-if=\"items.length\"\n    :caption=\"$t('Idoit objects')\"\n    :items=\"items\"\n    :headers=\"headers\"\n    has-checkbox-column\n  />\n  <CommonLabel v-else>{{ $t('No results found') }}</CommonLabel>\n</template>\n","import * as Types from '#shared/graphql/types.ts';\n\nimport gql from 'graphql-tag';\nimport * as VueApolloComposable from '@vue/apollo-composable';\nimport * as VueCompositionApi from 'vue';\nexport type ReactiveFunction<TParam> = () => TParam;\n\nexport const AutocompleteSearchIdoitObjectTypesDocument = gql`\n    query autocompleteSearchIdoitObjectTypes($input: AutocompleteSearchInput!) {\n  autocompleteSearchIdoitObjectTypes(input: $input) {\n    value\n    label\n  }\n}\n    `;\nexport function useAutocompleteSearchIdoitObjectTypesQuery(variables: Types.AutocompleteSearchIdoitObjectTypesQueryVariables | VueCompositionApi.Ref<Types.AutocompleteSearchIdoitObjectTypesQueryVariables> | ReactiveFunction<Types.AutocompleteSearchIdoitObjectTypesQueryVariables>, options: VueApolloComposable.UseQueryOptions<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables> | VueCompositionApi.Ref<VueApolloComposable.UseQueryOptions<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>> | ReactiveFunction<VueApolloComposable.UseQueryOptions<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>> = {}) {\n  return VueApolloComposable.useQuery<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>(AutocompleteSearchIdoitObjectTypesDocument, variables, options);\n}\nexport function useAutocompleteSearchIdoitObjectTypesLazyQuery(variables?: Types.AutocompleteSearchIdoitObjectTypesQueryVariables | VueCompositionApi.Ref<Types.AutocompleteSearchIdoitObjectTypesQueryVariables> | ReactiveFunction<Types.AutocompleteSearchIdoitObjectTypesQueryVariables>, options: VueApolloComposable.UseQueryOptions<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables> | VueCompositionApi.Ref<VueApolloComposable.UseQueryOptions<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>> | ReactiveFunction<VueApolloComposable.UseQueryOptions<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>> = {}) {\n  return VueApolloComposable.useLazyQuery<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>(AutocompleteSearchIdoitObjectTypesDocument, variables, options);\n}\nexport type AutocompleteSearchIdoitObjectTypesQueryCompositionFunctionResult = VueApolloComposable.UseQueryReturn<Types.AutocompleteSearchIdoitObjectTypesQuery, Types.AutocompleteSearchIdoitObjectTypesQueryVariables>;","import * as Types from '#shared/graphql/types.ts';\n\nimport gql from 'graphql-tag';\nimport { IdoitObjectAttributesFragmentDoc } from '../fragments/IdoitObjectAttributes.api';\nimport * as VueApolloComposable from '@vue/apollo-composable';\nimport * as VueCompositionApi from 'vue';\nexport type ReactiveFunction<TParam> = () => TParam;\n\nexport const TicketExternalReferencesIdoitObjectSearchDocument = gql`\n    query ticketExternalReferencesIdoitObjectSearch($idoitTypeId: String, $limit: Int!, $query: String) {\n  ticketExternalReferencesIdoitObjectSearch(\n    idoitTypeId: $idoitTypeId\n    limit: $limit\n    query: $query\n  ) {\n    ...IdoitObjectAttributes\n  }\n}\n    ${IdoitObjectAttributesFragmentDoc}`;\nexport function useTicketExternalReferencesIdoitObjectSearchQuery(variables: Types.TicketExternalReferencesIdoitObjectSearchQueryVariables | VueCompositionApi.Ref<Types.TicketExternalReferencesIdoitObjectSearchQueryVariables> | ReactiveFunction<Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>, options: VueApolloComposable.UseQueryOptions<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables> | VueCompositionApi.Ref<VueApolloComposable.UseQueryOptions<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>> | ReactiveFunction<VueApolloComposable.UseQueryOptions<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>> = {}) {\n  return VueApolloComposable.useQuery<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>(TicketExternalReferencesIdoitObjectSearchDocument, variables, options);\n}\nexport function useTicketExternalReferencesIdoitObjectSearchLazyQuery(variables?: Types.TicketExternalReferencesIdoitObjectSearchQueryVariables | VueCompositionApi.Ref<Types.TicketExternalReferencesIdoitObjectSearchQueryVariables> | ReactiveFunction<Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>, options: VueApolloComposable.UseQueryOptions<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables> | VueCompositionApi.Ref<VueApolloComposable.UseQueryOptions<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>> | ReactiveFunction<VueApolloComposable.UseQueryOptions<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>> = {}) {\n  return VueApolloComposable.useLazyQuery<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>(TicketExternalReferencesIdoitObjectSearchDocument, variables, options);\n}\nexport type TicketExternalReferencesIdoitObjectSearchQueryCompositionFunctionResult = VueApolloComposable.UseQueryReturn<Types.TicketExternalReferencesIdoitObjectSearchQuery, Types.TicketExternalReferencesIdoitObjectSearchQueryVariables>;","<!-- Copyright (C) 2012-2025 Zammad Foundation, https://zammad-foundation.org/ -->\n\n<script setup lang=\"ts\">\nimport { useDebounceFn } from '@vueuse/core'\nimport { computed, watchEffect } from 'vue'\n\nimport Form from '#shared/components/Form/Form.vue'\nimport type { FormSchemaNode } from '#shared/components/Form/types.ts'\nimport { useForm } from '#shared/components/Form/useForm.ts'\nimport { useDebouncedLoading } from '#shared/composables/useDebouncedLoading.ts'\nimport UserError from '#shared/errors/UserError.ts'\nimport { QueryHandler } from '#shared/server/apollo/handler/index.ts'\n\nimport CommonFlyout from '#desktop/components/CommonFlyout/CommonFlyout.vue'\nimport { closeFlyout } from '#desktop/components/CommonFlyout/useFlyout.ts'\nimport CommonLoader from '#desktop/components/CommonLoader/CommonLoader.vue'\nimport type { TableItem } from '#desktop/components/CommonTable/types'\nimport IdoitObjectList from '#desktop/pages/ticket/components/TicketSidebar/TicketSidebarExternalReferences/TicketSidebarIdoit/IdoitFlyout/IdoitObjectList.vue'\nimport type { FormDataRecords } from '#desktop/pages/ticket/components/TicketSidebar/TicketSidebarExternalReferences/TicketSidebarIdoit/types.ts'\nimport { AutocompleteSearchIdoitObjectTypesDocument } from '#desktop/pages/ticket/graphql/queries/autocompleteSearchIdoitObjectTypes.api.ts'\nimport { useTicketExternalReferencesIdoitObjectSearchQuery } from '#desktop/pages/ticket/graphql/queries/ticketExternalReferencesIdoitObjectSearch.api.ts'\n\ninterface Props {\n  objectIds: number[]\n  onSubmit: (formData: FormDataRecords) => Promise<unknown>\n  icon: string\n}\n\nconst props = defineProps<Props>()\n\nconst { form, values, updateFieldValues, onChangedField, formSetErrors } =\n  useForm()\n\nconst FETCH_LIMIT = 10\nconst FETCH_DEBOUNCE = 300\n\nconst flyoutName = 'idoit'\n\nconst objectSearchQuery = new QueryHandler(\n  useTicketExternalReferencesIdoitObjectSearchQuery(\n    {\n      limit: FETCH_LIMIT,\n      idoitTypeId: values.value?.type as string,\n      query: values.value?.filter as string,\n    },\n    {\n      fetchPolicy: 'no-cache',\n    },\n  ),\n  {\n    errorShowNotification: false,\n  },\n)\n\nconst result = objectSearchQuery.result()\n\nconst isLoading = objectSearchQuery.loading()\n\nobjectSearchQuery.onError(() => {\n  formSetErrors(\n    new UserError([\n      {\n        field: 'type',\n        message: __(\n          'Error fetching i-doit information. Please contact your administrator.',\n        ),\n      },\n    ]),\n  )\n})\n\nconst { debouncedLoading, loading } = useDebouncedLoading()\n\nwatchEffect(() => {\n  loading.value = isLoading.value\n})\n\nconst objectItems = computed(\n  () =>\n    result.value?.ticketExternalReferencesIdoitObjectSearch.map((object) => ({\n      id: object.idoitObjectId,\n      idoitObjectId: object.idoitObjectId,\n      title: {\n        link: object.link,\n        label: object.title,\n        openInNewTab: true,\n        external: true,\n      },\n      status: object.status,\n      disabled: props.objectIds.includes(object.idoitObjectId),\n      checked: props.objectIds.includes(object.idoitObjectId),\n    })) || [],\n)\n\nonChangedField(\n  'filter',\n  useDebounceFn(\n    (query) =>\n      objectSearchQuery.refetch({\n        limit: FETCH_LIMIT,\n        idoitTypeId: values.value?.type as string,\n        query: query as string,\n      }),\n    FETCH_DEBOUNCE,\n  ),\n)\n\nonChangedField('type', async (type) =>\n  objectSearchQuery.refetch({\n    limit: FETCH_LIMIT,\n    idoitTypeId: type as string,\n    query: values.value?.filter as string,\n  }),\n)\n\nconst schema: FormSchemaNode[] = [\n  {\n    type: 'autocomplete',\n    name: 'type',\n    label: __('Type'),\n    props: {\n      gqlQuery: AutocompleteSearchIdoitObjectTypesDocument,\n      clearable: true,\n      defaultFilter: '*',\n      classes: {\n        outer: 'mb-3',\n      },\n    },\n  },\n  {\n    type: 'text',\n    name: 'filter',\n    label: __('Filter'),\n    placeholder: __('Search…'),\n    props: {\n      prefixIcon: 'search',\n      classes: {\n        input: 'rtl:pr-2 ltr:pl-1 ltr:pl-2 rtl:pr-1',\n        outer: 'mb-4',\n      },\n    },\n  },\n  {\n    type: 'hidden',\n    name: 'objectIds',\n  },\n]\n\nconst handleObjectSelection = (selectedRows: TableItem[]) =>\n  updateFieldValues({\n    objectIds: selectedRows\n      .filter((object) => !object.disabled)\n      .map(({ idoitObjectId }) => idoitObjectId) as number[],\n  })\n\nconst preselectedObjectIds = computed(() =>\n  props.objectIds.map((id) => id.toString()),\n)\n\n// Only count newly added objects\nconst isValid = computed(\n  () =>\n    (\n      (values.value?.objectIds as number[])?.filter(\n        (id) => !props.objectIds.includes(id),\n      ) || []\n    ).length > 0,\n)\n\nconst submitObjects = async (data: FormDataRecords) => {\n  await props.onSubmit(data)\n\n  return () => closeFlyout(flyoutName)\n}\n</script>\n\n<template>\n  <CommonFlyout\n    :header-icon=\"icon\"\n    :header-title=\"__('i-doit: Link objects')\"\n    :name=\"flyoutName\"\n    no-close-on-action\n    :footer-action-options=\"{\n      actionLabel: $t('Link Objects'),\n      actionButton: {\n        type: 'submit',\n        disabled: !isValid,\n      },\n      form,\n    }\"\n  >\n    <Form\n      ref=\"form\"\n      should-autofocus\n      :schema=\"schema\"\n      @submit=\"submitObjects($event as FormDataRecords)\"\n    />\n\n    <CommonLoader :loading=\"debouncedLoading\">\n      <IdoitObjectList\n        class=\"w-full\"\n        :items=\"objectItems\"\n        :disabled-checkbox-ids=\"preselectedObjectIds\"\n        @update:checked-rows=\"handleObjectSelection\"\n      />\n    </CommonLoader>\n  </CommonFlyout>\n</template>\n"],"names":["headers","AutocompleteSearchIdoitObjectTypesDocument","gql","TicketExternalReferencesIdoitObjectSearchDocument","IdoitObjectAttributesFragmentDoc","useTicketExternalReferencesIdoitObjectSearchQuery","variables","options","VueApolloComposable.useQuery","FETCH_LIMIT","FETCH_DEBOUNCE","flyoutName","props","__props","form","values","updateFieldValues","onChangedField","formSetErrors","useForm","objectSearchQuery","QueryHandler","_a","_b","result","isLoading","UserError","debouncedLoading","loading","useDebouncedLoading","watchEffect","objectItems","computed","object","useDebounceFn","query","type","schema","handleObjectSelection","selectedRows","idoitObjectId","preselectedObjectIds","id","isValid","submitObjects","data","closeFlyout"],"mappings":"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"}